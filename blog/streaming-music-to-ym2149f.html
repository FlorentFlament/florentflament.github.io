<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <title>Streaming music to YM2149F | Florent Flament 2 cents</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="http://www.florentflament.com/blog/static/m-dark.css" />
  <link rel="canonical" href="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html" />
  <link href="http://www.florentflament.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Florent Flament 2 cents" />
  <link href="http://www.florentflament.com/blog/feeds/hardware.atom.xml" type="application/atom+xml" rel="alternate" title="Florent Flament 2 cents | hardware" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <meta property="og:site_name" content="Florent Flament 2 cents" />
  <meta property="og:title" content="Streaming music to YM2149F" />
  <meta name="twitter:title" content="Streaming music to YM2149F" />
  <meta property="og:url" content="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html" />
  <meta property="og:description" content="To follow-up on my previous blog post about driving a YM2149F chip with an Arduino, I wrote an Arduino firmware that can be used together with a PC side Python script to send music to the YM2149F. All the code is available in the ym2149-streamer repository on GitHub. Arduino Firmware …" />
  <meta name="twitter:description" content="To follow-up on my previous blog post about driving a YM2149F chip with an Arduino, I wrote an Arduino firmware that can be used together with a PC side Python script to send music to the YM2149F. All the code is available in the ym2149-streamer repository on GitHub. Arduino Firmware …" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:type" content="article" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="http://www.florentflament.com/blog/" id="m-navbar-brand" class="m-col-t-9 m-col-m-none m-left-m">Florent Flament 2 cents</a>
      <a id="m-navbar-show" href="#navigation" title="Show navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <a id="m-navbar-hide" href="#" title="Hide navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-12 m-col-m-none">
            <li><a href="http://www.florentflament.com/blog/" id="m-navbar-current">Blog</a></li>
            <li><a href="http://www.florentflament.com/blog/pages/about.html">About</a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main>
<div class="m-container">
  <div class="m-row">
    <article class="m-col-m-10 m-nopadb">
      <header>
        <h1><a href="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html" rel="bookmark" title="Permalink to Streaming music to YM2149F">
          <time class="m-date" datetime="2016-09-10T00:00:00+02:00">
            Sep <span class="m-date-day">10</span> 2016
          </time>
          Streaming music to YM2149F
        </a></h1>
      </header>
      <div class="m-clearfix-l"></div>
<!-- content -->
<p>To follow-up on my previous blog post about <a href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html">driving a YM2149F chip
with an Arduino</a>, I wrote an Arduino firmware that can be used
together with a PC side Python script to send music to the
YM2149F. All the code is available in the <a href="https://github.com/FlorentFlament/ym2149-streamer">ym2149-streamer
repository</a> on GitHub.</p>
<h2>Arduino Firmware</h2>
<p>The first piece of code is the firmware. This is the code that runs in
the Arduino and drives the YM2149 chip. Most of the code is in the
<code>ym2149</code> library, which exports functions such as <code>send_data(char
addr, char data)</code> to write in the YM2149 registers, while complying
with the signals timings specified in the <a href="http://www.ym2149.com/ym2149.pdf">YM2149 datasheet</a>.</p>
<p>Basically, the firmware continuously reads the Arduino serial
line. Each time it has received 16 bytes, the firmware uses them to
set the 16 YM2149 registers (To be more precise only the first 14
registers are used, the 2 last registers are useless to play music).</p>
<p>Note that this code is specific to the circuit, and depends on how the
Arduino is wired to the YM2149. It has been written for (and tested
with) the circuit described in the blog post about <a href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html">driving the YM2149
from an Arduino</a></p>
<p>To flash the Arduino with the firmware:</p>
<ul>
<li>clone the <a href="https://github.com/FlorentFlament/ym2149-streamer">ym2149-streamer repository</a></li>
<li>and launch <code>make flash</code></li>
</ul>
<p>A couple of libraries need to be installed in order for the firmware
to compile and be uploaded to the Arduino. To setup your environment,
one can follow the instruction of the <a href="http://www.florentflament.com/blog/arduino-hello-world-without-ide.html">Arduino Hello World without
IDE</a> blog post.</p>
<h2>Playing music from a computer</h2>
<p>What remains to be done, is sending to the Arduino, the values of the
registers to be set in the YM2149. Here we can build on the <a href="http://leonard.oxg.free.fr/ymformat.html">YM file
format created by Arnaud Carré</a>. The file format is quite straight
forward. It contains a header providing all the required information
about the tune, then a snapshot of the YM2149's 16 registers at
regular intervals (usually 50 times per second). To play the tune, we
have to send back the content of the YM2149 registers (sometimes
referred as the samples) at the appropriate frequency.</p>
<p>I wrote a small Python script, available in the <a href="https://github.com/FlorentFlament/ym2149-streamer">ym2149-streamer
repository</a>, that parses a YM file and sends it to the Arduino
board. The syntax is:</p>
<div class="highlight"><pre><span></span>$ python streamer.py &lt;output_device&gt; &lt;ym_filepath&gt;
</pre></div>


<p>Note that <code>streamer.py</code> may work with other circuits driving a
YM2149. The only thing required is that the circuit be able to receive
a stream of YM2149's registers snapshots and send it to the chip each
time it receives a sample.</p>
<p>To illustrate this work, I published a video of the <a href="https://www.youtube.com/watch?v=MTRJdDbY048">YM2149F playing
Lemmings</a>.</p>
<p>A <a href="http://pacidemo.planet-d.net/html.html">large YM tunes archive</a> allows playing old school musics on the
YM2149 chip. Note that the files in the zip archives are compressed
with <code>lha</code> (which can be installed through the Fedora <code>lha</code>
package). Therefore, one has to uncompress the <code>ym</code> files before
playing them with <code>streamer.py</code>. I may try to handle the decompression
directly in the script some day.</p>
<p>Besides, another <a href="http://sndh.atari.org/">large archive of Atari ST music</a> is around there,
with a more dynamic community. Though the tunes are in the <code>sndh</code>
format, which is harder to interpret and stream to a YM2149 chip. A
nice thing would be to find a way to have these <code>sndh</code> files played on
the sound chip!</p>
<!-- /content -->
      <footer>
        <p>Posted by <a href="http://www.florentflament.com/blog/author/florent-flament.html">Florent Flament</a> on <time datetime="2016-09-10T00:00:00+02:00">Sat 10 September 2016</time> in <a href="http://www.florentflament.com/blog/category/hardware.html">hardware</a>. Tags: <a href="http://www.florentflament.com/blog/tag/arduino.html">Arduino</a>, <a href="http://www.florentflament.com/blog/tag/ym2149.html">YM2149</a>, <a href="http://www.florentflament.com/blog/tag/ym2149f.html">YM2149F</a>, <a href="http://www.florentflament.com/blog/tag/ay-3-8910.html">AY-3-8910</a>.</p>
      </footer>
    </article>
    <nav class="m-navpanel m-col-m-2">
      <h3>Categories</h3>
      <ol class="m-block-bar-m">
        <li><a href="http://www.florentflament.com/blog/category/automation.html">automation</a></li>
        <li><a href="http://www.florentflament.com/blog/category/hardware.html">hardware</a></li>
        <li><a href="http://www.florentflament.com/blog/category/linux-kernel.html">linux-kernel</a></li>
        <li><a href="http://www.florentflament.com/blog/category/misc.html">misc</a></li>
        <li><a href="http://www.florentflament.com/blog/category/openstack.html">OpenStack</a></li>
        <li><a href="http://www.florentflament.com/blog/category/thoughts.html">thoughts</a></li>
      </ol>
      <h3>Tag cloud</h3>
      <ul class="m-tagcloud">
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/amd.html">AMD</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/apple.html">Apple</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/arduino.html">Arduino</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/atmega.html">ATmega</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ay-3-8910.html">AY-3-8910</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/benchmark.html">Benchmark</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/bug.html">bug</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/ceph.html">Ceph</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/chef.html">Chef</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/cinder.html">Cinder</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/costs.html">Costs</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/cryptocurrency.html">Cryptocurrency</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-management.html">Data management</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-safety.html">Data Safety</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-security.html">Data Security</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/docker.html">Docker</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/documentation.html">Documentation</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/gf7050t-m5.html">GF7050T-M5</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/git.html">Git</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/gpu.html">GPU</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/hardware.html">Hardware</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/irc.html">IRC</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/jekyll.html">Jekyll</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/kernel.html">Kernel</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/keystone.html">Keystone</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/kvm.html">KVM</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/libvirt.html">libvirt</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/linux.html">Linux</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/mcss.html">m.css</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/microsft.html">Microsft</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/old-hardware.html">Old Hardware</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/opencl.html">OpenCL</a></li>
        <li class="m-tag-5"><a href="http://www.florentflament.com/blog/tag/openstack.html">OpenStack</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/operations.html">operations</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/pelican.html">Pelican</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/policies.html">Policies</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/printers.html">Printers</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/radeon.html">Radeon</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/raspberry-pi.html">Raspberry Pi</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/raspbian.html">Raspbian</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ring.html">Ring</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/rx-480.html">RX 480</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/sndh.html">SNDH</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ssh.html">SSH</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/swift.html">Swift</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ubuntu.html">Ubuntu</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/virtualization.html">Virtualization</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/vm.html">VM</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/website-generator.html">Website generator</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/windows.html">Windows</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ym2149.html">YM2149</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ym2149f.html">YM2149F</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/znc.html">ZNC</a></li>
      </ul>
    </nav>
  </div>
</div>
</main>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Florent Flament 2 cents. Powered by <a href="https://getpelican.com">Pelican</a> and <a href="https://mcss.mosra.cz">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>