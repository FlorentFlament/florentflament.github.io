<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Right VM cost</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Florent Flament">

    <!-- Le styles -->
    <link rel="stylesheet" href="./theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="./theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="./theme/css/font-awesome.css" rel="stylesheet">

    <link href="./theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="./theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="./theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./theme/images/apple-touch-icon-114x114.png">

    <link href="./" type="application/atom+xml" rel="alternate" title="Florent Flament's Tech Blog ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="./index.html">Florent Flament's Tech Blog </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li class="active">
                    <a href="./category/misc.html">
						<i class="icon-folder-open icon-large"></i>misc
					</a>
                  </li>
                  <li >
                    <a href="./category/openstack.html">
						<i class="icon-folder-open icon-large"></i>OpenStack
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="./archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Right VM cost">
                                        Right VM cost
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2014-08-03T00:00:00+02:00">
        <i class="icon-calendar"></i>Sun 03 August 2014
</abbr>
<span class="label">By</span>
<a href="./author/florent-flament.html"><i class="icon-user"></i>Florent Flament</a>
<span class="label">Category</span>
<a href="./category/misc.html"><i class="icon-folder-open"></i>misc</a>.


<span class="label">Tags</span>
	<a href="./tag/virtualization.html"><i class="icon-tag"></i>Virtualization</a>
	<a href="./tag/vm.html"><i class="icon-tag"></i>VM</a>
	<a href="./tag/hardware.html"><i class="icon-tag"></i>Hardware</a>
	<a href="./tag/costs.html"><i class="icon-tag"></i>Costs</a>
</footer><!-- /.post-info -->                </div>
                <p>With cloud Virtual Machines prices dropping month after month, we may
be asking if the margins previously done by cloud operators were not
outrageously high. I actually find surprising that current VM price is
on average higher than equivalent dedicated server even though
virtualization allows sharing more hardware.</p>
<h2>Comparing dedicated server versus VM costs</h2>
<p>Low cost dedicated servers:</p>
<ul>
<li>CPU 1 Core / 2 threads - RAM 2 GB - HDD 500 GB - costs €5 / month at <a href="http://www.kimsufi.com/en/">Kimsufi</a></li>
<li>CPU 1 Core - RAM 2 GB - SHDD 500 GB - costs €9.99 / month at <a href="http://www.online.net/en/dedicated-server">online</a></li>
</ul>
<p>Low cost VMs:</p>
<ul>
<li>CPU 2 Cores - RAM 2 GB - SSD 40 GB - costs $20 / month at <a href="https://www.digitalocean.com/pricing/">DigitalOcean</a></li>
<li>vCPUs 2 - RAM 2 GB - SSD 60 GB - $54 / month at <a href="http://www.rackspace.com/cloud/public-pricing/">rackspace</a></li>
<li>vCPUs 1 (fractional) - RAM 2 GB - 0 (additional storage cost) - $19 / month at <a href="http://aws.amazon.com/ec2/pricing/">Amazon</a></li>
</ul>
<p>Virtual machines CPUs don't have much meaning, since depending on the
underlying hardware a virtual machine CPU may correspond to a physical
CPU core, thread or a fraction of CPU if the hypervisor is sharing
CPUs among VMs. Amazon introduces an EC2 Compute Unit (ECU), that
would allow objectively <a href="http://aws.amazon.com/ec2/faqs/">comparing CPU performance between VMs</a>.</p>
<p>At first glance we can see that for low end configurations the
price/performance ratio of Virtual Machines looks much higher than
ratio of dedicated servers.</p>
<h2>Estimating cost of hardware</h2>
<p>We can make an estimate of the cost of hardware by performing a
<a href="http://en.wikipedia.org/wiki/Regression_analysis">multiple regression analysis</a> on dedicated server prices.</p>
<p><a href="http://www.ovh.com/fr/serveurs_dedies/enterprise/">OVH prices</a> (only considering Intel Xeon CPUs):</p>
<div class="highlight"><pre><span></span>|-------------------------------------------------------------------------------------------|
|         CPU type        | # threads | RAM (GB) | HDD (TB) | SSD (GB) | Price (€/month HT) |
|-------------------------------------------------------------------------------------------|
|                                 OVH Enterprise                                            |
|-------------------------------------------------------------------------------------------|
| Intel Xeon E5-1620v2    |     8     |    64    |     4    |     0    |       €81.99       |
| Intel Xeon E5-1650v2    |    12     |   128    |     4    |     0    |      €131.99       |
| Intel Xeon 2x E5-2650v2 |    32     |   128    |     4    |     0    |      €202.99       |
| Intel Xeon 2x E5-2670v2 |    40     |   256    |     4    |     0    |      €302.99       |
|-------------------------------------------------------------------------------------------|
|                                   OVH Infra                                               |
|-------------------------------------------------------------------------------------------|
| Intel Xeon E5-1620v2    |     8     |    32    |     6    |     0    |       €81.99       |
| Intel Xeon E5-1650v2    |    12     |    64    |     6    |     0    |      €141.99       |
| Intel Xeon 1x E5-2650v2 |    16     |   128    |     6    |     0    |      €191.99       |
| Intel Xeon 2x E5-2650v2 |    32     |   128    |     6    |     0    |      €302.99       |
| Intel Xeon 2x E5-2670v2 |    40     |   256    |     6    |     0    |      €402.99       |
|-------------------------------------------------------------------------------------------|
|                                   OVH Storage                                             |
|-------------------------------------------------------------------------------------------|
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    48    |     0    |      €372.99       |
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    72    |     0    |      €522.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   144    |     0    |      €822.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   216    |     0    |     €1272.00       |
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    36    |   360    |      €372.99       |
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    54    |   360    |      €522.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   108    |  1080    |      €822.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   162    |  1080    |     €1272.00       |
|-------------------------------------------------------------------------------------------|
</pre></div>


<p>In our case, for each server setting we have:
Yi = ß1 + ß2<em>Xi2 + ß3</em>Xi3 + ß4<em>Xi4 + ß5</em>Xi5 + Ei
where:</p>
<ul>
<li>Yi is the price for setting i</li>
<li>ß1 is a constant per server</li>
<li>ß2 is the estimate of € / thread</li>
<li>ß3 is the estimate of € / GB of RAM</li>
<li>ß4 is the estimate of € / TB of HDD</li>
<li>ß5 is the estimate of € / GB of SSD</li>
<li>Xi2 is the number of CPU threads for setting i</li>
<li>Xi3 is the amount of RAM in GB for setting i</li>
<li>Xi4 is the amount of HDD space in TB for setting i</li>
<li>Xi5 is the amount of SSD space in GB for setting i</li>
<li>Ri is the residual error for setting i</li>
</ul>
<p>We can estimate ßj coefficients with the following formula:
ß = (Xt<em>X)-¹</em>Xt*Y</p>
<div class="highlight"><pre><span></span>$ python pricing_vm_simple.py
Constant: 31.3530724158
Eur / CPU thread: 3.12689639938
Eur / GB of RAM: 0.639580183605
Eur / TB of HDD: 5.18992626031
Eur / GB of SSD: 0.197627042107
R^2: 0.982339781679
</pre></div>


<p>Assuming that we rent some of the afore mentioned dedicated servers,
what comes out from these results is that the most expensive resource
is the Intel Xeon CPU thread, which costs more than €3/month. Hence
the monthly cost of the following configurations (including €1 share
of server fixed cost):</p>
<ul>
<li>2 Full Xeon Threads - 2 GB RAM - 40 GB SSD : €16.50</li>
<li>1 Full Xeon Thread - 1 GB RAM - 10 GB SSD : €6.75</li>
<li>1/4th Xeon Thread - 1 GB RAM - 5 GB SSD : €3.40</li>
<li>1/8th Xeon Thread - 512 MB RAM - 1 GB SSD : €1.90</li>
</ul>
<h2>Interpretation</h2>
<p>These hardware costs look rather aligned with cheapest (Digital Ocean)
VMs prices. On the other hand, public cloud leaders (Rackspace and
Amazon) are much more expensive.</p>
<p>So should Virtual Machines be cheaper than equivalent dedicated
servers ? Well, this is possible when virtualization allows sharing a
certain amount of fixed costs among users of the same hardware.
According to the previous regression analysis (and hardware
considered), these fixed costs account for roughly €30 / month per
server. Therefore, for low end VMs from some Euros to tens of Euros,
fixed costs sharing looks meaningful. On the other hand, high end VMs
are costly and don't allow many users to share the same server. In
that case, there is no real cost advantage in choosing a VM instead of
a dedicated server in a 24H / 24 7D / 7 usage scenario. However, for
ephemeral usage, high end virtual machines may make sense. Besides,
SSD storage (which is recommended when sharing a disk with many users)
is costly. Therefore, in the case of huge storage space requirements,
dedicated servers with big HDDs may be more appropriate.</p>
<h2>Annex - Regression Analysis code</h2>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
<span class="s1">&#39;1,  8,  64,   4,    0;&#39;</span>
<span class="s1">&#39;1, 12, 128,   4,    0;&#39;</span>
<span class="s1">&#39;1, 32, 128,   4,    0;&#39;</span>
<span class="s1">&#39;1, 40, 256,   4,    0;&#39;</span>
<span class="s1">&#39;1,  8,  32,   6,    0;&#39;</span>
<span class="s1">&#39;1, 12,  64,   6,    0;&#39;</span>
<span class="s1">&#39;1, 16, 128,   6,    0;&#39;</span>
<span class="s1">&#39;1, 32, 128,   6,    0;&#39;</span>
<span class="s1">&#39;1, 40, 256,   6,    0;&#39;</span>
<span class="s1">&#39;1, 12,  48,  48,    0;&#39;</span>
<span class="s1">&#39;1, 12,  48,  72,    0;&#39;</span>
<span class="s1">&#39;1, 24,  64, 144,    0;&#39;</span>
<span class="s1">&#39;1, 24,  64, 216,    0;&#39;</span>
<span class="s1">&#39;1, 12,  48,  36,  360;&#39;</span>
<span class="s1">&#39;1, 12,  48,  54,  360;&#39;</span>
<span class="s1">&#39;1, 24,  64, 108, 1080;&#39;</span>
<span class="s1">&#39;1, 24,  64, 162, 1080&#39;</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span>
<span class="s1">&#39;  81.99;&#39;</span>
<span class="s1">&#39; 131.99;&#39;</span>
<span class="s1">&#39; 202.99;&#39;</span>
<span class="s1">&#39; 302.99;&#39;</span>
<span class="s1">&#39;  81.99;&#39;</span>
<span class="s1">&#39; 141.99;&#39;</span>
<span class="s1">&#39; 191.99;&#39;</span>
<span class="s1">&#39; 302.99;&#39;</span>
<span class="s1">&#39; 402.99;&#39;</span>
<span class="s1">&#39; 372.99;&#39;</span>
<span class="s1">&#39; 522.00;&#39;</span>
<span class="s1">&#39; 822.00;&#39;</span>
<span class="s1">&#39;1272.00;&#39;</span>
<span class="s1">&#39; 372.99;&#39;</span>
<span class="s1">&#39; 522.00;&#39;</span>
<span class="s1">&#39; 822.00;&#39;</span>
<span class="s1">&#39;1272.00&#39;</span><span class="p">)</span>

<span class="c1"># Computing model parameters</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">I</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">Y</span>

<span class="c1"># Computing predictions based on models</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">B</span>

<span class="c1"># Computing R^2</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">SStot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">M</span><span class="p">,</span> <span class="n">Y</span><span class="o">-</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">SSres</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">F</span><span class="p">,</span> <span class="n">Y</span><span class="o">-</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Rsq</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSres</span> <span class="o">/</span> <span class="n">SStot</span>

<span class="k">print</span> <span class="s2">&quot;Constant:&quot;</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Eur / CPU thread:&quot;</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Eur / GB of RAM:&quot;</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Eur / TB of HDD:&quot;</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Eur / GB of SSD:&quot;</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;R^2:&quot;</span><span class="p">,</span> <span class="n">Rsq</span>
</pre></div>
                </div><!-- /.entry-content -->
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><a href="http://blog.chmouel.com/"><i class="icon-external-link"></i>Chmouel's Blog</a></li>
    <li><a href="http://dachary.org/"><i class="icon-external-link"></i>Loïc Dachary's Blog</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="./category/misc.html">
    <i class="icon-folder-open icon-large"></i>misc
</a>
</li>
<li>
<a href="./category/openstack.html">
    <i class="icon-folder-open icon-large"></i>OpenStack
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
        </address><!-- /#about -->
        <p>Powered by <a href="http://blog.getpelican.com/">Pelican<i class="icon-external-link"></i></a></p>
      </footer>

    </div><!--/.fluid-container-->



    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./theme/js/jquery-1.7.2.min.js"></script>
    <script src="./theme/js/bootstrap.min.js"></script>
  </body>
</html>