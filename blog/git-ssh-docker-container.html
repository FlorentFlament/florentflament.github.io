<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <title>Git SSH Docker container | Florent Flament</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="http://www.florentflament.com/blog/static/m-dark.css" />
  <link rel="canonical" href="http://www.florentflament.com/blog/git-ssh-docker-container.html" />
  <link href="http://www.florentflament.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Florent Flament" />
  <link href="http://www.florentflament.com/blog/feeds/automation.atom.xml" type="application/atom+xml" rel="alternate" title="Florent Flament | automation" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <meta property="og:site_name" content="Florent Flament" />
  <meta property="og:title" content="Git SSH Docker container" />
  <meta name="twitter:title" content="Git SSH Docker container" />
  <meta property="og:url" content="http://www.florentflament.com/blog/git-ssh-docker-container.html" />
  <meta property="og:description" content="My favorite option to backup and version my code and text files is using git with a remote repository. The implementation I have chosen for that consists in running an ssh server, with git, in a Docker container. This has the following advantages over other solutions: 100% reproducible; Limits access …" />
  <meta name="twitter:description" content="My favorite option to backup and version my code and text files is using git with a remote repository. The implementation I have chosen for that consists in running an ssh server, with git, in a Docker container. This has the following advantages over other solutions: 100% reproducible; Limits access …" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:type" content="article" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="http://www.florentflament.com/blog/" id="m-navbar-brand" class="m-col-t-9 m-col-m-none m-left-m">Florent Flament</a>
      <a id="m-navbar-show" href="#navigation" title="Show navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <a id="m-navbar-hide" href="#" title="Hide navigation" class="m-col-t-3 m-hide-m m-text-right"></a>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-12 m-col-m-none">
            <li><a href="http://www.florentflament.com/blog/" id="m-navbar-current">Blog</a></li>
            <li><a href="http://www.florentflament.com/blog/pages/demoscene.html">Demoscene</a></li>
            <li><a href="http://www.florentflament.com/blog/pages/about.html">About</a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main>
<div class="m-container">
  <div class="m-row">
    <article class="m-col-m-10 m-nopadb">
      <header>
        <h1><a href="http://www.florentflament.com/blog/git-ssh-docker-container.html" rel="bookmark" title="Permalink to Git SSH Docker container">
          <time class="m-date" datetime="2014-06-28T00:00:00+02:00">
            Jun <span class="m-date-day">28</span> 2014
          </time>
          Git SSH Docker container
        </a></h1>
      </header>
      <div class="m-clearfix-l"></div>
<!-- content -->
<p>My favorite option to backup and version my code and text files is
using git with a remote repository. The implementation I have chosen
for that consists in running an ssh server, with git, in a Docker
container. This has the following advantages over other solutions:</p>
<ul>
<li>100% reproducible;</li>
<li>Limits access to the container in case the account is compromised;</li>
<li>Consumes less resources that running a VM.</li>
</ul>
<h2>Dockerfile</h2>
<p>The proposed Git SSH Dockerfile is based on the <a href="https://docs.docker.com/examples/running_ssh_service/">Dockerizing an SSH
service</a> example.</p>
<div class="highlight"><pre><span></span>FROM ubuntu:14.04

RUN apt-get -y update
RUN apt-get -y install openssh-server
RUN apt-get -y install git

<span class="c1"># Setting openssh</span>
RUN mkdir /var/run/sshd
RUN sed -i <span class="s2">&quot;s/#PasswordAuthentication yes/PasswordAuthentication no/&quot;</span> /etc/ssh/sshd_config

<span class="c1"># Adding git user</span>
RUN adduser --system git
RUN mkdir -p /home/git/.ssh

<span class="c1"># Clearing and setting authorized ssh keys</span>
RUN <span class="nb">echo</span> <span class="s1">&#39;&#39;</span> &gt; /home/git/.ssh/authorized_keys
RUN <span class="nb">echo</span> <span class="s1">&#39;First SSH public key&#39;</span> &gt;&gt; /home/git/.ssh/authorized_keys
RUN <span class="nb">echo</span> <span class="s1">&#39;Second SSH public key&#39;</span> &gt;&gt; /home/git/.ssh/authorized_keys
<span class="c1"># ...</span>

<span class="c1"># Updating shell to bash</span>
RUN sed -i s#/home/git:/bin/false#/home/git:/bin/bash# /etc/passwd

EXPOSE <span class="m">22</span>
CMD <span class="o">[</span><span class="s2">&quot;/usr/sbin/sshd&quot;</span>, <span class="s2">&quot;-D&quot;</span><span class="o">]</span>
</pre></div>


<h2>Running the container</h2>
<ul>
<li>
<p>Building the image</p>
<div class="highlight"><pre><span></span>$ docker.io build -t git-ssh_img .
</pre></div>


</li>
<li>
<p>Running the image</p>
<div class="highlight"><pre><span></span>$ sudo docker.io run -p <span class="m">1234</span>:22 -d --name git-ssh git-ssh_img
</pre></div>


</li>
</ul>
<p>The previous command maps the container's host port 1234 on the
container's SSH port. Of course, this port can be changed to any
value. One can then ssh to the container with the following command:</p>
<div class="highlight"><pre><span></span>$ ssh -p <span class="m">1234</span> git@&lt;container_host&gt;
</pre></div>
<!-- /content -->
      <footer>
        <p>Posted by <a href="http://www.florentflament.com/blog/author/florent-flament.html">Florent Flament</a> on <time datetime="2014-06-28T00:00:00+02:00">Sat 28 June 2014</time> in <a href="http://www.florentflament.com/blog/category/automation.html">automation</a>. Tags: <a href="http://www.florentflament.com/blog/tag/git.html">Git</a>, <a href="http://www.florentflament.com/blog/tag/ssh.html">SSH</a>, <a href="http://www.florentflament.com/blog/tag/docker.html">Docker</a>.</p>
      </footer>
    </article>
    <nav class="m-navpanel m-col-m-2">
      <h3>Categories</h3>
      <ol class="m-block-bar-m">
        <li><a href="http://www.florentflament.com/blog/category/automation.html">automation</a></li>
        <li><a href="http://www.florentflament.com/blog/category/hardware.html">hardware</a></li>
        <li><a href="http://www.florentflament.com/blog/category/linux-kernel.html">linux-kernel</a></li>
        <li><a href="http://www.florentflament.com/blog/category/misc.html">misc</a></li>
        <li><a href="http://www.florentflament.com/blog/category/openstack.html">OpenStack</a></li>
        <li><a href="http://www.florentflament.com/blog/category/thoughts.html">thoughts</a></li>
      </ol>
      <h3>Tag cloud</h3>
      <ul class="m-tagcloud">
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/amd.html">AMD</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/apple.html">Apple</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/arduino.html">Arduino</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/atmega.html">ATmega</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ay-3-8910.html">AY-3-8910</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/benchmark.html">Benchmark</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/bug.html">bug</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/ceph.html">Ceph</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/chef.html">Chef</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/cinder.html">Cinder</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/costs.html">Costs</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/cryptocurrency.html">Cryptocurrency</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-management.html">Data management</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-safety.html">Data Safety</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-security.html">Data Security</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/docker.html">Docker</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/documentation.html">Documentation</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/gf7050t-m5.html">GF7050T-M5</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/git.html">Git</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/gpu.html">GPU</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/hardware.html">Hardware</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/irc.html">IRC</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/jekyll.html">Jekyll</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/kernel.html">Kernel</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/keystone.html">Keystone</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/kvm.html">KVM</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/libvirt.html">libvirt</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/linux.html">Linux</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/mcss.html">m.css</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/microsft.html">Microsft</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/old-hardware.html">Old Hardware</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/opencl.html">OpenCL</a></li>
        <li class="m-tag-5"><a href="http://www.florentflament.com/blog/tag/openstack.html">OpenStack</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/operations.html">operations</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/pelican.html">Pelican</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/policies.html">Policies</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/printers.html">Printers</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/radeon.html">Radeon</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/raspberry-pi.html">Raspberry Pi</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/raspbian.html">Raspbian</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ring.html">Ring</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/rx-480.html">RX 480</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/sndh.html">SNDH</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ssh.html">SSH</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/swift.html">Swift</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ubuntu.html">Ubuntu</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/virtualization.html">Virtualization</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/vm.html">VM</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/website-generator.html">Website generator</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/windows.html">Windows</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ym2149.html">YM2149</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ym2149f.html">YM2149F</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/znc.html">ZNC</a></li>
      </ul>
    </nav>
  </div>
</div>
</main>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Florent Flament. Powered by <a href="https://getpelican.com">Pelican</a> and <a href="https://mcss.mosra.cz">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>