<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <title>ZNC in Docker container | Florent Flament 2 cents</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="http://www.florentflament.com/blog/static/m-dark.css" />
  <link rel="canonical" href="http://www.florentflament.com/blog/znc-in-docker-container.html" />
  <link href="http://www.florentflament.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Florent Flament 2 cents" />
  <link href="http://www.florentflament.com/blog/feeds/automation.atom.xml" type="application/atom+xml" rel="alternate" title="Florent Flament 2 cents | automation" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
  <meta property="og:site_name" content="Florent Flament 2 cents" />
  <meta property="og:title" content="ZNC in Docker container" />
  <meta name="twitter:title" content="ZNC in Docker container" />
  <meta property="og:url" content="http://www.florentflament.com/blog/znc-in-docker-container.html" />
  <meta property="og:description" content="ZNC is a popular IRC bouncer, which stays connected to IRC channels and log conversations while one isn&#39;t connected. This note desrcibes how to launch ZNC in a Docker container, so that it be launched on any Docker enabled platform. To quick start with Docker, one can follow the steps …" />
  <meta name="twitter:description" content="ZNC is a popular IRC bouncer, which stays connected to IRC channels and log conversations while one isn&#39;t connected. This note desrcibes how to launch ZNC in a Docker container, so that it be launched on any Docker enabled platform. To quick start with Docker, one can follow the steps …" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:type" content="article" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="http://www.florentflament.com/blog/" id="m-navbar-brand" class="m-col-t-9 m-col-m-none m-left-m">Florent Flament 2 cents</a>
    </div>
  </div>
</nav></header>
<main>
<div class="m-container">
  <div class="m-row">
    <article class="m-col-m-10 m-nopadb">
      <header>
        <h1><a href="http://www.florentflament.com/blog/znc-in-docker-container.html" rel="bookmark" title="Permalink to ZNC in Docker container">
          <time class="m-date" datetime="2013-12-15T00:00:00+01:00">
            Dec <span class="m-date-day">15</span> 2013
          </time>
          ZNC in Docker container
        </a></h1>
      </header>
      <div class="m-clearfix-l"></div>
<!-- content -->
<p><a href="http://wiki.znc.in/ZNC">ZNC</a> is a popular IRC bouncer, which stays connected to IRC
channels and log conversations while one isn't connected. This note
desrcibes how to launch ZNC in a <a href="https://www.docker.io/">Docker</a> container, so that it be
launched on any Docker enabled platform. To quick start with Docker,
one can follow the steps proposed to <a href="http://docs.docker.io/en/latest/installation/ubuntulinux/">install Docker on an Ubuntu
Linux</a> (for instance in a VM).</p>
<h2>Using ZNC setup wizard</h2>
<p>Once Docker is installed on the system, we can prepare an image that
will be used to run ZNC with the following <code>Dockerfile</code> (Docker
configuration file):</p>
<div class="highlight"><pre><span></span>FROM ubuntu:precise
MAINTAINER Florent Flament

# Using fr ubuntu mirrors and adding universe repository, to install znc
RUN echo &quot;deb http://fr.archive.ubuntu.com/ubuntu precise main restricted&quot; \
&gt; /etc/apt/sources.list
RUN echo &quot;deb http://fr.archive.ubuntu.com/ubuntu precise universe&quot; \
&gt;&gt; /etc/apt/sources.list

# Installing znc package
RUN apt-get -y update
RUN apt-get -y install znc

# Creating directory to store znc configuration
RUN mkdir -m 775 /var/znc
RUN chgrp daemon /var/znc
USER daemon
</pre></div>


<p>Let's assume that the <code>Dockerfile</code> is stored in the <code>znc-noconf</code>
directory. We can build the ZNC ready image with the following
command:</p>
<div class="highlight"><pre><span></span>$ docker build -t znc:noconf znc-noconf/
</pre></div>


<p>The next step is to configure ZNC. The following command will run the
configuration wizard in a new container based on the previously
generated image:</p>
<div class="highlight"><pre><span></span>$ docker run -i -t znc:noconf -d /var/znc -c
</pre></div>


<p>After having answered to all the questions, ZNC will generate its
configuration files. It will then be ready to run in daemon mode. Now
we can save a Docker image including ZNC's configuration files.</p>
<div class="highlight"><pre><span></span>$ <span class="nv">CONT</span><span class="o">=</span><span class="k">$(</span>docker ps -a <span class="p">|</span> grep <span class="s2">&quot;minutes ago&quot;</span> <span class="p">|</span> head -1 <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
$ docker commit <span class="se">\</span>
&gt; -run<span class="o">=</span><span class="s1">&#39;{&quot;Cmd&quot;: [&quot;/usr/bin/znc&quot;, &quot;-f&quot;, &quot;-d&quot;, &quot;/var/znc/&quot;], &quot;User&quot;: &quot;daemon&quot;}&#39;</span> <span class="se">\</span>
&gt; <span class="nv">$CONT</span> znc:ready
</pre></div>


<p>The ZNC image is now ready, and can be launched. In addition to launch
ZNC in a new container, the following command will map the host's 6697
TCP port on the container's 6697 port (assuming that ZNC has been
configured to listen to port 6697).</p>
<div class="highlight"><pre><span></span>$ docker run -d -p <span class="m">6697</span>:6697 znc:ready
</pre></div>


<h2>Using a previously made ZNC configuration file</h2>
<p>One can setup a ZNC Docker container even quicker if he already has a
<code>znc.conf</code> configuration file. One has to create a directory (for
instance <code>myznc/</code>) containing both: <code>znc.conf</code> and a <code>Dockerfile</code>, with
the following content:</p>
<div class="highlight"><pre><span></span>FROM ubuntu:precise
MAINTAINER Florent Flament

# Using fr ubuntu mirrors and adding universe repository, to install znc
RUN echo &quot;deb http://fr.archive.ubuntu.com/ubuntu precise main restricted&quot; \
&gt; /etc/apt/sources.list
RUN echo &quot;deb http://fr.archive.ubuntu.com/ubuntu precise universe&quot; \
&gt;&gt; /etc/apt/sources.list

# Installing znc package
RUN apt-get -y update
RUN apt-get -y install znc

# Creating directory to store znc configuration
RUN mkdir -m 775 /var/znc
# Generates key for SSL exchanges
RUN /usr/bin/znc -d /var/znc -p
# Copies ZNC configuration file
ADD znc.conf /var/znc/configs/
RUN chown -R daemon:daemon /var/znc
USER daemon

# Setting default container&#39;s command
CMD [&quot;/usr/bin/znc&quot;, &quot;-f&quot;, &quot;-d&quot;, &quot;/var/znc/&quot;]
</pre></div>


<p>Then the ZNC container can be launched right after having built the image:</p>
<div class="highlight"><pre><span></span>$ docker build -t znc:myznc myznc/
$ docker run -d -p <span class="m">6697</span>:6697 znc:myznc
</pre></div>


<h2>Update 2014/02/25</h2>
<p>Here's an example of ZNC configuration file listening for SSL incoming
connexions:</p>
<div class="highlight"><pre><span></span>Listener4  = +6697

<span class="nt">&lt;User</span> <span class="err">USER1</span><span class="nt">&gt;</span>
        Pass       = PASSWORDHASHHERE
        Admin      = true
        Nick       = NICK1
        AltNick    = NICK2
        Ident      = NICK1
        RealName   = REALNAME
        Buffer     = 500
        KeepBuffer = true
        ChanModes  = +stn
        LoadModule = admin
        Server     = irc.freenode.net 6667 
        BindHost   = 0.0.0.0
<span class="nt">&lt;/User&gt;</span>

<span class="nt">&lt;User</span> <span class="err">USER2</span><span class="nt">&gt;</span>
        Pass       = PASSWORDHASHHERE
        Admin      = true
        Nick       = NICK1
        AltNick    = NICK2
        Ident      = NICK1
        RealName   = REALNAME
        Buffer     = 500
        KeepBuffer = true
        ChanModes  = +stn
        LoadModule = admin
        Server     = CUSTOMIRCSERVER +6697 IRCSERVERPASSWORD
        BindHost   = 0.0.0.0
<span class="nt">&lt;/User&gt;</span>
</pre></div>


<p><code>PASSWORDHASHHERE</code> can be generated by using <code>znc -s</code>. IRC clients
(like xchat) have to be set up by specifying in the "Server Password"
field a user's credentials <code>&lt;user&gt;:&lt;password&gt;</code> (i.e
USER1:PASSORDHASHHERE).</p>
<!-- /content -->
      <footer>
        <p>Posted by <a href="http://www.florentflament.com/blog/author/florent-flament.html">Florent Flament</a> on <time datetime="2013-12-15T00:00:00+01:00">Sun 15 December 2013</time> in <a href="http://www.florentflament.com/blog/category/automation.html">automation</a>. Tags: <a href="http://www.florentflament.com/blog/tag/znc.html">ZNC</a>, <a href="http://www.florentflament.com/blog/tag/docker.html">Docker</a>, <a href="http://www.florentflament.com/blog/tag/irc.html">IRC</a>.</p>
      </footer>
    </article>
    <nav class="m-navpanel m-col-m-2">
      <h3>Categories</h3>
      <ol class="m-block-bar-m">
        <li><a href="http://www.florentflament.com/blog/category/automation.html">automation</a></li>
        <li><a href="http://www.florentflament.com/blog/category/hardware.html">hardware</a></li>
        <li><a href="http://www.florentflament.com/blog/category/linux-kernel.html">linux-kernel</a></li>
        <li><a href="http://www.florentflament.com/blog/category/misc.html">misc</a></li>
        <li><a href="http://www.florentflament.com/blog/category/openstack.html">OpenStack</a></li>
        <li><a href="http://www.florentflament.com/blog/category/thoughts.html">thoughts</a></li>
      </ol>
      <h3>Tag cloud</h3>
      <ul class="m-tagcloud">
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/amd.html">AMD</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/apple.html">Apple</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/arduino.html">Arduino</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/atmega.html">ATmega</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ay-3-8910.html">AY-3-8910</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/benchmark.html">Benchmark</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/bug.html">bug</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/ceph.html">Ceph</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/chef.html">Chef</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/cinder.html">Cinder</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/costs.html">Costs</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/cryptocurrency.html">Cryptocurrency</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-management.html">Data management</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-safety.html">Data Safety</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/data-security.html">Data Security</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/docker.html">Docker</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/documentation.html">Documentation</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/gf7050t-m5.html">GF7050T-M5</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/git.html">Git</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/gpu.html">GPU</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/hardware.html">Hardware</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/irc.html">IRC</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/jekyll.html">Jekyll</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/kernel.html">Kernel</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/keystone.html">Keystone</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/kvm.html">KVM</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/libvirt.html">libvirt</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/linux.html">Linux</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/mcss.html">m.css</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/microsft.html">Microsft</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/old-hardware.html">Old Hardware</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/opencl.html">OpenCL</a></li>
        <li class="m-tag-5"><a href="http://www.florentflament.com/blog/tag/openstack.html">OpenStack</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/operations.html">operations</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/pelican.html">Pelican</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/policies.html">Policies</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/printers.html">Printers</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/radeon.html">Radeon</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/raspberry-pi.html">Raspberry Pi</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/raspbian.html">Raspbian</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ring.html">Ring</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/rx-480.html">RX 480</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/sndh.html">SNDH</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ssh.html">SSH</a></li>
        <li class="m-tag-2"><a href="http://www.florentflament.com/blog/tag/swift.html">Swift</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/ubuntu.html">Ubuntu</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/virtualization.html">Virtualization</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/vm.html">VM</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/website-generator.html">Website generator</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/windows.html">Windows</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ym2149.html">YM2149</a></li>
        <li class="m-tag-3"><a href="http://www.florentflament.com/blog/tag/ym2149f.html">YM2149F</a></li>
        <li class="m-tag-1"><a href="http://www.florentflament.com/blog/tag/znc.html">ZNC</a></li>
      </ul>
    </nav>
  </div>
</div>
</main>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Florent Flament 2 cents. Powered by <a href="https://getpelican.com">Pelican</a> and <a href="https://mcss.mosra.cz">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>