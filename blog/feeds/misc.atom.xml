<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Florent Flament 2 cents - misc</title><link href="http://www.florentflament.com/blog/" rel="alternate"></link><link href="http://www.florentflament.com/blog/feeds/misc.atom.xml" rel="self"></link><id>http://www.florentflament.com/blog/</id><updated>2020-05-30T00:00:00+02:00</updated><entry><title>Ceph monitor status switching due to slow IOs</title><link href="http://www.florentflament.com/blog/ceph-monitor-status-switching-due-to-slow-ios.html" rel="alternate"></link><published>2020-05-30T00:00:00+02:00</published><updated>2020-05-30T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2020-05-30:/blog/ceph-monitor-status-switching-due-to-slow-ios.html</id><summary type="html">&lt;p&gt;I deployed a Ceph cluster (Nautilus, then upgraded to the Octopus
release) to store my personal data a few months ago. So far it has
been working pretty well, apart from a 1 hour partial outage that
won't be covered there, most probably linked to the issue described.&lt;/p&gt;
&lt;p&gt;That said â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;I deployed a Ceph cluster (Nautilus, then upgraded to the Octopus
release) to store my personal data a few months ago. So far it has
been working pretty well, apart from a 1 hour partial outage that
won't be covered there, most probably linked to the issue described.&lt;/p&gt;
&lt;p&gt;That said, I noticed that &lt;code&gt;mon.cephpi&lt;/code&gt; was seen down for a few seconds
every few minutes, and that it happened during leader elections. And
when &lt;code&gt;mon.cephpi&lt;/code&gt; goes back online, it seems triggers a new election a
few seconds after the previous one. (There &lt;code&gt;mon.cephpi&lt;/code&gt; is also a bit
low on disk space, but that's not related to the issue under
examination).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@ceph-mon0:/var/log/ceph# zgrep ^2020-05-30T00:5 ceph.log.1.gz | egrep &amp;quot;INF|WRN&amp;quot;
2020-05-30T00:50:54.874314+0200 mon.yumy (mon.1) 26519 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:50:54.907529+0200 mon.ceph-mon0 (mon.0) 27086 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:50:59.916206+0200 mon.ceph-mon0 (mon.0) 27087 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy in quorum (ranks 0,1)
2020-05-30T00:51:00.026583+0200 mon.ceph-mon0 (mon.0) 27092 : cluster [WRN] Health check failed: 1/3 mons down, quorum ceph-mon0,yumy (MON_DOWN)
2020-05-30T00:51:00.026770+0200 mon.ceph-mon0 (mon.0) 27093 : cluster [INF] Health check cleared: MON_DISK_LOW (was: mon cephpi is low on available space)
2020-05-30T00:51:00.129247+0200 mon.ceph-mon0 (mon.0) 27094 : cluster [WRN] overall HEALTH_WARN 1/3 mons down, quorum ceph-mon0,yumy
2020-05-30T00:51:06.174123+0200 mon.cephpi (mon.2) 250 : cluster [INF] mon.cephpi calling monitor election
2020-05-30T00:51:06.239131+0200 mon.yumy (mon.1) 26520 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:51:06.240313+0200 mon.ceph-mon0 (mon.0) 27102 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:51:06.286552+0200 mon.ceph-mon0 (mon.0) 27103 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy,cephpi in quorum (ranks 0,1,2)
2020-05-30T00:51:06.403610+0200 mon.ceph-mon0 (mon.0) 27108 : cluster [INF] Health check cleared: MON_DOWN (was: 1/3 mons down, quorum ceph-mon0,yumy)
2020-05-30T00:51:06.403837+0200 mon.ceph-mon0 (mon.0) 27109 : cluster [INF] Cluster is now healthy
2020-05-30T00:51:06.517425+0200 mon.ceph-mon0 (mon.0) 27110 : cluster [INF] overall HEALTH_OK
2020-05-30T00:51:11.180148+0200 mon.ceph-mon0 (mon.0) 27116 : cluster [WRN] Health check failed: mon cephpi is low on available space (MON_DISK_LOW)
2020-05-30T00:52:42.757032+0200 mon.cephpi (mon.2) 251 : cluster [INF] mon.cephpi calling monitor election
2020-05-30T00:52:42.847724+0200 mon.ceph-mon0 (mon.0) 27203 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:52:42.867228+0200 mon.yumy (mon.1) 26521 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:52:42.932928+0200 mon.ceph-mon0 (mon.0) 27204 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy,cephpi in quorum (ranks 0,1,2)
2020-05-30T00:52:43.223146+0200 mon.ceph-mon0 (mon.0) 27210 : cluster [WRN] overall HEALTH_WARN mon cephpi is low on available space
2020-05-30T00:56:46.567727+0200 mon.yumy (mon.1) 26522 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:56:46.589153+0200 mon.ceph-mon0 (mon.0) 27448 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:56:51.599236+0200 mon.ceph-mon0 (mon.0) 27449 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy in quorum (ranks 0,1)
2020-05-30T00:56:51.700268+0200 mon.ceph-mon0 (mon.0) 27454 : cluster [WRN] Health check failed: 1/3 mons down, quorum ceph-mon0,yumy (MON_DOWN)
2020-05-30T00:56:51.700470+0200 mon.ceph-mon0 (mon.0) 27455 : cluster [INF] Health check cleared: MON_DISK_LOW (was: mon cephpi is low on available space)
2020-05-30T00:56:51.801453+0200 mon.ceph-mon0 (mon.0) 27456 : cluster [WRN] overall HEALTH_WARN 1/3 mons down, quorum ceph-mon0,yumy
2020-05-30T00:57:04.048894+0200 mon.ceph-mon0 (mon.0) 27469 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:57:04.060391+0200 mon.yumy (mon.1) 26523 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:57:04.135749+0200 mon.ceph-mon0 (mon.0) 27470 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy,cephpi in quorum (ranks 0,1,2)
2020-05-30T00:57:04.322415+0200 mon.ceph-mon0 (mon.0) 27476 : cluster [INF] Health check cleared: MON_DOWN (was: 1/3 mons down, quorum ceph-mon0,yumy)
2020-05-30T00:57:04.322579+0200 mon.ceph-mon0 (mon.0) 27477 : cluster [INF] Cluster is now healthy
2020-05-30T00:57:05.149468+0200 mon.ceph-mon0 (mon.0) 27478 : cluster [INF] overall HEALTH_OK
2020-05-30T00:57:08.912387+0200 mon.ceph-mon0 (mon.0) 27483 : cluster [WRN] Health check failed: mon cephpi is low on available space (MON_DISK_LOW)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Sometimes, I was also seeing &lt;code&gt;check_auth_rotating possible clock skew,
rotating keys expired way too early&lt;/code&gt; messages in the logs of
non-monitor daemons (MDS, managers or OSD alike).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@cephpi:/var/log/ceph# zgrep &amp;#39;clock skew&amp;#39; ceph-osd.0.log.1.gz 
2020-05-30T00:56:56.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:56.555279+0200)
2020-05-30T00:56:56.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:56.556551+0200)
2020-05-30T00:56:57.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:57.555610+0200)
2020-05-30T00:56:57.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:57.556922+0200)
2020-05-30T00:56:58.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:58.555918+0200)
2020-05-30T00:56:58.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:58.557175+0200)
2020-05-30T00:56:59.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:59.556250+0200)
2020-05-30T00:56:59.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:59.557567+0200)
2020-05-30T00:57:00.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:00.556559+0200)
2020-05-30T00:57:00.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:00.557819+0200)
2020-05-30T00:57:01.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:01.556899+0200)
2020-05-30T00:57:01.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:01.558013+0200)
2020-05-30T00:57:02.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:02.557226+0200)
2020-05-30T00:57:02.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:02.558396+0200)
2020-05-30T00:57:03.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:03.557531+0200)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's focus on the time period between &lt;code&gt;2020-05-30T00:56:51&lt;/code&gt; and
&lt;code&gt;2020-05-30T00:57:04&lt;/code&gt;, i.e 00:56:51 and 00:57:04. Here's my assumption
about what happened:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;At 00:56:51 &lt;code&gt;mon.cephpi&lt;/code&gt; was seen down by &lt;code&gt;mon.ceph-mon0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;between 00:56:56 and 00:57:03 &lt;code&gt;ceph-osd@0&lt;/code&gt; obtained expired keys
  when trying to rotate them.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;At 00:57:04 &lt;code&gt;mon.cephpi&lt;/code&gt; was seen up by &lt;code&gt;mon.ceph-mon0&lt;/code&gt; and
  &lt;code&gt;ceph-osd@0&lt;/code&gt; could rotate its keys succesfully.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It looks like between 00:56:51 and 00:57:04 &lt;code&gt;mon.cephpi&lt;/code&gt; was out of
the quorum for 13 seconds and kept issuing expired keys to
&lt;code&gt;ceph-osd@0&lt;/code&gt; during that period.&lt;/p&gt;
&lt;p&gt;Let's have a look at the logs of &lt;code&gt;mon.cephpi&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Between 00:56:35 and 00:56:57, &lt;code&gt;mon.cephpi&lt;/code&gt; was apparently writing
  to its rocksdb database, and it took 22 seconds to write 49442280
  bytes (i.e 50MB). This is why it missed the leader election that
  happened between 00:56:46 and 00:56:51, which resulted in
  &lt;code&gt;mon.cephpi&lt;/code&gt; being flagged at down by the leader.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;At 00:56:57, when going back online, &lt;code&gt;mon.cephpi&lt;/code&gt; triggered a new
  election, which ended at 00:57:04, with &lt;code&gt;mon.cephpi&lt;/code&gt; being back in
  the monitors quorum, and able to issue valid keys again.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;2020-05-30T00:56:35.549+0200 ffffad98b400  4 rocksdb: [db/compaction_job.cc:1649] [default] Compaction start summary: Base version 1187 Base level 0, inputs: [48626(8490KB)], [48624(43MB)]
2020-05-30T00:56:35.549+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590792995552781, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;compaction_started&amp;quot;, &amp;quot;compaction_reason&amp;quot;: &amp;quot;ManualCompaction&amp;quot;, &amp;quot;files_L0&amp;quot;: [48626], &amp;quot;files_L6&amp;quot;: [48624], &amp;quot;score&amp;quot;: -1, &amp;quot;input_data_size&amp;quot;: 53833362}
2020-05-30T00:56:57.853+0200 ffffad98b400  4 rocksdb: [db/compaction_job.cc:1332] [default] [JOB 1188] Generated table #48627: 4687 keys, 49442280 bytes
2020-05-30T00:56:57.853+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793017855925, &amp;quot;cf_name&amp;quot;: &amp;quot;default&amp;quot;, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;table_file_creation&amp;quot;, &amp;quot;file_number&amp;quot;: 48627, &amp;quot;file_size&amp;quot;: 49442280, &amp;quot;table_properties&amp;quot;: {&amp;quot;data_size&amp;quot;: 49336024, &amp;quot;index_size&amp;quot;: 93526, &amp;quot;filter_size&amp;quot;: 11909, &amp;quot;raw_key_size&amp;quot;: 97594, &amp;quot;raw_average_key_size&amp;quot;: 20, &amp;quot;raw_value_size&amp;quot;: 49203175, &amp;quot;raw_average_value_size&amp;quot;: 10497, &amp;quot;num_data_blocks&amp;quot;: 2720, &amp;quot;num_entries&amp;quot;: 4687, &amp;quot;filter_policy_name&amp;quot;: &amp;quot;rocksdb.BuiltinBloomFilter&amp;quot;}}
2020-05-30T00:56:57.905+0200 ffffa797f400  1 mon.cephpi@2(electing) e14 collect_metadata :  no unique device id for : fallback method has no model nor serial&amp;#39;
2020-05-30T00:56:57.905+0200 ffffad98b400  4 rocksdb: [db/compaction_job.cc:1395] [default] [JOB 1188] Compacted 1@0 + 1@6 files to L6 =&amp;gt; 49442280 bytes
2020-05-30T00:56:58.001+0200 ffffad98b400  4 rocksdb: (Original Log Time 2020/05/30-00:56:58.003695) [db/compaction_job.cc:768] [default] compacted to: base level 6 level multiplier 10.00 max bytes base 268435456 files[0 0 0 0 0 0 1] max score 0.00, MB/sec: 2.4 rd, 2.2 wr, level 6, files in(1, 1) out(1) MB in(8.3, 43.0) out(47.2), read-write-amplify(11.9) write-amplify(5.7) OK, records in: 5202, records dropped: 515 output_compression: NoCompression
2020-05-30T00:56:58.001+0200 ffffad98b400  4 rocksdb: (Original Log Time 2020/05/30-00:56:58.003819) EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793018003758, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;compaction_finished&amp;quot;, &amp;quot;compaction_time_micros&amp;quot;: 22303522, &amp;quot;compaction_time_cpu_micros&amp;quot;: 1184121, &amp;quot;output_level&amp;quot;: 6, &amp;quot;num_output_files&amp;quot;: 1, &amp;quot;total_output_size&amp;quot;: 49442280, &amp;quot;num_input_records&amp;quot;: 5202, &amp;quot;num_output_records&amp;quot;: 4687, &amp;quot;num_subcompactions&amp;quot;: 1, &amp;quot;output_compression&amp;quot;: &amp;quot;NoCompression&amp;quot;, &amp;quot;num_single_delete_mismatches&amp;quot;: 0, &amp;quot;num_single_delete_fallthrough&amp;quot;: 0, &amp;quot;lsm_state&amp;quot;: [0, 0, 0, 0, 0, 0, 1]}
2020-05-30T00:56:58.005+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793018011605, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;table_file_deletion&amp;quot;, &amp;quot;file_number&amp;quot;: 48626}
2020-05-30T00:56:58.021+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793018027883, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;table_file_deletion&amp;quot;, &amp;quot;file_number&amp;quot;: 48624}
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:57:03.905+0200 ffffaa184400  1 paxos.2).electionLogic(33771) init, last seen epoch 33771, mid-election, bumping
2020-05-30T00:57:04.045+0200 ffffaa184400  1 mon.cephpi@2(electing) e14 collect_metadata :  no unique device id for : fallback method has no model nor serial&amp;#39;
2020-05-30T00:57:04.125+0200 ffffa797f400  1 mon.cephpi@2(electing) e14 collect_metadata :  no unique device id for : fallback method has no model nor serial&amp;#39;
2020-05-30T00:57:07.905+0200 ffffaa184400  1 mon.cephpi@2(peon).osd e4911 _set_new_cache_sizes cache_size:1020054731 inc_alloc: 71303168 full_alloc: 71303168 kv_alloc: 876609536
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's do a quick check to see if how long it takes for cephpi to write
on the monitor's partition:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@cephpi:~# time sh -c &amp;quot;dd if=/dev/zero of=test bs=1M count=50; sync&amp;quot;
50+0 records in
50+0 records out
52428800 bytes (52 MB, 50 MiB) copied, 9.84231 s, 5.3 MB/s

real    0m10.375s
user    0m0.001s
sys     0m0.290s
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Indeed, it takes &lt;code&gt;cephpi&lt;/code&gt; 10 seconds to write 50MB of zeros. Which
makes sense because it is a Raspberry Pi with a MicroSD card used to
store the monitor's database. On the other hand writing 50MB to a
standard spinning disk takes less than 2 seconds:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;svc@yumy:/tmp$ time sh -c &amp;quot;dd if=/dev/zero of=test bs=1M count=50; sync&amp;quot;
50+0 records in
50+0 records out
52428800 bytes (52 MB, 50 MiB) copied, 0.111206 s, 471 MB/s

real    0m1.492s
user    0m0.003s
sys 0m0.117s
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Resolution&lt;/h2&gt;
&lt;p&gt;I eventually plugged a USB disk on &lt;code&gt;cephpi&lt;/code&gt; to store &lt;code&gt;mon.cephpi&lt;/code&gt;
data. It has been running for a few hour now, without any &lt;code&gt;MON_DOWN&lt;/code&gt;
event, nor any leader election triggered.&lt;/p&gt;
&lt;p&gt;In conclusion, one should avoid using slow storage devices (i.e SD
cards or USB sticks) to store Ceph monitors data. Monitors need to
write chunks of data (of 50MB in this case) at regular intervals in
less than a few seconds (less than 5 seconds I guess); otherwise, they
end up switching in and out of the monitors quorum and triggering many
elections.&lt;/p&gt;</content><category term="misc"></category><category term="Ceph"></category></entry><entry><title>Attempting to mine Cryptocurrency with an old machine</title><link href="http://www.florentflament.com/blog/attempting-to-mine-cryptocurrency-with-an-old-machine.html" rel="alternate"></link><published>2019-04-13T00:00:00+02:00</published><updated>2019-04-13T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2019-04-13:/blog/attempting-to-mine-cryptocurrency-with-an-old-machine.html</id><summary type="html">&lt;p&gt;This is the story of me attempting to convert an old machine into a
Cryptocurrency miner. I basically tried to plug my AMD Radeon RX 480
graphic card into an old PC, a Core 2 duo with 4GB RAM and a
GF7050T-M5 motherboard.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;According to the &lt;a href="https://www.manualslib.com/manual/451735/Ecs-Gf7050vt-M5.html"&gt;GF7050T-M5 manual&lt;/a&gt;, its PCI â€¦&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;This is the story of me attempting to convert an old machine into a
Cryptocurrency miner. I basically tried to plug my AMD Radeon RX 480
graphic card into an old PC, a Core 2 duo with 4GB RAM and a
GF7050T-M5 motherboard.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;According to the &lt;a href="https://www.manualslib.com/manual/451735/Ecs-Gf7050vt-M5.html"&gt;GF7050T-M5 manual&lt;/a&gt;, its PCI Express bus is most
  probably a PCI Express 1.0 x16 bus.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;While the &lt;a href="https://www.diamondmm.com/images/480X/RX480D58G%20%20setup%20sheet.pdf"&gt;AMD Radeon RX 480&lt;/a&gt; has a PCI Express 3.0 x16
  interface.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/PCI_Express"&gt;Wikipedia's PCI Express pages&lt;/a&gt; is not very clear regarding the
compatibility between PCI Express 3.0 and 1.0. At the very least, the
PCI Express 3.0 card fits into the PCI Express 1.0 slot. In the end, I
couldn't have the card working properly on the machine, though I did a
number of interesting findings.&lt;/p&gt;
&lt;h2&gt;Booting on USB key&lt;/h2&gt;
&lt;p&gt;I made several OS installations (Ubuntu) on the machine using a
rewritable DVD-RW, because I failed to boot on a USB key. After
spending a bunch of time exploring the BIOS menu, I figured out that
the board allowed booting on USB keys with the following settings (in
the correct order):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;USB Legacy enabled&lt;/li&gt;
&lt;li&gt;Reboot, to have the USB key recognized by the BIOS&lt;/li&gt;
&lt;li&gt;First hard drive set to the USB key&lt;/li&gt;
&lt;li&gt;First boot device set to the USB key&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This allowed much faster iterations, especially because I had to
remove the Radeon card to plug the DVD reader (The connector is placed
below the card, once plugged).&lt;/p&gt;
&lt;h2&gt;Working text mode&lt;/h2&gt;
&lt;p&gt;Ubuntu 18.04 desktop, 18.04 server and 16.04 desktop installs load the
&lt;code&gt;amdgpu&lt;/code&gt; driver at some point during boot time. When the Radeon RX 480
is plugged in the machine, the screen turns black at this moment. This
looks like the machine is completely crashed, but only the display is
actually missing. I can still connect to the machine through SSH
(having setup an SSH server before plugging the Radeon card).&lt;/p&gt;
&lt;p&gt;Ubuntu 16.04 server never loads the &lt;code&gt;amdgpu&lt;/code&gt; driver by default,
neither during the installation process, nor when booting on the
installed OS. I could install Ubuntu 16.04 server from a USB key and
run it properly, while the AMD Radeon card was plugged into the
machine.&lt;/p&gt;
&lt;h2&gt;Driver crash&lt;/h2&gt;
&lt;p&gt;Both &lt;code&gt;amdgpu&lt;/code&gt; and &lt;code&gt;amdgpu-pro&lt;/code&gt; drivers crashed when loaded, whatever
the OS version I used:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ubuntu 16.04.3&lt;/li&gt;
&lt;li&gt;Ubuntu 16.04.5&lt;/li&gt;
&lt;li&gt;Ubuntu 18.04.2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The following trace is a typical one obtained from &lt;code&gt;dmesg&lt;/code&gt; when
loading the &lt;code&gt;amdgpu&lt;/code&gt; module. This one was obtained after having
installed the &lt;code&gt;amdgpu-pro-17.40&lt;/code&gt; driver on Ubuntu 16.04.3:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ dmesg | grep &amp;quot;\[drm&amp;quot;
[    1.266917] [drm] Initialized drm 1.1.0 20060810
[    1.420705] [drm] amdgpu kernel modesetting enabled.
[    1.450320] [drm] initializing kernel modesetting (POLARIS10 0x1002:0x67DF 0x1002:0x0B37 0xC7).
[    1.450338] [drm] register mmio base: 0xFEBC0000
[    1.450342] [drm] register mmio size: 262144
[    1.450353] [drm] probing gen 2 caps for device 10de:56e = 113d01/0
[    1.450358] [drm] probing mlw for device 10de:56e = 113d01
[    1.450372] [drm] UVD is enabled in VM mode
[    1.450376] [drm] VCE enabled in VM mode
[    1.451068] [drm] GPU post is not needed
[    1.451090] [drm] vm size is 32 GB, block size is 13-bit, fragment size is 4-bit
[    1.451169] [drm] Detected VRAM RAM=8192M, BAR=256M
[    1.451173] [drm] RAM width 256bits GDDR5
[    1.451281] [drm] amdgpu: 8192M of VRAM memory ready
[    1.451286] [drm] amdgpu: 8192M of GTT memory ready.
[    1.451299] [drm] GART: num cpu pages 65536, num gpu pages 65536
[    1.451347] [drm] PCIE GART of 256M enabled (table at 0x000000F400040000).
[    1.451466] [drm] amdgpu: irq initialized.
[    1.623059] [drm] Chained IB support enabled!
[    1.624743] [drm] Found UVD firmware Version: 1.79 Family ID: 16
[    1.625444] [drm] Found VCE firmware Version: 52.4 Binary ID: 3
[    1.673073] [drm:amdgpu_mm_wdoorbell [amdgpu]] *ERROR* writing beyond doorbell aperture: 0x000001e8!
[    1.678312] [drm] DAL is enabled
[    1.678667] [drm] DM_PPLIB: values for Engine clock
[    1.678671] [drm] DM_PPLIB:   30000
[    1.678675] [drm] DM_PPLIB:   60800
[    1.678678] [drm] DM_PPLIB:   91000
[    1.678681] [drm] DM_PPLIB:   107700
[    1.678685] [drm] DM_PPLIB:   114500
[    1.678688] [drm] DM_PPLIB:   119100
[    1.678691] [drm] DM_PPLIB:   123600
[    1.678695] [drm] DM_PPLIB:   126600
[    1.678698] [drm] DM_PPLIB: Warning: using default validation clocks!
[    1.678702] [drm] DM_PPLIB: Validation clocks:
[    1.678706] [drm] DM_PPLIB:    engine_max_clock: 72000
[    1.678709] [drm] DM_PPLIB:    memory_max_clock: 80000
[    1.678713] [drm] DM_PPLIB:    level           : 0
[    1.678717] [drm] DM_PPLIB: reducing engine clock level from 8 to 2
[    1.678721] [drm] DM_PPLIB: values for Memory clock
[    1.678725] [drm] DM_PPLIB:   30000
[    1.678728] [drm] DM_PPLIB:   200000
[    1.678732] [drm] DM_PPLIB: Warning: using default validation clocks!
[    1.678735] [drm] DM_PPLIB: Validation clocks:
[    1.678739] [drm] DM_PPLIB:    engine_max_clock: 72000
[    1.678742] [drm] DM_PPLIB:    memory_max_clock: 80000
[    1.678746] [drm] DM_PPLIB:    level           : 0
[    1.678750] [drm] DM_PPLIB: reducing memory clock level from 2 to 1
[    1.678755] [drm] DC: create_links: connectors_num: physical:4, virtual:0
[    1.678764] [drm] Connector[0] description:signal 32
[    1.678771] [drm] Using channel: CHANNEL_ID_DDC1 [1]
[    1.678788] [drm] Connector[1] description:signal 32
[    1.678794] [drm] Using channel: CHANNEL_ID_DDC3 [3]
[    1.678810] [drm] Connector[2] description:signal 32
[    1.678815] [drm] Using channel: CHANNEL_ID_DDC2 [2]
[    1.678831] [drm] Connector[3] description:signal 4
[    1.678837] [drm] Using channel: CHANNEL_ID_DDC4 [4]
[    1.692079] [drm] Display Core initialized
[    1.692095] [drm] amdgpu: freesync_module init done ffff8800ca602700.
[    1.692603] [drm] link=0, dc_sink_in=          (null) is now Disconnected
[    1.692609] [drm] DCHPD: connector_id=0: dc_sink didn&amp;#39;t change.
[    1.693057] [drm] link=1, dc_sink_in=          (null) is now Disconnected
[    1.693062] [drm] DCHPD: connector_id=1: dc_sink didn&amp;#39;t change.
[    1.693490] [drm] link=2, dc_sink_in=          (null) is now Disconnected
[    1.693495] [drm] DCHPD: connector_id=2: dc_sink didn&amp;#39;t change.
[    1.718488] [drm] [Detect]   [HDMIA][ConnIdx:3] SAMSUNG: [Block 0] 00 FF FF FF FF FF FF 00 4C 2D A4 02 00 00 00 00 2E 10 01 03 80 10 09 8C 0A E2 BD A1 5B 4A 98 24 15 47 4A A1 08 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 66 21 50 B0 51 00 1B 30 40 70 36 00 A0 5A 00 00 00 1E 01 1D 00 72 51 D0 1E 20 6E 28 55 00 A0 5A 00 00 00 1E 00 00 00 FD 00 31 47 0F 32 09 00 0A 20 20 20 20 20 20 00 00 00 FC 00 53 41 4D 53 55 4E 47 0A 20 20 20 20 20 01 15 ^
[    1.718522] [drm] [Detect]   [HDMIA][ConnIdx:3] SAMSUNG: [Block 1] 02 03 1A F1 46 84 13 05 14 03 12 23 09 07 07 83 01 00 00 66 03 0C 00 20 00 80 01 1D 00 BC 52 D0 1E 20 B8 28 55 40 A0 5A 00 00 00 1E 01 1D 80 18 71 1C 16 20 58 2C 25 00 A0 5A 00 00 00 9E 01 1D 80 D0 72 1C 16 20 10 2C 25 80 A0 5A 00 00 00 9E 8C 0A D0 8A 20 E0 2D 10 10 3E 96 00 A0 5A 00 00 00 18 8C 0A D0 90 20 40 31 20 0C 40 55 00 A0 5A 00 00 00 18 00 00 00 00 00 00 00 00 00 00 00 69 ^
[    1.718542] [drm] dc_link_detect: manufacturer_id = 2D4C, product_id = 2A4, serial_number = 0, manufacture_week = 46, manufacture_year = 16, display_name = SAMSUNG, speaker_flag = 1, audio_mode_count = 1
[    1.718552] [drm] dc_link_detect: mode number = 0, format_code = 1, channel_count = 1, sample_rate = 7, sample_size = 7
[    1.718559] [drm] link=3, dc_sink_in=ffff880034b69000 is now Connected
[    1.718564] [drm] DCHPD: connector_id=3: Old sink=          (null) New sink=ffff880034b69000
[    1.718588] [drm] Supports vblank timestamp caching Rev 2 (21.10.2013).
[    1.718592] [drm] Driver supports precise vblank timestamp query.
[    1.718596] [drm] KMS initialized.
[    1.721322] [drm:amdgpu_mm_wdoorbell [amdgpu]] *ERROR* writing beyond doorbell aperture: 0x00000020!
[    1.721372] [drm:amdgpu_mm_wdoorbell [amdgpu]] *ERROR* writing beyond doorbell aperture: 0x00000020!
[    1.909995] [drm:gfx_v8_0_ring_test_ring [amdgpu]] *ERROR* amdgpu: ring 0 test failed (scratch(0xC040)=0xCAFEDEAD)
[    1.910050] [drm:amdgpu_device_init [amdgpu]] *ERROR* hw_init of IP block &amp;lt;gfx_v8_0&amp;gt; failed -22
[    2.047138] [drm] amdgpu: ttm finalized
[    2.047152] [drm] amdgpu: finishing device.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;When trying to google for the error messages like &lt;code&gt;*ERROR* writing
beyond doorbell aperture&lt;/code&gt;, the only pages found were the &lt;a href="https://github.com/torvalds/linux/blob/master/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c"&gt;Linux source
code on github&lt;/a&gt;. This makes me believe that only a few people tried
such a crazy experiment. Therefore, it would probably require a
significant effort (that may not be worth) to have this setup working.&lt;/p&gt;
&lt;h2&gt;Giving up&lt;/h2&gt;
&lt;p&gt;After having messed around a few days (I even tried to plug the power
supply from a computer where the Radeon card is working well, with no
better outcome), I decided to plug the graphic card back to the
computer it was shipped with. At least, it is still working ; )&lt;/p&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.manualslib.com/manual/451735/Ecs-Gf7050vt-M5.html"&gt;GF7050T-M5 manual&lt;/a&gt; is available online.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.amd.com/en/products/graphics/radeon-rx-480"&gt;AMD Radeon RX 480 specifications&lt;/a&gt; are available too.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.diamondmm.com/images/480X/RX480D58G%20%20setup%20sheet.pdf"&gt;Diamond AMD Radeon RX 480 specs&lt;/a&gt; provide a bit more details.&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="AMD"></category><category term="Radeon"></category><category term="RX 480"></category><category term="GPU"></category><category term="Old Hardware"></category><category term="Cryptocurrency"></category><category term="GF7050T-M5"></category></entry><entry><title>AMD RX 480 GPU OpenCL benchmark</title><link href="http://www.florentflament.com/blog/amd-rx-480-gpu-opencl-benchmark.html" rel="alternate"></link><published>2018-12-25T00:00:00+01:00</published><updated>2018-12-25T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2018-12-25:/blog/amd-rx-480-gpu-opencl-benchmark.html</id><summary type="html">&lt;p&gt;This post summarizes the results of my &lt;a href="https://github.com/FlorentFlament/amd-gpu-benchmark"&gt;AMD GPU benchmark code&lt;/a&gt; to
benchmark the computing power of an AMD Radeon RX 480 GPU against an
Intel Core i5-7400 CPU.&lt;/p&gt;
&lt;p&gt;The benchmarking code I am running on is the following code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;__kernel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kerntest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__global&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;loops_cnt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id â€¦&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;This post summarizes the results of my &lt;a href="https://github.com/FlorentFlament/amd-gpu-benchmark"&gt;AMD GPU benchmark code&lt;/a&gt; to
benchmark the computing power of an AMD Radeon RX 480 GPU against an
Intel Core i5-7400 CPU.&lt;/p&gt;
&lt;p&gt;The benchmarking code I am running on is the following code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;__kernel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kerntest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__global&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;loops_cnt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;get_global_id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;loops_cnt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;95&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;char&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The operation we will be counting is the one in the loop:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;tmp = (2*tmp + id) % 95;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The following graph has been generated by gnuplot:&lt;/p&gt;
&lt;p&gt;&lt;img src="static/benchmark-results.png" alt="AMD GPU vs CPU benchmark results"/&gt;&lt;/p&gt;
&lt;p&gt;It displays on a loglog scale the number of operations performed
during a given period for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a single CPU&lt;/li&gt;
&lt;li&gt;a single GPU worker&lt;/li&gt;
&lt;li&gt;many GPU workers (from 10,000 to 1 Million)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each dot corresponds to a sample, i.e the number of operations
performed during the corresponding period. Each line is the linear
approximation of the corresponding points.&lt;/p&gt;
&lt;p&gt;A couple of statistics are printed by gnuplot:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;Millions&lt;/span&gt; &lt;span class="n"&gt;operations&lt;/span&gt; &lt;span class="n"&gt;per&lt;/span&gt; &lt;span class="k"&gt;second&lt;/span&gt; &lt;span class="o"&gt;=-&lt;/span&gt;
&lt;span class="n"&gt;CPU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;152&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="n"&gt;many&lt;/span&gt; &lt;span class="n"&gt;workers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;44045&lt;/span&gt;

&lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;Ratios&lt;/span&gt; &lt;span class="o"&gt;=-&lt;/span&gt;
&lt;span class="n"&gt;CPU&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;45&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="n"&gt;many&lt;/span&gt; &lt;span class="n"&gt;workers&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;CPU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;287&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="n"&gt;many&lt;/span&gt; &lt;span class="n"&gt;workers&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;13081&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This means that in 1 second:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The CPU performed 152 Millions operations.&lt;/li&gt;
&lt;li&gt;The GPU using 1 worker performed 3 Millions operations.&lt;/li&gt;
&lt;li&gt;The GPU using many workers performed 44 Billions operations.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We also computed of couple of ratios, to compare these different
results:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The CPU performs 45 times more operations than a single GPU worker.&lt;/li&gt;
&lt;li&gt;The GPU with many workers performs 287 times more operations.&lt;/li&gt;
&lt;li&gt;the GPU with many workers performs 13081 times more operations than
  when using only 1 worker on the same GPU.&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="AMD"></category><category term="Radeon"></category><category term="RX 480"></category><category term="GPU"></category><category term="OpenCL"></category><category term="Benchmark"></category></entry><entry><title>Installing a Vanilla Linux Kernel on Fedora</title><link href="http://www.florentflament.com/blog/installing-a-vanilla-linux-kernel-on-fedora.html" rel="alternate"></link><published>2017-11-19T00:00:00+01:00</published><updated>2017-11-19T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2017-11-19:/blog/installing-a-vanilla-linux-kernel-on-fedora.html</id><summary type="html">&lt;p&gt;Updated on 2017-12-28&lt;/p&gt;
&lt;p&gt;Installing a Vanilla Linux Kernel on Fedora is quite simple (once one
knows how to do it..)&lt;/p&gt;
&lt;h2&gt;Configuring &amp;amp; Building Linux&lt;/h2&gt;
&lt;p&gt;One can start by cloning Torvalds' Linux repository to fetch the
latest master (or we could fetch the latest stable release) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ git clone https://github.com/torvalds â€¦&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Updated on 2017-12-28&lt;/p&gt;
&lt;p&gt;Installing a Vanilla Linux Kernel on Fedora is quite simple (once one
knows how to do it..)&lt;/p&gt;
&lt;h2&gt;Configuring &amp;amp; Building Linux&lt;/h2&gt;
&lt;p&gt;One can start by cloning Torvalds' Linux repository to fetch the
latest master (or we could fetch the latest stable release) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ git clone https://github.com/torvalds/linux.git
$ cd linux
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I like setting &lt;code&gt;EXTRAVERSION&lt;/code&gt; in the &lt;code&gt;Makefile&lt;/code&gt; to be able to identify
which kernel I am testing. That can be done by opening the &lt;code&gt;Makefile&lt;/code&gt;
with one's favorite editor or replacing the &lt;code&gt;EXTRAVERSION&lt;/code&gt; line with
&lt;code&gt;sed&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sed -i &amp;quot;s/^EXTRAVERSION = .*$/EXTRAVERSION = name_of_my_version/&amp;quot; Makefile
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now we need to generate the &lt;code&gt;.config&lt;/code&gt; Linux kernel configuration
file. We can start from the default one:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ make defconfig
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Or we can reuse configuration files from the local installation with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ make olddefconfig
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that &lt;code&gt;make help&lt;/code&gt; provides the list of possible &lt;code&gt;make&lt;/code&gt; commands.&lt;/p&gt;
&lt;p&gt;For computers using (U)EFI, one may need to update the &lt;code&gt;.config&lt;/code&gt; file
to support &lt;code&gt;EFI handover&lt;/code&gt;. This is done by setting &lt;code&gt;EFI stub support&lt;/code&gt;
when configuring the kernel (for instance with &lt;code&gt;make menuconfig&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Processor type and features  ---&amp;gt;
    [*] EFI runtime service support
    [*]   EFI stub support
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Sources: &lt;a href="https://stackoverflow.com/questions/40344484/cant-load-self-compiled-linux-kernel#40344635"&gt;stackoverflow&lt;/a&gt; and &lt;a href="https://wiki.gentoo.org/wiki/EFI_stub_kernel#Configuration"&gt;gentoo linux wiki&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Without that option activated, I ended up having the following error
message when trying to boot my new kernel:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;error: kernel doesn&amp;#39;t support EFI handover
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This option isn't required when building a kernel for a virtual
machine.&lt;/p&gt;
&lt;p&gt;In order to compile the kernel, (at least) the following dependencies
are required:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;gcc&lt;/li&gt;
&lt;li&gt;ncurses-devel&lt;/li&gt;
&lt;li&gt;elfutils-libelf-devel&lt;/li&gt;
&lt;li&gt;openssl-devel&lt;/li&gt;
&lt;li&gt;perl-interpreter&lt;/li&gt;
&lt;li&gt;rpm-build (if building rpm packages)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then we can build the kernel as simply as that:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ make
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The straight forward approach to install the Kernel, if it has been
built on the target machine is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo make install
$ sudo make modules_install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We can now reboot on the newly built Kernel.&lt;/p&gt;
&lt;h2&gt;Building RPM package&lt;/h2&gt;
&lt;p&gt;We can even make RPMs to install the new kernel on any RPM based
machine:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ make binrpm-pkg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The packages are available in the &lt;code&gt;~/rpmbuild/RPMS/x86_64&lt;/code&gt; directory:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ls ~/rpmbuild/RPMS/x86_64/
kernel-4.14.0efistub+-3.x86_64.rpm  kernel-headers-4.14.0efistub+-3.x86_64.rpm
$
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The newly built kernel can be installed with the standard rpm install
command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ cd ~/rpmbuild/RPMS/x86_64/
$ sudo rpm -i kernel-4.14.0efistub+-3.x86_64.rpm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That's it, when rebooting, the new kernel is available in the grub
menu (together with the previously installed kernels) .&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ dmesg | head -3
[    0.000000] microcode: microcode updated early to revision 0x1c, date = 2015-02-26
[    0.000000] Linux version 4.14.0efistub+ (florent@amn) (gcc version 7.2.1 20170915 (Red Hat 7.2.1-2) (GCC)) #3 SMP Sun Nov 19 22:52:23 CET 2017
[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-4.14.0efistub+ root=/dev/mapper/fedora-root ro rd.lvm.lv=fedora/root rd.lvm.lv=fedora/swap rhgb quiet LANG=en_US.UTF-8
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Tested with Linux 4.14.0 hash ed30b147e1f6e396e70a52dbb6c7d66befedd786&lt;/p&gt;</content><category term="misc"></category><category term="Linux"></category><category term="Kernel"></category></entry><entry><title>A couple of statistics about Linux kernel documentation</title><link href="http://www.florentflament.com/blog/a-couple-of-statistics-about-linux-kernel-documentation.html" rel="alternate"></link><published>2017-03-04T00:00:00+01:00</published><updated>2017-03-04T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2017-03-04:/blog/a-couple-of-statistics-about-linux-kernel-documentation.html</id><summary type="html">&lt;p&gt;There is a whole lot of files in the &lt;code&gt;Documentation&lt;/code&gt; directory of the
&lt;a href="https://github.com/torvalds/linux"&gt;Linux kernel source&lt;/a&gt;. Is it possible for a single person to read
the whole documentation ? Let's have a look at what's inside it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;pwd&lt;/span&gt;
/home/florent/src/linux/linux-4.10/Documentation

$ find . -type f &lt;span class="p"&gt;|&lt;/span&gt; wc -l
&lt;span class="m"&gt;5118 â€¦&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;There is a whole lot of files in the &lt;code&gt;Documentation&lt;/code&gt; directory of the
&lt;a href="https://github.com/torvalds/linux"&gt;Linux kernel source&lt;/a&gt;. Is it possible for a single person to read
the whole documentation ? Let's have a look at what's inside it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;pwd&lt;/span&gt;
/home/florent/src/linux/linux-4.10/Documentation

$ find . -type f &lt;span class="p"&gt;|&lt;/span&gt; wc -l
&lt;span class="m"&gt;5118&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;There are 5118 files in the Documentation directory&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ wc  &lt;span class="k"&gt;$(&lt;/span&gt;find . -type f&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; tail -1
  &lt;span class="m"&gt;661911&lt;/span&gt;  &lt;span class="m"&gt;3175886&lt;/span&gt; &lt;span class="m"&gt;24210712&lt;/span&gt; total
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;These files account for roughly 3.200.000 words spread among 660.000
lines. With a &lt;a href="https://en.wikipedia.org/wiki/Word_count"&gt;typical novel's size&lt;/a&gt; of 70.000 words, the Linux
documentation is equivalent to roughly 46 such novels. So the answer
is yes, it is possible to read the whole Linux documentation (though
it may take some time).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ find . -type f &lt;span class="p"&gt;|&lt;/span&gt; awk -F. &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;print $3&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; sort -n &lt;span class="p"&gt;|&lt;/span&gt; tail -5
     &lt;span class="m"&gt;24&lt;/span&gt; tmpl
     &lt;span class="m"&gt;30&lt;/span&gt; svg
     &lt;span class="m"&gt;650&lt;/span&gt; rst
     &lt;span class="m"&gt;703&lt;/span&gt;
     &lt;span class="m"&gt;3565&lt;/span&gt; txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Just to have an idea of the most common files' extensions. Mostly
&lt;code&gt;.txt&lt;/code&gt; files, plus some extensionless and &lt;code&gt;.rst&lt;/code&gt; files.&lt;/p&gt;
&lt;p&gt;Let's consider the 3 main topics as documented in the &lt;a href="https://raw.githubusercontent.com/torvalds/linux/master/Documentation/index.rst"&gt;&lt;code&gt;index.rst&lt;/code&gt;
file&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ wc admin-guide/* &lt;span class="p"&gt;|&lt;/span&gt; tail -1
 &lt;span class="m"&gt;14131&lt;/span&gt;  &lt;span class="m"&gt;73455&lt;/span&gt; &lt;span class="m"&gt;517546&lt;/span&gt; total
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;73.000 words (1 novel) for the 'User-oriented documentation'.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ wc process/* dev-tools/* doc-guide/* &lt;span class="p"&gt;|&lt;/span&gt; tail -1
 &lt;span class="m"&gt;11899&lt;/span&gt;  &lt;span class="m"&gt;72020&lt;/span&gt; &lt;span class="m"&gt;487333&lt;/span&gt; total
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;72.000 words (1 novel) for the 'Introduction to kernel development'.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ wc &lt;span class="k"&gt;$(&lt;/span&gt;find driver-api/ core-api/ media/ gpu/ security/ sound/ crypto/ -type f&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; tail -1
 &lt;span class="m"&gt;132770&lt;/span&gt;  &lt;span class="m"&gt;516405&lt;/span&gt; &lt;span class="m"&gt;4740930&lt;/span&gt; total
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;520.000 word (Roughly &lt;a href="https://electricliterature.com/infographic-word-counts-of-famous-books-161f025a6b09"&gt;equilvalent to reading 'The Lord of the
Rings'&lt;/a&gt;) for the 'Kernel API documentation'.&lt;/p&gt;</content><category term="misc"></category><category term="Linux"></category><category term="Kernel"></category><category term="Documentation"></category></entry><entry><title>Playing SNDH on YM2149</title><link href="http://www.florentflament.com/blog/playing-sndh-on-ym2149.html" rel="alternate"></link><published>2016-10-15T00:00:00+02:00</published><updated>2016-10-15T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2016-10-15:/blog/playing-sndh-on-ym2149.html</id><summary type="html">&lt;p&gt;This is the sequel of the &lt;a href="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html"&gt;Streaming music to YM2149&lt;/a&gt; post. After
playing YM chip tunes on the YM2149, I wanted to take profit from the
&lt;a href="http://sndh.atari.org/"&gt;super large database of SNDH files available online&lt;/a&gt;, by being
able to play these tunes on my YM2149. This has been possible with the â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;This is the sequel of the &lt;a href="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html"&gt;Streaming music to YM2149&lt;/a&gt; post. After
playing YM chip tunes on the YM2149, I wanted to take profit from the
&lt;a href="http://sndh.atari.org/"&gt;super large database of SNDH files available online&lt;/a&gt;, by being
able to play these tunes on my YM2149. This has been possible with the
help of &lt;a href="https://sourceforge.net/projects/sc68/"&gt;the SC68 emulator&lt;/a&gt;. &lt;code&gt;sc68&lt;/code&gt; can interpret &lt;code&gt;sndh&lt;/code&gt; files and
generate a dump of the samples to be played on the chip. While most
&lt;code&gt;sndh&lt;/code&gt; files can be played by using the &lt;a href="https://github.com/FlorentFlament/ym2149-sndh"&gt;ym2149-sndh firmware and
scripts&lt;/a&gt; available on GitHub, there are still a number of files
that can't be played yet. This will be further discussed in the
limitations section. A video of the &lt;a href="https://www.youtube.com/watch?v=JjofS8wdNEY"&gt;ATmega playing a Relix tune on
the YM2149&lt;/a&gt; is available.&lt;/p&gt;
&lt;h2&gt;New hardware design&lt;/h2&gt;
&lt;p&gt;The previous circuit design described in &lt;a href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html"&gt;Driving YM2149F sound chip
with an Arduino&lt;/a&gt; would work for playing SNDH files. But I couldn't
resist adding LEDs blinking in rhythm with the music played on the
chip, hence this new design ; ). Since I am now using 2 timers to
generate the 3 PWM signals used to light the LEDs + 1 timer to
synchronize the samples, I added a 4 MHz oscillator feeding the YM2149
to generate its output (I used 1 of the 3 timers available on the
ATmega to generate a 2 MHz clock in my former design). Besides, I
replaced the Uno with a Nano, which fits on the bread board.&lt;/p&gt;
&lt;p&gt;Hence this new schematic:&lt;/p&gt;
&lt;p&gt;&lt;img src="static/ym2149-schematic-v2.png" alt="YM2149 schematic V2"/&gt;&lt;/p&gt;
&lt;p&gt;And the much nicer circuit there:&lt;/p&gt;
&lt;p&gt;&lt;img src="static/ym2149-pic-v2.png" alt="YM2149 driven by Arduino Nano V2"/&gt;&lt;/p&gt;
&lt;h2&gt;Samples format&lt;/h2&gt;
&lt;p&gt;Though I am super happy with my brand new circuit, the biggest change
is in the firmware running on the AVR. It contains more logic, because
it bufferizes samples coming from the UART, and sends them to the
YM2149 at the good timing.&lt;/p&gt;
&lt;p&gt;The current implementation is based on the following mechanism. A tune
is sent to the YM2149/ATmega board as a stream of samples, where each
sample has the following format:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;2 bytes timestamp: This timestamp determines when the sample will be
  sent to the YM2149. The value corresponds to a number of YM clock
  cycles modulo 2^16. We can afford using a 2 bytes timestamp, because
  what really matters is the timestamp difference between 2 successive
  samples. This means that 2 samples can be theoretically spaced by 1
  to 65536 YM clock cycles @2 MHz; so the maximum interval between 2
  samples is 32 ms, corresponding to a minimum frequency of 31 Hz. This
  is ok because most SNDH tunes refresh some registers at least at
  50 Hz, and we can add empty samples if we really need.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2 bytes per register to update (from 0 to 16 registers, though only
  the 14 first registers are meaningful to play sound on the chip): 1
  byte address, identifying the register to update; 1 byte value,
  corresponding to the value that has to be stored at the address
  specified right before&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;1 'end of sample' byte (0xff): This byte indicates the end of a
  sample.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As a result, the smallest 'useful' sample is 5 bytes long for 1
register update; a 2 registers update sample is 7 bytes long; and the
longest sample is 31 bytes long (3 + 2*14, not considering registers
15 &amp;amp; 16).&lt;/p&gt;
&lt;h2&gt;Limitations&lt;/h2&gt;
&lt;p&gt;The bottleneck to play sndh tunes to the YM2149 chip is the speed at
which we can update the chip's registers. New tunes use so called
'digital' sounds, that may have intervals as small as 90 clock cycles
(i.e 22 KHz).&lt;/p&gt;
&lt;p&gt;We have 2 limitations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The speed at which the AVR can get a sample from the UART and update
  the YM2149 registers. Let's consider a 1 register sample of 5 bytes
  length. With this implementation, the AVR needs around 150 AVR clock
  cycles (@16 MHz) to transfer 1 byte from the UART to the buffer,
  hence 750 clock cycles for 5 bytes. Then it needs some additional
  300 clock cycles (rough estimate) to update the YM register from the
  data stored in the buffer. Therefore, we need a total of 1050 clock
  cycles @16 MHz per sample, corresponding to 131 clock cycles at 2
  MHz, or 15 KHz max for digital sounds.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The UART speed. The ATmega328p together with the CH340 USB to serial
  chip can transfer data at a 1 Mbps rate without error (There is a 2x
  speed mode in the ATmega, but I incurred a significant amount of
  errors on the data transferred at that speed). With 10 bits per
  byte, the theoretical transfer rate is 100 KBytes/sec. In practice,
  the maximum speed depends on the size of data blocks sent (processes
  context switching on the OS is very expensive when doing I/Os with
  small blocks). I reached around 60 KBytes/sec using a 1500 buffer in
  the AVR. Considering 5 bytes per sample, we can stream samples at a
  maximum speed of 12 KHz.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With this implementation and its corresponding limitations, we can
play digital sounds at up to 12 KHz. This can be improved by many ways:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;by optimizing/redesign the code running on the AVR to reduce the
  number of cycles needed per sample&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;by reworking the samples format to reduce the average number bytes
  per sample, especially for small samples&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;by using a faster CPU, more RAM (bigger buffer), and possibly faster
  communication channel&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A first compromise would be to write a PC side code to downsample
tunes with a too high sample rate (i.e playing at 12 KHz sounds
normally played at 22 KHz). This would lower the sound quality of the
tunes downsampled, but would allow us to play them on this
YM2149/ATmega implementation.&lt;/p&gt;
&lt;p&gt;The schematic and &lt;a href="https://github.com/FlorentFlament/ym2149-sndh"&gt;source code to play sndh files on the YM2149&lt;/a&gt; is
available on GitHub.&lt;/p&gt;</content><category term="misc"></category><category term="Arduino"></category><category term="ATmega"></category><category term="YM2149"></category><category term="YM2149F"></category><category term="AY-3-8910"></category><category term="SNDH"></category></entry><entry><title>Streaming music to YM2149F</title><link href="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html" rel="alternate"></link><published>2016-09-10T00:00:00+02:00</published><updated>2016-09-10T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2016-09-10:/blog/streaming-music-to-ym2149f.html</id><summary type="html">&lt;p&gt;To follow-up on my previous blog post about &lt;a href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html"&gt;driving a YM2149F chip
with an Arduino&lt;/a&gt;, I wrote an Arduino firmware that can be used
together with a PC side Python script to send music to the
YM2149F. All the code is available in the &lt;a href="https://github.com/FlorentFlament/ym2149-streamer"&gt;ym2149-streamer
repository&lt;/a&gt; on GitHub.&lt;/p&gt;
&lt;h2&gt;Arduino Firmware â€¦&lt;/h2&gt;</summary><content type="html">&lt;p&gt;To follow-up on my previous blog post about &lt;a href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html"&gt;driving a YM2149F chip
with an Arduino&lt;/a&gt;, I wrote an Arduino firmware that can be used
together with a PC side Python script to send music to the
YM2149F. All the code is available in the &lt;a href="https://github.com/FlorentFlament/ym2149-streamer"&gt;ym2149-streamer
repository&lt;/a&gt; on GitHub.&lt;/p&gt;
&lt;h2&gt;Arduino Firmware&lt;/h2&gt;
&lt;p&gt;The first piece of code is the firmware. This is the code that runs in
the Arduino and drives the YM2149 chip. Most of the code is in the
&lt;code&gt;ym2149&lt;/code&gt; library, which exports functions such as &lt;code&gt;send_data(char
addr, char data)&lt;/code&gt; to write in the YM2149 registers, while complying
with the signals timings specified in the &lt;a href="http://www.ym2149.com/ym2149.pdf"&gt;YM2149 datasheet&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Basically, the firmware continuously reads the Arduino serial
line. Each time it has received 16 bytes, the firmware uses them to
set the 16 YM2149 registers (To be more precise only the first 14
registers are used, the 2 last registers are useless to play music).&lt;/p&gt;
&lt;p&gt;Note that this code is specific to the circuit, and depends on how the
Arduino is wired to the YM2149. It has been written for (and tested
with) the circuit described in the blog post about &lt;a href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html"&gt;driving the YM2149
from an Arduino&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;To flash the Arduino with the firmware:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;clone the &lt;a href="https://github.com/FlorentFlament/ym2149-streamer"&gt;ym2149-streamer repository&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;and launch &lt;code&gt;make flash&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A couple of libraries need to be installed in order for the firmware
to compile and be uploaded to the Arduino. To setup your environment,
one can follow the instruction of the &lt;a href="http://www.florentflament.com/blog/arduino-hello-world-without-ide.html"&gt;Arduino Hello World without
IDE&lt;/a&gt; blog post.&lt;/p&gt;
&lt;h2&gt;Playing music from a computer&lt;/h2&gt;
&lt;p&gt;What remains to be done, is sending to the Arduino, the values of the
registers to be set in the YM2149. Here we can build on the &lt;a href="http://leonard.oxg.free.fr/ymformat.html"&gt;YM file
format created by Arnaud CarrÃ©&lt;/a&gt;. The file format is quite straight
forward. It contains a header providing all the required information
about the tune, then a snapshot of the YM2149's 16 registers at
regular intervals (usually 50 times per second). To play the tune, we
have to send back the content of the YM2149 registers (sometimes
referred as the samples) at the appropriate frequency.&lt;/p&gt;
&lt;p&gt;I wrote a small Python script, available in the &lt;a href="https://github.com/FlorentFlament/ym2149-streamer"&gt;ym2149-streamer
repository&lt;/a&gt;, that parses a YM file and sends it to the Arduino
board. The syntax is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ python streamer.py &amp;lt;output_device&amp;gt; &amp;lt;ym_filepath&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that &lt;code&gt;streamer.py&lt;/code&gt; may work with other circuits driving a
YM2149. The only thing required is that the circuit be able to receive
a stream of YM2149's registers snapshots and send it to the chip each
time it receives a sample.&lt;/p&gt;
&lt;p&gt;To illustrate this work, I published a video of the &lt;a href="https://www.youtube.com/watch?v=MTRJdDbY048"&gt;YM2149F playing
Lemmings&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A &lt;a href="http://pacidemo.planet-d.net/html.html"&gt;large YM tunes archive&lt;/a&gt; allows playing old school musics on the
YM2149 chip. Note that the files in the zip archives are compressed
with &lt;code&gt;lha&lt;/code&gt; (which can be installed through the Fedora &lt;code&gt;lha&lt;/code&gt;
package). Therefore, one has to uncompress the &lt;code&gt;ym&lt;/code&gt; files before
playing them with &lt;code&gt;streamer.py&lt;/code&gt;. I may try to handle the decompression
directly in the script some day.&lt;/p&gt;
&lt;p&gt;Besides, another &lt;a href="http://sndh.atari.org/"&gt;large archive of Atari ST music&lt;/a&gt; is around there,
with a more dynamic community. Though the tunes are in the &lt;code&gt;sndh&lt;/code&gt;
format, which is harder to interpret and stream to a YM2149 chip. A
nice thing would be to find a way to have these &lt;code&gt;sndh&lt;/code&gt; files played on
the sound chip!&lt;/p&gt;</content><category term="misc"></category><category term="Arduino"></category><category term="YM2149"></category><category term="YM2149F"></category><category term="AY-3-8910"></category></entry><entry><title>Driving YM2149F sound chip with an Arduino</title><link href="http://www.florentflament.com/blog/driving-ym2149f-sound-chip-with-an-arduino.html" rel="alternate"></link><published>2016-09-03T00:00:00+02:00</published><updated>2016-09-03T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2016-09-03:/blog/driving-ym2149f-sound-chip-with-an-arduino.html</id><summary type="html">&lt;p&gt;A few months ago, I had the opportunity to get a Yamaha YM2149F
chip. This chip is basically a clone of &lt;a href="https://en.wikipedia.org/wiki/General_Instrument_AY-3-8910"&gt;General Instrument's
AY-3-8910&lt;/a&gt;, "a 3 voices programmable sound generator" widely used
in the 80's in many arcade games and home computers (including the
Atari ST and Amstrad CPC).&lt;/p&gt;
&lt;p&gt;The â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;A few months ago, I had the opportunity to get a Yamaha YM2149F
chip. This chip is basically a clone of &lt;a href="https://en.wikipedia.org/wiki/General_Instrument_AY-3-8910"&gt;General Instrument's
AY-3-8910&lt;/a&gt;, "a 3 voices programmable sound generator" widely used
in the 80's in many arcade games and home computers (including the
Atari ST and Amstrad CPC).&lt;/p&gt;
&lt;p&gt;The YM2149F chip (and its clones) can be found easily online, on
auction websites. The challenge is then to be able to drive the chip
and play some music with it. There are several blog posts out there
describing circuits to have the chip driven by a PC.&lt;/p&gt;
&lt;p&gt;The blog post &lt;a href="https://electronicfields.wordpress.com/2012/04/09/ym2149-sound-generator-arduino-fast-pin-switching/"&gt;YM2149 sound generator, Arduino and fast pin switching,
from Mr Megahertz&lt;/a&gt; has been very inspirational for this work. It
contains a lot useful information. On the other hand, by programming
the Arduino without using the provided SDK (as described on the
&lt;a href="http://www.florentflament.com/blog/arduino-hello-world-without-ide.html"&gt;Arduino Hello World without IDE&lt;/a&gt; blog post), we don't have any
issue to switch BDIR and BC1 signals simultaneously.&lt;/p&gt;
&lt;h2&gt;The circuit&lt;/h2&gt;
&lt;p&gt;After many experiments, I came out with a simple circuit composed of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A Yamaha YM2149F&lt;/li&gt;
&lt;li&gt;An Arduino Uno board (or clone)&lt;/li&gt;
&lt;li&gt;4 resistors (3&amp;times;1K + 1&amp;times;100 Ohms)&lt;/li&gt;
&lt;li&gt;A mini jack female connector&lt;/li&gt;
&lt;li&gt;A breadboard&lt;/li&gt;
&lt;li&gt;A few wires&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here's a picture of the circuit:&lt;/p&gt;
&lt;p&gt;&lt;img src="static/ym2149-arduino-picture.png" alt="YM2149 - Arduino circuit picture"/&gt;&lt;/p&gt;
&lt;p&gt;The corresponding schematic follows:&lt;/p&gt;
&lt;p&gt;&lt;img src="static/ym2149-arduino-schematic.png" alt="YM2149 - Arduino circuit picture"/&gt;&lt;/p&gt;
&lt;p&gt;Note that we don't need to use a dedicated oscillator for the
YM2149F. We can generate the required 2MHz clock with the Atmega328P
on the Arduino board.&lt;/p&gt;
&lt;h2&gt;The output stage&lt;/h2&gt;
&lt;p&gt;I made a lot of experiments on the output stage. The 4 resistors
between the 3 YM2149F outputs and the line output is a good
compromise. This forms a &lt;a href="https://en.wikipedia.org/wiki/Electronic_mixer"&gt;passive mixer&lt;/a&gt;, which significantly
improves the quality of the sound compared to the 1 resistor stage
that can be found in most YM2149 circuits available online. The lower
the value of RL, the less distortion we have on the output, but the
lower the signal strength. I found that 100 ohms is a good
compromise. In that case, the load perceived from an output of the
YM2149F fluctuates between 1.1 and 1.6 kOhms, depending on the values
of the other channels (if my computations as correct). And according
to the &lt;a href="http://www.ym2149.com/ym2149.pdf"&gt;YM2149 datasheet&lt;/a&gt; page 9, the expected load for a YM2149
output is 1kOhms. The distortion comes from the fact that the
equivalent resistance seen from a YM2149F output channel is dependent
on the other channels. The sound may be further improved by using an
active mixer, including an operational amplifier (To be tested some
day).&lt;/p&gt;
&lt;h2&gt;Testing the circuit&lt;/h2&gt;
&lt;p&gt;The &lt;a href="https://github.com/FlorentFlament/ym2149-test"&gt;code to drive the YM2149F from the Arduino&lt;/a&gt; is available on
GitHub. One can compile and upload the code to the Arduino by
following the instructions of the &lt;a href="http://www.florentflament.com/blog/arduino-hello-world-without-ide.html"&gt;Arduino Hello World without IDE&lt;/a&gt;
post. The code will have the YM2149F play continuously the C major
gamut. This code can be freely reused, especially the &lt;code&gt;ym2149&lt;/code&gt;
library, which allows to drive the YM2149F chip.&lt;/p&gt;
&lt;p&gt;Note that in order to have the ym2149-test binary work on a circuit,
one has to follow the connections described on the schematic above.&lt;/p&gt;
&lt;h2&gt;What next&lt;/h2&gt;
&lt;p&gt;The next blog post describes how to have &lt;a href="http://www.florentflament.com/blog/streaming-music-to-ym2149f.html"&gt;YM files streamed to the
YM2149F chip&lt;/a&gt;. Besides, a video of my &lt;a href="https://www.youtube.com/watch?v=MTRJdDbY048"&gt;YM2149F chip playing some
tune&lt;/a&gt; is available online.&lt;/p&gt;</content><category term="misc"></category><category term="Arduino"></category><category term="YM2149"></category><category term="YM2149F"></category><category term="AY-3-8910"></category></entry><entry><title>Arduino Hello World without IDE</title><link href="http://www.florentflament.com/blog/arduino-hello-world-without-ide.html" rel="alternate"></link><published>2016-08-08T00:00:00+02:00</published><updated>2016-08-08T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2016-08-08:/blog/arduino-hello-world-without-ide.html</id><summary type="html">&lt;p&gt;There is already a number of resources available about programming the
Arduino with or without the IDE (I won't discuss here the pros and
cons of using it). This aims at being a quick memo for those who
already have some knowledge about C programming, and just want the
minimal â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;There is already a number of resources available about programming the
Arduino with or without the IDE (I won't discuss here the pros and
cons of using it). This aims at being a quick memo for those who
already have some knowledge about C programming, and just want the
minimal information required to compile C code and upload it to an
Arduino board. This is basically a compilation of chunks of code
retrieved here and there a couple of months ago and possibly updated.&lt;/p&gt;
&lt;h2&gt;Packages to install&lt;/h2&gt;
&lt;p&gt;To be able to compile and upload C code to an Arduino board, one has
to install the following packages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;avr-gcc&lt;/code&gt; : Cross Compiling GNU GCC targeted at avr&lt;/li&gt;
&lt;li&gt;&lt;code&gt;avr-libc&lt;/code&gt; : C library for use with GCC on Atmel AVR microcontrollers&lt;/li&gt;
&lt;li&gt;&lt;code&gt;avrdude&lt;/code&gt; : Software for programming Atmel AVR microcontroller&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note the &lt;code&gt;avr-libc&lt;/code&gt; (and to some extend &lt;code&gt;avr-gcc&lt;/code&gt;) install a lot of
interesting libraries. Corresponding headers can be found in the
following directory: &lt;code&gt;/usr/avr/include/&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Makefile&lt;/h2&gt;
&lt;p&gt;The following Makefile summarizes the commands (with parameters)
needed to compile a C project and upload it to an Arduino board:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;baud&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;115200&lt;/span&gt;
&lt;span class="nv"&gt;avrType&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;atmega328p
&lt;span class="nv"&gt;avrFreq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;16000000&lt;/span&gt; &lt;span class="c1"&gt;# 16 Mhz&lt;/span&gt;
&lt;span class="nv"&gt;programmerDev&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/ttyUSB0
&lt;span class="nv"&gt;programmerType&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;arduino

&lt;span class="nv"&gt;cflags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;-DF_CPU&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;avrFreq&lt;span class="k"&gt;)&lt;/span&gt; -mmcu&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;avrType&lt;span class="k"&gt;)&lt;/span&gt; -Wall -Werror -Wextra -Os
&lt;span class="nv"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;patsubst %.c,%.o,&lt;span class="k"&gt;$(&lt;/span&gt;wildcard *.c&lt;span class="k"&gt;))&lt;/span&gt;

&lt;span class="nf"&gt;.PHONY&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;flash&lt;/span&gt; &lt;span class="n"&gt;clean&lt;/span&gt;

&lt;span class="nf"&gt;all&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;main&lt;/span&gt;.&lt;span class="n"&gt;hex&lt;/span&gt;

&lt;span class="nf"&gt;%.o&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; %.&lt;span class="n"&gt;c&lt;/span&gt;
    avr-gcc &lt;span class="k"&gt;$(&lt;/span&gt;cflags&lt;span class="k"&gt;)&lt;/span&gt; -c $&amp;lt; -o &lt;span class="nv"&gt;$@&lt;/span&gt;

&lt;span class="nf"&gt;main.elf&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;objects&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
    avr-gcc &lt;span class="k"&gt;$(&lt;/span&gt;cflags&lt;span class="k"&gt;)&lt;/span&gt; -o &lt;span class="nv"&gt;$@&lt;/span&gt; $^

&lt;span class="nf"&gt;main.hex&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;main&lt;/span&gt;.&lt;span class="n"&gt;elf&lt;/span&gt;
    avr-objcopy -j .text -j .data -O ihex $^ &lt;span class="nv"&gt;$@&lt;/span&gt;

&lt;span class="nf"&gt;flash&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;main&lt;/span&gt;.&lt;span class="n"&gt;hex&lt;/span&gt;
    avrdude -p&lt;span class="k"&gt;$(&lt;/span&gt;avrType&lt;span class="k"&gt;)&lt;/span&gt; -c&lt;span class="k"&gt;$(&lt;/span&gt;programmerType&lt;span class="k"&gt;)&lt;/span&gt; -P&lt;span class="k"&gt;$(&lt;/span&gt;programmerDev&lt;span class="k"&gt;)&lt;/span&gt; -b&lt;span class="k"&gt;$(&lt;/span&gt;baud&lt;span class="k"&gt;)&lt;/span&gt; -v -U flash:w:$&amp;lt;

&lt;span class="nf"&gt;clean&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    rm -f main.hex main.elf &lt;span class="k"&gt;$(&lt;/span&gt;objects&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To compile and upload a C project, one has to type the following
commands (actually the last one is enough, since it will automatically
build the &lt;code&gt;main.hex&lt;/code&gt; file if required):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  $ make
  ...
  $ make flash
  ...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Depending on the board being used, one may have to tune the parameters
at the beginning of the file. For instance, the &lt;code&gt;avrType&lt;/code&gt; must reflect
the type of AVR microcontroller on the board. The following header
contains an extensive list of the supported hardware:
&lt;code&gt;/usr/avr/include/avr/io.h&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Arduino Hello World&lt;/h2&gt;
&lt;p&gt;The minimal program on an Arduino consists in having a LED blink. I
found this code somewhere (though I couldn't recover where from..):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;util/delay.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt; &lt;span class="cpf"&gt;&amp;lt;avr/io.h&amp;gt;&lt;/span&gt;&lt;span class="cp"&gt;&lt;/span&gt;

&lt;span class="cp"&gt;#define LED PORTB5&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;DDRB&lt;/span&gt; &lt;span class="o"&gt;|=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;LED&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="cm"&gt;/*ever*/&lt;/span&gt;&lt;span class="p"&gt;(;;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;PORTB&lt;/span&gt; &lt;span class="o"&gt;|=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;LED&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_delay_ms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;PORTB&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;LED&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;_delay_ms&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That's all folks. With the packages installed and the Makefile
described earlier, one can compile this little C code and upload it to
an Arduino board and see the little red LED blinking. From this
starting point, one can easily work on bigger Arduino based projects.&lt;/p&gt;</content><category term="misc"></category><category term="Arduino"></category></entry><entry><title>Inkjet versus laser printer</title><link href="http://www.florentflament.com/blog/inkjet-versus-laser-printer.html" rel="alternate"></link><published>2015-05-09T00:00:00+02:00</published><updated>2015-05-09T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2015-05-09:/blog/inkjet-versus-laser-printer.html</id><summary type="html">&lt;p&gt;Contrary to what I found on most websites when googling about
comparisons between inkjet and laser printers, the cost per page on
high end inkjet printers is lower than that of laser printers.&lt;/p&gt;
&lt;p&gt;Moreover, when buying a new printer one has to consider the number of
pages that will be â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Contrary to what I found on most websites when googling about
comparisons between inkjet and laser printers, the cost per page on
high end inkjet printers is lower than that of laser printers.&lt;/p&gt;
&lt;p&gt;Moreover, when buying a new printer one has to consider the number of
pages that will be printed to estimate whether the savings done on the
cost per page offset the extra initial cost of the printer or not.&lt;/p&gt;
&lt;h2&gt;Computing cost per page&lt;/h2&gt;
&lt;p&gt;In order to find out the printer that best fit my usage, I computed
the cost per page of every HP multifunction printer with a price lower
than $1000 (as of the April 26th 2015). Then I computed the overall
cost of a printer that would print 3000 black and white pages (Cost of
printer + 3000 * cost per black page). Prices are computed based on
&lt;a href="http://store.hp.com/webapp/wcs/stores/servlet/us/en/vwa/printers"&gt;HP printers and cartridges official prices&lt;/a&gt;. I considered HP
printers, because most of them are &lt;a href="http://hplipopensource.com/hplip-web/supported_devices/index.html"&gt;working under Linux&lt;/a&gt;. As for
the number of pages, this is a rough estimate of my usage over 5 years
(my estimate of the life span of a printer).&lt;/p&gt;
&lt;p&gt;Cost per page and for 3000 pages:&lt;/p&gt;
&lt;style type="text/css"&gt;
    table,thead,tbody,tfoot,tr,th,td { font-family:"Liberation Sans"; font-size:x-small }
&lt;/style&gt;

&lt;table cellspacing="0" border="1"&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;&lt;br&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;br&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;br&gt;&lt;/td&gt;
        &lt;td align="center" colspan="6"&gt;Cartridges&lt;/td&gt;
        &lt;td align="left"&gt;&lt;br&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;br&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;br&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;Printer&lt;/td&gt;
        &lt;td align="left"&gt;Price ($)&lt;/td&gt;
        &lt;td align="left"&gt;Type&lt;/td&gt;
        &lt;td align="left"&gt;Black ref&lt;/td&gt;
        &lt;td align="left"&gt;Black price ($)&lt;/td&gt;
        &lt;td align="left"&gt;Black pages&lt;/td&gt;
        &lt;td align="left"&gt;Color ref&lt;/td&gt;
        &lt;td align="left"&gt;Color price ($)&lt;/td&gt;
        &lt;td align="left"&gt;Color pages&lt;/td&gt;
        &lt;td align="left"&gt;$ / black page&lt;/td&gt;
        &lt;td align="left"&gt;$ / color page&lt;/td&gt;
        &lt;td align="left"&gt;Price for 3000 pages&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Enterprise Color MFP X585dn&lt;/td&gt;
        &lt;td align="right" sdval="999.99" sdnum="1033;"&gt;999.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;980&lt;/td&gt;
        &lt;td align="right" sdval="113.99" sdnum="1033;"&gt;113.99&lt;/td&gt;
        &lt;td align="right" sdval="10000" sdnum="1033;"&gt;10000&lt;/td&gt;
        &lt;td align="left"&gt;980&lt;/td&gt;
        &lt;td align="right" sdval="97.99" sdnum="1033;"&gt;97.99&lt;/td&gt;
        &lt;td align="right" sdval="6600" sdnum="1033;"&gt;6600&lt;/td&gt;
        &lt;td align="right" sdval="1.1399" sdnum="1033;0;0.0"&gt;1.1&lt;/td&gt;
        &lt;td align="right" sdval="1.48469696969697" sdnum="1033;0;0.0"&gt;1.5&lt;/td&gt;
        &lt;td align="right" sdval="1034.187" sdnum="1033;0;0"&gt;1034&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro X476dn&lt;/td&gt;
        &lt;td align="right" sdval="324.98" sdnum="1033;"&gt;324.98&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;970XL&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="right" sdval="9200" sdnum="1033;"&gt;9200&lt;/td&gt;
        &lt;td align="left"&gt;971XL&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="right" sdval="6600" sdnum="1033;"&gt;6600&lt;/td&gt;
        &lt;td align="right" sdval="1.30423913043478" sdnum="1033;0;0.0"&gt;1.3&lt;/td&gt;
        &lt;td align="right" sdval="1.8180303030303" sdnum="1033;0;0.0"&gt;1.8&lt;/td&gt;
        &lt;td align="right" sdval="364.107173913043" sdnum="1033;0;0"&gt;364&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro X476dw&lt;/td&gt;
        &lt;td align="right" sdval="349.98" sdnum="1033;"&gt;349.98&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;970XL&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="right" sdval="9200" sdnum="1033;"&gt;9200&lt;/td&gt;
        &lt;td align="left"&gt;971XL&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="right" sdval="6600" sdnum="1033;"&gt;6600&lt;/td&gt;
        &lt;td align="right" sdval="1.30423913043478" sdnum="1033;0;0.0"&gt;1.3&lt;/td&gt;
        &lt;td align="right" sdval="1.8180303030303" sdnum="1033;0;0.0"&gt;1.8&lt;/td&gt;
        &lt;td align="right" sdval="389.107173913043" sdnum="1033;0;0"&gt;389&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro X576dw &lt;/td&gt;
        &lt;td align="right" sdval="399.98" sdnum="1033;"&gt;399.98&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;970XL&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="right" sdval="9200" sdnum="1033;"&gt;9200&lt;/td&gt;
        &lt;td align="left"&gt;971XL&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="right" sdval="6600" sdnum="1033;"&gt;6600&lt;/td&gt;
        &lt;td align="right" sdval="1.30423913043478" sdnum="1033;0;0.0"&gt;1.3&lt;/td&gt;
        &lt;td align="right" sdval="1.8180303030303" sdnum="1033;0;0.0"&gt;1.8&lt;/td&gt;
        &lt;td align="right" sdval="439.107173913044" sdnum="1033;0;0"&gt;439&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro 8610 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="129.99" sdnum="1033;"&gt;129.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;950XL&lt;/td&gt;
        &lt;td align="right" sdval="36.99" sdnum="1033;"&gt;36.99&lt;/td&gt;
        &lt;td align="right" sdval="2300" sdnum="1033;"&gt;2300&lt;/td&gt;
        &lt;td align="left"&gt;951XL&lt;/td&gt;
        &lt;td align="right" sdval="27.99" sdnum="1033;"&gt;27.99&lt;/td&gt;
        &lt;td align="right" sdval="1500" sdnum="1033;"&gt;1500&lt;/td&gt;
        &lt;td align="right" sdval="1.60826086956522" sdnum="1033;0;0.0"&gt;1.6&lt;/td&gt;
        &lt;td align="right" sdval="1.866" sdnum="1033;0;0.0"&gt;1.9&lt;/td&gt;
        &lt;td align="right" sdval="178.237826086957" sdnum="1033;0;0"&gt;178&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro 8620 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="199.99" sdnum="1033;"&gt;199.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;950XL&lt;/td&gt;
        &lt;td align="right" sdval="36.99" sdnum="1033;"&gt;36.99&lt;/td&gt;
        &lt;td align="right" sdval="2300" sdnum="1033;"&gt;2300&lt;/td&gt;
        &lt;td align="left"&gt;951XL&lt;/td&gt;
        &lt;td align="right" sdval="27.99" sdnum="1033;"&gt;27.99&lt;/td&gt;
        &lt;td align="right" sdval="1500" sdnum="1033;"&gt;1500&lt;/td&gt;
        &lt;td align="right" sdval="1.60826086956522" sdnum="1033;0;0.0"&gt;1.6&lt;/td&gt;
        &lt;td align="right" sdval="1.866" sdnum="1033;0;0.0"&gt;1.9&lt;/td&gt;
        &lt;td align="right" sdval="248.237826086957" sdnum="1033;0;0"&gt;248&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro 8630 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="279.99" sdnum="1033;"&gt;279.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;950XL&lt;/td&gt;
        &lt;td align="right" sdval="36.99" sdnum="1033;"&gt;36.99&lt;/td&gt;
        &lt;td align="right" sdval="2300" sdnum="1033;"&gt;2300&lt;/td&gt;
        &lt;td align="left"&gt;951XL&lt;/td&gt;
        &lt;td align="right" sdval="27.99" sdnum="1033;"&gt;27.99&lt;/td&gt;
        &lt;td align="right" sdval="1500" sdnum="1033;"&gt;1500&lt;/td&gt;
        &lt;td align="right" sdval="1.60826086956522" sdnum="1033;0;0.0"&gt;1.6&lt;/td&gt;
        &lt;td align="right" sdval="1.866" sdnum="1033;0;0.0"&gt;1.9&lt;/td&gt;
        &lt;td align="right" sdval="328.237826086957" sdnum="1033;0;0"&gt;328&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro 276dw&lt;/td&gt;
        &lt;td align="right" sdval="399.99" sdnum="1033;"&gt;399.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;950XL&lt;/td&gt;
        &lt;td align="right" sdval="36.99" sdnum="1033;"&gt;36.99&lt;/td&gt;
        &lt;td align="right" sdval="2300" sdnum="1033;"&gt;2300&lt;/td&gt;
        &lt;td align="left"&gt;951XL&lt;/td&gt;
        &lt;td align="right" sdval="27.99" sdnum="1033;"&gt;27.99&lt;/td&gt;
        &lt;td align="right" sdval="1500" sdnum="1033;"&gt;1500&lt;/td&gt;
        &lt;td align="right" sdval="1.60826086956522" sdnum="1033;0;0.0"&gt;1.6&lt;/td&gt;
        &lt;td align="right" sdval="1.866" sdnum="1033;0;0.0"&gt;1.9&lt;/td&gt;
        &lt;td align="right" sdval="448.237826086957" sdnum="1033;0;0"&gt;448&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro MFP M521dn&lt;/td&gt;
        &lt;td align="right" sdval="649.99" sdnum="1033;"&gt;649.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;55X&lt;/td&gt;
        &lt;td align="right" sdval="227.99" sdnum="1033;"&gt;227.99&lt;/td&gt;
        &lt;td align="right" sdval="13000" sdnum="1033;"&gt;13000&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="1.75376923076923" sdnum="1033;0;0.0"&gt;1.8&lt;/td&gt;
        &lt;td align="right" sdval="0" sdnum="1033;0;0.0"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="702.603076923077" sdnum="1033;0;0"&gt;703&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro 500 color MFP M570dn&lt;/td&gt;
        &lt;td align="right" sdval="749.99" sdnum="1033;"&gt;749.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;507X&lt;/td&gt;
        &lt;td align="right" sdval="199.99" sdnum="1033;"&gt;199.99&lt;/td&gt;
        &lt;td align="right" sdval="11000" sdnum="1033;"&gt;11000&lt;/td&gt;
        &lt;td align="left"&gt;507A&lt;/td&gt;
        &lt;td align="right" sdval="223.99" sdnum="1033;"&gt;223.99&lt;/td&gt;
        &lt;td align="right" sdval="6000" sdnum="1033;"&gt;6000&lt;/td&gt;
        &lt;td align="right" sdval="1.81809090909091" sdnum="1033;0;0.0"&gt;1.8&lt;/td&gt;
        &lt;td align="right" sdval="3.73316666666667" sdnum="1033;0;0.0"&gt;3.7&lt;/td&gt;
        &lt;td align="right" sdval="804.532727272727" sdnum="1033;0;0"&gt;805&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Color LaserJet Pro MFP M476nw&lt;/td&gt;
        &lt;td align="right" sdval="529.99" sdnum="1033;"&gt;529.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;312X&lt;/td&gt;
        &lt;td align="right" sdval="111.99" sdnum="1033;"&gt;111.99&lt;/td&gt;
        &lt;td align="right" sdval="4400" sdnum="1033;"&gt;4400&lt;/td&gt;
        &lt;td align="left"&gt;312A&lt;/td&gt;
        &lt;td align="right" sdval="122.99" sdnum="1033;"&gt;122.99&lt;/td&gt;
        &lt;td align="right" sdval="2700" sdnum="1033;"&gt;2700&lt;/td&gt;
        &lt;td align="right" sdval="2.54522727272727" sdnum="1033;0;0.0"&gt;2.5&lt;/td&gt;
        &lt;td align="right" sdval="4.55518518518519" sdnum="1033;0;0.0"&gt;4.6&lt;/td&gt;
        &lt;td align="right" sdval="606.346818181818" sdnum="1033;0;0"&gt;606&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Color LaserJet Pro MFP M476dn&lt;/td&gt;
        &lt;td align="right" sdval="629.99" sdnum="1033;"&gt;629.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;312X&lt;/td&gt;
        &lt;td align="right" sdval="111.99" sdnum="1033;"&gt;111.99&lt;/td&gt;
        &lt;td align="right" sdval="4400" sdnum="1033;"&gt;4400&lt;/td&gt;
        &lt;td align="left"&gt;312A&lt;/td&gt;
        &lt;td align="right" sdval="122.99" sdnum="1033;"&gt;122.99&lt;/td&gt;
        &lt;td align="right" sdval="2700" sdnum="1033;"&gt;2700&lt;/td&gt;
        &lt;td align="right" sdval="2.54522727272727" sdnum="1033;0;0.0"&gt;2.5&lt;/td&gt;
        &lt;td align="right" sdval="4.55518518518519" sdnum="1033;0;0.0"&gt;4.6&lt;/td&gt;
        &lt;td align="right" sdval="706.346818181818" sdnum="1033;0;0"&gt;706&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Color LaserJet Pro MFP M476dw&lt;/td&gt;
        &lt;td align="right" sdval="679.99" sdnum="1033;"&gt;679.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;312X&lt;/td&gt;
        &lt;td align="right" sdval="111.99" sdnum="1033;"&gt;111.99&lt;/td&gt;
        &lt;td align="right" sdval="4400" sdnum="1033;"&gt;4400&lt;/td&gt;
        &lt;td align="left"&gt;312A&lt;/td&gt;
        &lt;td align="right" sdval="122.99" sdnum="1033;"&gt;122.99&lt;/td&gt;
        &lt;td align="right" sdval="2700" sdnum="1033;"&gt;2700&lt;/td&gt;
        &lt;td align="right" sdval="2.54522727272727" sdnum="1033;0;0.0"&gt;2.5&lt;/td&gt;
        &lt;td align="right" sdval="4.55518518518519" sdnum="1033;0;0.0"&gt;4.6&lt;/td&gt;
        &lt;td align="right" sdval="756.346818181818" sdnum="1033;0;0"&gt;756&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro 400 MFP M425dn&lt;/td&gt;
        &lt;td align="right" sdval="399.99" sdnum="1033;"&gt;399.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;80X&lt;/td&gt;
        &lt;td align="right" sdval="178.99" sdnum="1033;"&gt;178.99&lt;/td&gt;
        &lt;td align="right" sdval="6900" sdnum="1033;"&gt;6900&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="2.59405797101449" sdnum="1033;0;0.0"&gt;2.6&lt;/td&gt;
        &lt;td align="right" sdval="0" sdnum="1033;0;0.0"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="477.811739130435" sdnum="1033;0;0"&gt;478&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet Pro 6830 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;934XL&lt;/td&gt;
        &lt;td align="right" sdval="29.99" sdnum="1033;"&gt;29.99&lt;/td&gt;
        &lt;td align="right" sdval="1000" sdnum="1033;"&gt;1000&lt;/td&gt;
        &lt;td align="left"&gt;935XL&lt;/td&gt;
        &lt;td align="right" sdval="56.97" sdnum="1033;"&gt;56.97&lt;/td&gt;
        &lt;td align="right" sdval="825" sdnum="1033;"&gt;825&lt;/td&gt;
        &lt;td align="right" sdval="2.999" sdnum="1033;0;0.0"&gt;3.0&lt;/td&gt;
        &lt;td align="right" sdval="6.90545454545455" sdnum="1033;0;0.0"&gt;6.9&lt;/td&gt;
        &lt;td align="right" sdval="209.96" sdnum="1033;0;0"&gt;210&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet 7612 Wide Format e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="249.99" sdnum="1033;"&gt;249.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;932XL&lt;/td&gt;
        &lt;td align="right" sdval="31.99" sdnum="1033;"&gt;31.99&lt;/td&gt;
        &lt;td align="right" sdval="1000" sdnum="1033;"&gt;1000&lt;/td&gt;
        &lt;td align="left"&gt;933XL&lt;/td&gt;
        &lt;td align="right" sdval="47.97" sdnum="1033;"&gt;47.97&lt;/td&gt;
        &lt;td align="right" sdval="825" sdnum="1033;"&gt;825&lt;/td&gt;
        &lt;td align="right" sdval="3.199" sdnum="1033;0;0.0"&gt;3.2&lt;/td&gt;
        &lt;td align="right" sdval="5.81454545454545" sdnum="1033;0;0.0"&gt;5.8&lt;/td&gt;
        &lt;td align="right" sdval="345.96" sdnum="1033;0;0"&gt;346&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Color LaserJet Pro MFP M277dw&lt;/td&gt;
        &lt;td align="right" sdval="429.99" sdnum="1033;"&gt;429.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;201X&lt;/td&gt;
        &lt;td align="right" sdval="89.99" sdnum="1033;"&gt;89.99&lt;/td&gt;
        &lt;td align="right" sdval="2800" sdnum="1033;"&gt;2800&lt;/td&gt;
        &lt;td align="left"&gt;201X&lt;/td&gt;
        &lt;td align="right" sdval="99.99" sdnum="1033;"&gt;99.99&lt;/td&gt;
        &lt;td align="right" sdval="2300" sdnum="1033;"&gt;2300&lt;/td&gt;
        &lt;td align="right" sdval="3.21392857142857" sdnum="1033;0;0.0"&gt;3.2&lt;/td&gt;
        &lt;td align="right" sdval="4.34739130434783" sdnum="1033;0;0.0"&gt;4.3&lt;/td&gt;
        &lt;td align="right" sdval="526.407857142857" sdnum="1033;0;0"&gt;526&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro MFP M225dn&lt;/td&gt;
        &lt;td align="right" sdval="229.99" sdnum="1033;"&gt;229.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;83X&lt;/td&gt;
        &lt;td align="right" sdval="79.99" sdnum="1033;"&gt;79.99&lt;/td&gt;
        &lt;td align="right" sdval="2200" sdnum="1033;"&gt;2200&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="3.63590909090909" sdnum="1033;0;0.0"&gt;3.6&lt;/td&gt;
        &lt;td align="right" sdval="0" sdnum="1033;0;0.0"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="339.067272727273" sdnum="1033;0;0"&gt;339&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro MFP M225dw&lt;/td&gt;
        &lt;td align="right" sdval="329.99" sdnum="1033;"&gt;329.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;83X&lt;/td&gt;
        &lt;td align="right" sdval="79.99" sdnum="1033;"&gt;79.99&lt;/td&gt;
        &lt;td align="right" sdval="2200" sdnum="1033;"&gt;2200&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="3.63590909090909" sdnum="1033;0;0.0"&gt;3.6&lt;/td&gt;
        &lt;td align="right" sdval="0" sdnum="1033;0;0.0"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="439.067272727273" sdnum="1033;0;0"&gt;439&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Color LaserJet Pro MFP M177fw&lt;/td&gt;
        &lt;td align="right" sdval="279.99" sdnum="1033;"&gt;279.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;130A&lt;/td&gt;
        &lt;td align="right" sdval="54.99" sdnum="1033;"&gt;54.99&lt;/td&gt;
        &lt;td align="right" sdval="1300" sdnum="1033;"&gt;1300&lt;/td&gt;
        &lt;td align="left"&gt;130A&lt;/td&gt;
        &lt;td align="right" sdval="57.99" sdnum="1033;"&gt;57.99&lt;/td&gt;
        &lt;td align="right" sdval="1000" sdnum="1033;"&gt;1000&lt;/td&gt;
        &lt;td align="right" sdval="4.23" sdnum="1033;0;0.0"&gt;4.2&lt;/td&gt;
        &lt;td align="right" sdval="5.799" sdnum="1033;0;0.0"&gt;5.8&lt;/td&gt;
        &lt;td align="right" sdval="406.89" sdnum="1033;0;0"&gt;407&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro MFP M127fn&lt;/td&gt;
        &lt;td align="right" sdval="209.99" sdnum="1033;"&gt;209.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;83A&lt;/td&gt;
        &lt;td align="right" sdval="63.99" sdnum="1033;"&gt;63.99&lt;/td&gt;
        &lt;td align="right" sdval="1500" sdnum="1033;"&gt;1500&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="4.266" sdnum="1033;0;0.0"&gt;4.3&lt;/td&gt;
        &lt;td align="right" sdval="0" sdnum="1033;0;0.0"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="337.97" sdnum="1033;0;0"&gt;338&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP LaserJet Pro MFP M127fw&lt;/td&gt;
        &lt;td align="right" sdval="259.99" sdnum="1033;"&gt;259.99&lt;/td&gt;
        &lt;td align="left"&gt;laser&lt;/td&gt;
        &lt;td align="left"&gt;83A&lt;/td&gt;
        &lt;td align="right" sdval="63.99" sdnum="1033;"&gt;63.99&lt;/td&gt;
        &lt;td align="right" sdval="1500" sdnum="1033;"&gt;1500&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="left"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="4.266" sdnum="1033;0;0.0"&gt;4.3&lt;/td&gt;
        &lt;td align="right" sdval="0" sdnum="1033;0;0.0"&gt;&lt;/td&gt;
        &lt;td align="right" sdval="387.97" sdnum="1033;0;0"&gt;388&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet 5740 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="119.99" sdnum="1033;"&gt;119.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="34.99" sdnum="1033;"&gt;34.99&lt;/td&gt;
        &lt;td align="right" sdval="600" sdnum="1033;"&gt;600&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="38.99" sdnum="1033;"&gt;38.99&lt;/td&gt;
        &lt;td align="right" sdval="415" sdnum="1033;"&gt;415&lt;/td&gt;
        &lt;td align="right" sdval="5.83166666666667" sdnum="1033;0;0.0"&gt;5.8&lt;/td&gt;
        &lt;td align="right" sdval="9.39518072289157" sdnum="1033;0;0.0"&gt;9.4&lt;/td&gt;
        &lt;td align="right" sdval="294.94" sdnum="1033;0;0"&gt;295&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP ENVY 5660 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="149.99" sdnum="1033;"&gt;149.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="34.99" sdnum="1033;"&gt;34.99&lt;/td&gt;
        &lt;td align="right" sdval="600" sdnum="1033;"&gt;600&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="38.99" sdnum="1033;"&gt;38.99&lt;/td&gt;
        &lt;td align="right" sdval="415" sdnum="1033;"&gt;415&lt;/td&gt;
        &lt;td align="right" sdval="5.83166666666667" sdnum="1033;0;0.0"&gt;5.8&lt;/td&gt;
        &lt;td align="right" sdval="9.39518072289157" sdnum="1033;0;0.0"&gt;9.4&lt;/td&gt;
        &lt;td align="right" sdval="324.94" sdnum="1033;0;0"&gt;325&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP ENVY 7640 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="149.99" sdnum="1033;"&gt;149.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="34.99" sdnum="1033;"&gt;34.99&lt;/td&gt;
        &lt;td align="right" sdval="600" sdnum="1033;"&gt;600&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="38.99" sdnum="1033;"&gt;38.99&lt;/td&gt;
        &lt;td align="right" sdval="415" sdnum="1033;"&gt;415&lt;/td&gt;
        &lt;td align="right" sdval="5.83166666666667" sdnum="1033;0;0.0"&gt;5.8&lt;/td&gt;
        &lt;td align="right" sdval="9.39518072289157" sdnum="1033;0;0.0"&gt;9.4&lt;/td&gt;
        &lt;td align="right" sdval="324.94" sdnum="1033;0;0"&gt;325&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet 8040 with Neat e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="349.99" sdnum="1033;"&gt;349.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="34.99" sdnum="1033;"&gt;34.99&lt;/td&gt;
        &lt;td align="right" sdval="600" sdnum="1033;"&gt;600&lt;/td&gt;
        &lt;td align="left"&gt;62XL&lt;/td&gt;
        &lt;td align="right" sdval="38.99" sdnum="1033;"&gt;38.99&lt;/td&gt;
        &lt;td align="right" sdval="415" sdnum="1033;"&gt;415&lt;/td&gt;
        &lt;td align="right" sdval="5.83166666666667" sdnum="1033;0;0.0"&gt;5.8&lt;/td&gt;
        &lt;td align="right" sdval="9.39518072289157" sdnum="1033;0;0.0"&gt;9.4&lt;/td&gt;
        &lt;td align="right" sdval="524.94" sdnum="1033;0;0"&gt;525&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet 150 Mobile All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="399.99" sdnum="1033;"&gt;399.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;94&lt;/td&gt;
        &lt;td align="right" sdval="28.99" sdnum="1033;"&gt;28.99&lt;/td&gt;
        &lt;td align="right" sdval="480" sdnum="1033;"&gt;480&lt;/td&gt;
        &lt;td align="left"&gt;97 eco&lt;/td&gt;
        &lt;td align="right" sdval="40.79" sdnum="1033;"&gt;40.79&lt;/td&gt;
        &lt;td align="right" sdval="532" sdnum="1033;"&gt;532&lt;/td&gt;
        &lt;td align="right" sdval="6.03958333333333" sdnum="1033;0;0.0"&gt;6.0&lt;/td&gt;
        &lt;td align="right" sdval="7.66729323308271" sdnum="1033;0;0.0"&gt;7.7&lt;/td&gt;
        &lt;td align="right" sdval="581.1775" sdnum="1033;0;0"&gt;581&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP ENVY 4500 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="69.99" sdnum="1033;"&gt;69.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="31.99" sdnum="1033;"&gt;31.99&lt;/td&gt;
        &lt;td align="right" sdval="480" sdnum="1033;"&gt;480&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="33.99" sdnum="1033;"&gt;33.99&lt;/td&gt;
        &lt;td align="right" sdval="330" sdnum="1033;"&gt;330&lt;/td&gt;
        &lt;td align="right" sdval="6.66458333333333" sdnum="1033;0;0.0"&gt;6.7&lt;/td&gt;
        &lt;td align="right" sdval="10.3" sdnum="1033;0;0.0"&gt;10.3&lt;/td&gt;
        &lt;td align="right" sdval="269.9275" sdnum="1033;0;0"&gt;270&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Deskjet 2540 All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="79.99" sdnum="1033;"&gt;79.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="31.99" sdnum="1033;"&gt;31.99&lt;/td&gt;
        &lt;td align="right" sdval="480" sdnum="1033;"&gt;480&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="33.99" sdnum="1033;"&gt;33.99&lt;/td&gt;
        &lt;td align="right" sdval="330" sdnum="1033;"&gt;330&lt;/td&gt;
        &lt;td align="right" sdval="6.66458333333333" sdnum="1033;0;0.0"&gt;6.7&lt;/td&gt;
        &lt;td align="right" sdval="10.3" sdnum="1033;0;0.0"&gt;10.3&lt;/td&gt;
        &lt;td align="right" sdval="279.9275" sdnum="1033;0;0"&gt;280&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP Officejet 4630 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="99.99" sdnum="1033;"&gt;99.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="31.99" sdnum="1033;"&gt;31.99&lt;/td&gt;
        &lt;td align="right" sdval="480" sdnum="1033;"&gt;480&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="33.99" sdnum="1033;"&gt;33.99&lt;/td&gt;
        &lt;td align="right" sdval="330" sdnum="1033;"&gt;330&lt;/td&gt;
        &lt;td align="right" sdval="6.66458333333333" sdnum="1033;0;0.0"&gt;6.7&lt;/td&gt;
        &lt;td align="right" sdval="10.3" sdnum="1033;0;0.0"&gt;10.3&lt;/td&gt;
        &lt;td align="right" sdval="299.9275" sdnum="1033;0;0"&gt;300&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="left"&gt;HP ENVY 5530 e-All-in-One&lt;/td&gt;
        &lt;td align="right" sdval="99.99" sdnum="1033;"&gt;99.99&lt;/td&gt;
        &lt;td align="left"&gt;ink&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="31.99" sdnum="1033;"&gt;31.99&lt;/td&gt;
        &lt;td align="right" sdval="480" sdnum="1033;"&gt;480&lt;/td&gt;
        &lt;td align="left"&gt;61XL&lt;/td&gt;
        &lt;td align="right" sdval="33.99" sdnum="1033;"&gt;33.99&lt;/td&gt;
        &lt;td align="right" sdval="330" sdnum="1033;"&gt;330&lt;/td&gt;
        &lt;td align="right" sdval="6.66458333333333" sdnum="1033;0;0.0"&gt;6.7&lt;/td&gt;
        &lt;td align="right" sdval="10.3" sdnum="1033;0;0.0"&gt;10.3&lt;/td&gt;
        &lt;td align="right" sdval="299.9275" sdnum="1033;0;0"&gt;300&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;

&lt;h2&gt;The ideal printer&lt;/h2&gt;
&lt;p&gt;We can observe that the lowest cost per black page is 1.1 cents for an
inkjet printer (HP Officejet Enterprise Color MFP X585dn). Then there
is a bunch of inkjet printers with a cost per black page of 1.3 cents
and 1.6 cents. The cheapest cost per page for a laser printer is 1.8
cents (for the HP LaserJet Pro MFP M521dn).&lt;/p&gt;
&lt;p&gt;When computing the overall cost of a printer for 3000 black and white
pages, the cheapest printer is the "HP Officejet Pro 8610
e-All-in-One" with an overall cost of $178 ($130 initial cost and 1.6
cents/page), then comes the "HP Officejet Pro 6830 e-All-in-One" with
an overall cost of $210 ($120 initial cost and 3.0 cents/page).&lt;/p&gt;
&lt;p&gt;Printers below $100 have a higher overall cost because of their very
high cost per page (6.7 cents per black page and 10.3 cents per color
page). On the other hand, the printer with the lowest cost per page
(1.1 cents) has a high overall cost because of its high initial cost
of $1000.&lt;/p&gt;
&lt;p&gt;In the end, the ideal printer depends on the usage that will be done
(number of pages printed). Besides, one may consider additional
features (print speed, duplex printing, ...) when choosing a printer.&lt;/p&gt;</content><category term="misc"></category><category term="Printers"></category><category term="Costs"></category></entry><entry><title>Right VM cost</title><link href="http://www.florentflament.com/blog/right-vm-cost.html" rel="alternate"></link><published>2014-08-03T00:00:00+02:00</published><updated>2014-08-03T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2014-08-03:/blog/right-vm-cost.html</id><summary type="html">&lt;p&gt;With cloud Virtual Machines prices dropping month after month, we may
be asking if the margins previously done by cloud operators were not
outrageously high. I actually find surprising that current VM price is
on average higher than equivalent dedicated server even though
virtualization allows sharing more hardware.&lt;/p&gt;
&lt;h2&gt;Comparing dedicated â€¦&lt;/h2&gt;</summary><content type="html">&lt;p&gt;With cloud Virtual Machines prices dropping month after month, we may
be asking if the margins previously done by cloud operators were not
outrageously high. I actually find surprising that current VM price is
on average higher than equivalent dedicated server even though
virtualization allows sharing more hardware.&lt;/p&gt;
&lt;h2&gt;Comparing dedicated server versus VM costs&lt;/h2&gt;
&lt;p&gt;Low cost dedicated servers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU 1 Core / 2 threads - RAM 2 GB - HDD 500 GB - costs â‚¬5 / month at &lt;a href="http://www.kimsufi.com/en/"&gt;Kimsufi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;CPU 1 Core - RAM 2 GB - SHDD 500 GB - costs â‚¬9.99 / month at &lt;a href="http://www.online.net/en/dedicated-server"&gt;online&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Low cost VMs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU 2 Cores - RAM 2 GB - SSD 40 GB - costs $20 / month at &lt;a href="https://www.digitalocean.com/pricing/"&gt;DigitalOcean&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;vCPUs 2 - RAM 2 GB - SSD 60 GB - $54 / month at &lt;a href="http://www.rackspace.com/cloud/public-pricing/"&gt;rackspace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;vCPUs 1 (fractional) - RAM 2 GB - 0 (additional storage cost) - $19 / month at &lt;a href="http://aws.amazon.com/ec2/pricing/"&gt;Amazon&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Virtual machines CPUs don't have much meaning, since depending on the
underlying hardware a virtual machine CPU may correspond to a physical
CPU core, thread or a fraction of CPU if the hypervisor is sharing
CPUs among VMs. Amazon introduces an EC2 Compute Unit (ECU), that
would allow objectively &lt;a href="http://aws.amazon.com/ec2/faqs/"&gt;comparing CPU performance between VMs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;At first glance we can see that for low end configurations the
price/performance ratio of Virtual Machines looks much higher than
ratio of dedicated servers.&lt;/p&gt;
&lt;h2&gt;Estimating cost of hardware&lt;/h2&gt;
&lt;p&gt;We can make an estimate of the cost of hardware by performing a
&lt;a href="http://en.wikipedia.org/wiki/Regression_analysis"&gt;multiple regression analysis&lt;/a&gt; on dedicated server prices.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.ovh.com/fr/serveurs_dedies/enterprise/"&gt;OVH prices&lt;/a&gt; (only considering Intel Xeon CPUs):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;|-------------------------------------------------------------------------------------------|
|         CPU type        | # threads | RAM (GB) | HDD (TB) | SSD (GB) | Price (â‚¬/month HT) |
|-------------------------------------------------------------------------------------------|
|                                 OVH Enterprise                                            |
|-------------------------------------------------------------------------------------------|
| Intel Xeon E5-1620v2    |     8     |    64    |     4    |     0    |       â‚¬81.99       |
| Intel Xeon E5-1650v2    |    12     |   128    |     4    |     0    |      â‚¬131.99       |
| Intel Xeon 2x E5-2650v2 |    32     |   128    |     4    |     0    |      â‚¬202.99       |
| Intel Xeon 2x E5-2670v2 |    40     |   256    |     4    |     0    |      â‚¬302.99       |
|-------------------------------------------------------------------------------------------|
|                                   OVH Infra                                               |
|-------------------------------------------------------------------------------------------|
| Intel Xeon E5-1620v2    |     8     |    32    |     6    |     0    |       â‚¬81.99       |
| Intel Xeon E5-1650v2    |    12     |    64    |     6    |     0    |      â‚¬141.99       |
| Intel Xeon 1x E5-2650v2 |    16     |   128    |     6    |     0    |      â‚¬191.99       |
| Intel Xeon 2x E5-2650v2 |    32     |   128    |     6    |     0    |      â‚¬302.99       |
| Intel Xeon 2x E5-2670v2 |    40     |   256    |     6    |     0    |      â‚¬402.99       |
|-------------------------------------------------------------------------------------------|
|                                   OVH Storage                                             |
|-------------------------------------------------------------------------------------------|
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    48    |     0    |      â‚¬372.99       |
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    72    |     0    |      â‚¬522.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   144    |     0    |      â‚¬822.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   216    |     0    |     â‚¬1272.00       |
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    36    |   360    |      â‚¬372.99       |
| Intel Xeon 1x E5 2620v2 |    12     |    48    |    54    |   360    |      â‚¬522.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   108    |  1080    |      â‚¬822.00       |
| Intel Xeon 2x E5 2620v2 |    24     |    64    |   162    |  1080    |     â‚¬1272.00       |
|-------------------------------------------------------------------------------------------|
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;In our case, for each server setting we have:
Yi = ÃŸ1 + ÃŸ2&lt;em&gt;Xi2 + ÃŸ3&lt;/em&gt;Xi3 + ÃŸ4&lt;em&gt;Xi4 + ÃŸ5&lt;/em&gt;Xi5 + Ei
where:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Yi is the price for setting i&lt;/li&gt;
&lt;li&gt;ÃŸ1 is a constant per server&lt;/li&gt;
&lt;li&gt;ÃŸ2 is the estimate of â‚¬ / thread&lt;/li&gt;
&lt;li&gt;ÃŸ3 is the estimate of â‚¬ / GB of RAM&lt;/li&gt;
&lt;li&gt;ÃŸ4 is the estimate of â‚¬ / TB of HDD&lt;/li&gt;
&lt;li&gt;ÃŸ5 is the estimate of â‚¬ / GB of SSD&lt;/li&gt;
&lt;li&gt;Xi2 is the number of CPU threads for setting i&lt;/li&gt;
&lt;li&gt;Xi3 is the amount of RAM in GB for setting i&lt;/li&gt;
&lt;li&gt;Xi4 is the amount of HDD space in TB for setting i&lt;/li&gt;
&lt;li&gt;Xi5 is the amount of SSD space in GB for setting i&lt;/li&gt;
&lt;li&gt;Ri is the residual error for setting i&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can estimate ÃŸj coefficients with the following formula:
ÃŸ = (Xt&lt;em&gt;X)-Â¹&lt;/em&gt;Xt*Y&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ python pricing_vm_simple.py
Constant: &lt;span class="m"&gt;31&lt;/span&gt;.3530724158
Eur / CPU thread: &lt;span class="m"&gt;3&lt;/span&gt;.12689639938
Eur / GB of RAM: &lt;span class="m"&gt;0&lt;/span&gt;.639580183605
Eur / TB of HDD: &lt;span class="m"&gt;5&lt;/span&gt;.18992626031
Eur / GB of SSD: &lt;span class="m"&gt;0&lt;/span&gt;.197627042107
R^2: &lt;span class="m"&gt;0&lt;/span&gt;.982339781679
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Assuming that we rent some of the afore mentioned dedicated servers,
what comes out from these results is that the most expensive resource
is the Intel Xeon CPU thread, which costs more than â‚¬3/month. Hence
the monthly cost of the following configurations (including â‚¬1 share
of server fixed cost):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2 Full Xeon Threads - 2 GB RAM - 40 GB SSD : â‚¬16.50&lt;/li&gt;
&lt;li&gt;1 Full Xeon Thread - 1 GB RAM - 10 GB SSD : â‚¬6.75&lt;/li&gt;
&lt;li&gt;1/4th Xeon Thread - 1 GB RAM - 5 GB SSD : â‚¬3.40&lt;/li&gt;
&lt;li&gt;1/8th Xeon Thread - 512 MB RAM - 1 GB SSD : â‚¬1.90&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Interpretation&lt;/h2&gt;
&lt;p&gt;These hardware costs look rather aligned with cheapest (Digital Ocean)
VMs prices. On the other hand, public cloud leaders (Rackspace and
Amazon) are much more expensive.&lt;/p&gt;
&lt;p&gt;So should Virtual Machines be cheaper than equivalent dedicated
servers ? Well, this is possible when virtualization allows sharing a
certain amount of fixed costs among users of the same hardware.
According to the previous regression analysis (and hardware
considered), these fixed costs account for roughly â‚¬30 / month per
server. Therefore, for low end VMs from some Euros to tens of Euros,
fixed costs sharing looks meaningful. On the other hand, high end VMs
are costly and don't allow many users to share the same server. In
that case, there is no real cost advantage in choosing a VM instead of
a dedicated server in a 24H / 24 7D / 7 usage scenario. However, for
ephemeral usage, high end virtual machines may make sense. Besides,
SSD storage (which is recommended when sharing a disk with many users)
is costly. Therefore, in the case of huge storage space requirements,
dedicated servers with big HDDs may be more appropriate.&lt;/p&gt;
&lt;h2&gt;Annex - Regression Analysis code&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/usr/bin/env python&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt;

&lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1,  8,  64,   4,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 12, 128,   4,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 32, 128,   4,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 40, 256,   4,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1,  8,  32,   6,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 12,  64,   6,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 16, 128,   6,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 32, 128,   6,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 40, 256,   6,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 12,  48,  48,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 12,  48,  72,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 24,  64, 144,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 24,  64, 216,    0;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 12,  48,  36,  360;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 12,  48,  54,  360;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 24,  64, 108, 1080;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1, 24,  64, 162, 1080&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;Y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;matrix&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;  81.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 131.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 202.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 302.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;  81.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 141.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 191.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 302.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 402.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 372.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 522.00;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 822.00;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1272.00;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 372.99;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 522.00;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39; 822.00;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;1272.00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Computing model parameters&lt;/span&gt;
&lt;span class="n"&gt;B&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;

&lt;span class="c1"&gt;# Computing predictions based on models&lt;/span&gt;
&lt;span class="n"&gt;F&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;X&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;

&lt;span class="c1"&gt;# Computing R^2&lt;/span&gt;
&lt;span class="n"&gt;M&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;SStot&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;multiply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;SSres&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;numpy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;multiply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Rsq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;SSres&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;SStot&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Constant:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Eur / CPU thread:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Eur / GB of RAM:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Eur / TB of HDD:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Eur / GB of SSD:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;R^2:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Rsq&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="misc"></category><category term="Virtualization"></category><category term="VM"></category><category term="Hardware"></category><category term="Costs"></category></entry><entry><title>Git SSH Docker container</title><link href="http://www.florentflament.com/blog/git-ssh-docker-container.html" rel="alternate"></link><published>2014-06-28T00:00:00+02:00</published><updated>2014-06-28T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2014-06-28:/blog/git-ssh-docker-container.html</id><summary type="html">&lt;p&gt;My favorite option to backup and version my code and text files is
using git with a remote repository. The implementation I have chosen
for that consists in running an ssh server, with git, in a Docker
container. This has the following advantages over other solutions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;100% reproducible;&lt;/li&gt;
&lt;li&gt;Limits access â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;My favorite option to backup and version my code and text files is
using git with a remote repository. The implementation I have chosen
for that consists in running an ssh server, with git, in a Docker
container. This has the following advantages over other solutions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;100% reproducible;&lt;/li&gt;
&lt;li&gt;Limits access to the container in case the account is compromised;&lt;/li&gt;
&lt;li&gt;Consumes less resources that running a VM.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Dockerfile&lt;/h2&gt;
&lt;p&gt;The proposed Git SSH Dockerfile is based on the &lt;a href="https://docs.docker.com/examples/running_ssh_service/"&gt;Dockerizing an SSH
service&lt;/a&gt; example.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FROM ubuntu:14.04

RUN apt-get -y update
RUN apt-get -y install openssh-server
RUN apt-get -y install git

&lt;span class="c1"&gt;# Setting openssh&lt;/span&gt;
RUN mkdir /var/run/sshd
RUN sed -i &lt;span class="s2"&gt;&amp;quot;s/#PasswordAuthentication yes/PasswordAuthentication no/&amp;quot;&lt;/span&gt; /etc/ssh/sshd_config

&lt;span class="c1"&gt;# Adding git user&lt;/span&gt;
RUN adduser --system git
RUN mkdir -p /home/git/.ssh

&lt;span class="c1"&gt;# Clearing and setting authorized ssh keys&lt;/span&gt;
RUN &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &amp;gt; /home/git/.ssh/authorized_keys
RUN &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;First SSH public key&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /home/git/.ssh/authorized_keys
RUN &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Second SSH public key&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /home/git/.ssh/authorized_keys
&lt;span class="c1"&gt;# ...&lt;/span&gt;

&lt;span class="c1"&gt;# Updating shell to bash&lt;/span&gt;
RUN sed -i s#/home/git:/bin/false#/home/git:/bin/bash# /etc/passwd

EXPOSE &lt;span class="m"&gt;22&lt;/span&gt;
CMD &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/usr/sbin/sshd&amp;quot;&lt;/span&gt;, &lt;span class="s2"&gt;&amp;quot;-D&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Running the container&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Building the image&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ docker.io build -t git-ssh_img .
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Running the image&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo docker.io run -p &lt;span class="m"&gt;1234&lt;/span&gt;:22 -d --name git-ssh git-ssh_img
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The previous command maps the container's host port 1234 on the
container's SSH port. Of course, this port can be changed to any
value. One can then ssh to the container with the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ssh -p &lt;span class="m"&gt;1234&lt;/span&gt; git@&amp;lt;container_host&amp;gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="misc"></category><category term="Git"></category><category term="SSH"></category><category term="Docker"></category></entry><entry><title>Securing Data</title><link href="http://www.florentflament.com/blog/securing-data.html" rel="alternate"></link><published>2014-05-03T23:34:00+02:00</published><updated>2014-05-03T23:34:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2014-05-03:/blog/securing-data.html</id><summary type="html">&lt;p&gt;As a data geek, I've been wondering how I could protect my data from
the main threats (if possible by using only open source software). For
instance, losing data because of a hardware failure is just something
that shouldn't happen anymore, thanks to all the technology available
today. One could â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;As a data geek, I've been wondering how I could protect my data from
the main threats (if possible by using only open source software). For
instance, losing data because of a hardware failure is just something
that shouldn't happen anymore, thanks to all the technology available
today. One could argue that cloud storage services may be the
solution, which may be true to deal with hardware failure; but there
are other threats to be taken into account that are worsen by the use
of the such services (I'm thinking about piracy).&lt;/p&gt;
&lt;p&gt;So what's the need in term of data safety, security and availability?
Well here's how I would summarize my ideal target. I basically wish to
protect my data against most threats, while still being able to access
it according to my usage. I've been thinking about the following
threats:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Hardware failure (Hard disk failure)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Piracy (Pirate breaking into ones computer / online account)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Human mistakes (mistakenly deleting important data)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Theft (Losing data stored on the stolen hardware, thieves abusing
  of sensitive data).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Data Safety and Security&lt;/h1&gt;
&lt;p&gt;Basically, data protection may be split into two categories:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Data Safety, consisting in measures against hardware failures and
  human mistakes (also natural disasters if we really want to ensure a
  first grade safety level);&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Data Security, consisting in protecting data against theft and
  piracy.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Data Safety&lt;/h2&gt;
&lt;p&gt;In order to avoid losing data because of hardware failure data should
be duplicated. So that if a hard disk fails, the data still remains on
the second disk. Some technologies like RAID (Hardware or Software),
provide such service by performing real time data duplication on
several disks.&lt;/p&gt;
&lt;p&gt;To deal with natural disasters, like fires or floods, we may duplicate
our data at distant locations. This is becoming easier with new
technologies like &lt;a href="http://ceph.com/"&gt;Ceph&lt;/a&gt; or &lt;a href="http://www.openstack.org/software/openstack-storage/"&gt;OpenStack Swift&lt;/a&gt;, that allow real
time duplication of data on distant storage nodes.&lt;/p&gt;
&lt;p&gt;Another category of threat (maybe the most frequent) is human
mistake. One can easily delete an important file by mistake. The good
old solution to deal with such issues is doing regular backups. While
this is a very good idea, depending on the frequency of the backups,
we may accidentally loose some recent data that didn't have the time
to be saved. There are other means to ensure data can be recovered
even after being deleted, such as versioning by using tools like
&lt;a href="http://git-scm.com/"&gt;git&lt;/a&gt;, or &lt;a href="http://owncloud.org/"&gt;ownCloud&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Data Security&lt;/h2&gt;
&lt;p&gt;Piracy is a quite broad topic. However, by following a few simple
rules, we may avoid most of piracy threats:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Don't store online data that we don't need to have online. Online
  data have much more chances of being stolen than offline data (or
  data available in a private network); If pirates cannot access the
  data through the network, it is much more complicated to gain access
  to it. This is the main reason why I believe that cloud storage may
  not be the best solution for everything. If by chance a pirate
  guesses one's cloud storage account password, he can then access
  freely any data that has been stored there.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Strongly encrypt private data that may be accessed by pirates or
  thieves. Basically any data may potentially be accessed by pirates or
  thieves, but as written previously, online data is much more
  vulnerable, and should therefore be encrypted in priority.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Theft can happen:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;To deal with the issue of loosing its data because of its laptop
  being stolen, we may use some solutions that were discussed
  previously to ensure data safety. Good old backups are still a
  working solution; real time duplication at different locations is
  another one.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;To deal with private data exploit (meaning malicious usage of
  private data by thieves), encryption is a good option. By ensuring
  that the thieves cannot decrypt the data, we protect us against such
  scenario.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Cost of Protection&lt;/h2&gt;
&lt;p&gt;All these measures for ensuring a proper data protection do have a
cost. To duplicate our data, we need twice as much hard disks than if
we don't. To encrypt our data and decrypt it on the fly to read it
consumes more CPU than processing plain files. Although storage costs
as well as computing costs have collapsed these last years, we may be
smart by &lt;a href="http://www.florentflament.com/blog/data-management.html"&gt;categorizing our data&lt;/a&gt; (e.g: public versus private data,
text documents versus binary files, small versus large files, ...) and
apply different safety and security measures accordingly.&lt;/p&gt;
&lt;h1&gt;Layered architecture&lt;/h1&gt;
&lt;p&gt;Now we need to find out an overall solution that will meet our
requirements. There is not a single tool I can think of that provides
all of the features mentioned in this article. To build our overall
solutions, we'll need to have several tools work together. The
approach I thought about is to split our need into features provided
by different layers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A versioning layer (git, owncloud, ...) that keeps track of the
  history of our data and allows recovering data that has been
  accidentally deleted or altered.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;An exposition layer, which is more a functional layer that a
  security one, that make data available according to our
  requirements.  For instance, it makes sense to have emails available
  from the internet through IMAPs, while other data may only be
  available through ssh from a host on the private network.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;An encryption layer to deal with private data abuse by
  thieves. Technologies like dm-crypt, LUKS and Truecrypt seem to be
  good candidates.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A (possibly redundant) storage backend: object storage, block
  storage or file system (ceph, RAID, ...). First thoughts lead me to
  think about using Ceph as a backend storage. However, it happens
  that Ceph monitor's play a crucial role and may become a SPOF
  (single point of failure) if not redundant. Also they must be an odd
  number, which means at least 3 nodes are required. A simpler RAID
  approach with regular backups seems to be a good compromise for
  small infrastructures.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;And regular backups. This is cheap, easy to implement, and deals
  with most of our issues. However, the efficiency of backups directly
  depends on their frequency, since work done between successive
  backups will be lost in case of hardware failure, human mistake or
  theft.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Example table&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;+------------------+-------------+--------+-------------+-------------+------------------+&lt;/span&gt;
&lt;span class="err"&gt;|                  |             |        |             |             |                  |&lt;/span&gt;
&lt;span class="err"&gt;| Files            | text / code | Emails | Binary data | Binary data |      Threat      |&lt;/span&gt;
&lt;span class="err"&gt;|                  |             |        | important   | throwable   |                  |&lt;/span&gt;
&lt;span class="err"&gt;+------------------+-------------+--------+-------------+-------------+------------------+&lt;/span&gt;
&lt;span class="err"&gt;|                  |             |                                    |                  |&lt;/span&gt;
&lt;span class="err"&gt;| Version layer    |     git     |                 None               | Human            |&lt;/span&gt;
&lt;span class="err"&gt;|                  |             |                                    | error ++         |&lt;/span&gt;
&lt;span class="err"&gt;+------------------+-------------+--------+---------------------------+------------------+&lt;/span&gt;
&lt;span class="err"&gt;|                  |             |        |                           |                  |&lt;/span&gt;
&lt;span class="err"&gt;| Exposition layer |     ssh     | IMAPs  |            NFS            |                  |&lt;/span&gt;
&lt;span class="err"&gt;|                  |             |        |                           |                  |&lt;/span&gt;
&lt;span class="err"&gt;+------------------+------------------- Block devices ----------------+------------------+&lt;/span&gt;
&lt;span class="err"&gt;|                  |                      |                           |                  |&lt;/span&gt;
&lt;span class="err"&gt;| Encryption layer |         LUKS         |           None            | Theft (abuse)    |&lt;/span&gt;
&lt;span class="err"&gt;|                  |                      |                           |                  |&lt;/span&gt;
&lt;span class="err"&gt;+------------------+------------------- Block devices ----------------+------------------+&lt;/span&gt;
&lt;span class="err"&gt;|                  |                                                  |                  |&lt;/span&gt;
&lt;span class="err"&gt;| Redundancy       |                  Disks / RAID                    | Hardware         |&lt;/span&gt;
&lt;span class="err"&gt;|                  |                                                  | failure ++       |&lt;/span&gt;
&lt;span class="err"&gt;+------------------+------------------------------------+-------------+------------------+&lt;/span&gt;
&lt;span class="err"&gt;|                  |                                    |             | Human error /    |&lt;/span&gt;
&lt;span class="err"&gt;| Backup           |         Regular snapshots          |    None     | Theft (loss) /   |&lt;/span&gt;
&lt;span class="err"&gt;|                  |                                    |             | Piracy /         |&lt;/span&gt;
&lt;span class="err"&gt;|                  |                                    |             | Hardware failure |&lt;/span&gt;
&lt;span class="err"&gt;+------------------+------------------------------------+-------------+------------------+&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="misc"></category><category term="Data Safety"></category><category term="Data Security"></category></entry><entry><title>Chef Server on Raspberry Pi</title><link href="http://www.florentflament.com/blog/chef-server-on-raspberry-pi.html" rel="alternate"></link><published>2014-03-03T00:00:00+01:00</published><updated>2014-03-03T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2014-03-03:/blog/chef-server-on-raspberry-pi.html</id><summary type="html">&lt;p&gt;&lt;a href="http://www.raspberrypi.org/"&gt;Raspberry Pi&lt;/a&gt; devices are cheap, quiet, and powerful enough to run
a Debian based Linux Operating System called &lt;a href="http://www.raspbian.org/"&gt;Raspbian&lt;/a&gt;. Such
device would be very convenient to manage one's personal
infrastructure, composed of some physical and / or virtual machines,
by running Chef Server.&lt;/p&gt;
&lt;p&gt;While, the official Chef website mostly documents &lt;a href="http://www.getchef.com/chef/install/#tab2"&gt;the â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="http://www.raspberrypi.org/"&gt;Raspberry Pi&lt;/a&gt; devices are cheap, quiet, and powerful enough to run
a Debian based Linux Operating System called &lt;a href="http://www.raspbian.org/"&gt;Raspbian&lt;/a&gt;. Such
device would be very convenient to manage one's personal
infrastructure, composed of some physical and / or virtual machines,
by running Chef Server.&lt;/p&gt;
&lt;p&gt;While, the official Chef website mostly documents &lt;a href="http://www.getchef.com/chef/install/#tab2"&gt;the installation of
Chef Server on Ubuntu and (Red Hat) Enterprise Linux&lt;/a&gt;, Chef Server
is available through its API and already packaged for Raspbian as
package &lt;code&gt;chef-server-api&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The installation of Chef Server on a Raspberry Pi is therefore quite
forward. The steps to follow, that are described below, are somehow
inspired from these &lt;a href="http://www.cschramm.net/howtos/installing-chef-server-debian/"&gt;instructions to have Chef Server installed on
Debian using binary packages&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Installation procedure&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Start from a fresh installation of Raspbian on a Raspberry Pi. From
NOOBS menu, install Raspbian (Using NOOBS v1.2.1).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install Chef Server binary package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get update
$ sudo apt-get install chef-server-api
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Configure Chef Server, by answering to the two questions that will
  be asked:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;URL of Chef server: http://CHEF_SERVER_IP:4000&lt;/li&gt;
&lt;li&gt;Chef AMQP user password: RANDOM_PASSWORD (Avoid using special
  characters)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note: Some services won't start, like jetty. &lt;code&gt;chef-server&lt;/code&gt; will also
be said to have failed, but Chef Server APIs will be working anyway.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Testing:&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@raspberrypi:~# knife configure -i
WARNING: No knife configuration file found
Where should I put the config file? [/root/.chef/knife.rb] 
Please enter the chef server URL: [http://raspberrypi:4000] http://CHEF_SERVER_IP:4000
Please enter a clientname for the new client: [pi] root
Please enter the existing admin clientname: [chef-webui] 
Please enter the location of the existing admin client&amp;#39;s private key: [/etc/chef/webui.pem] 
Please enter the validation clientname: [chef-validator] 
Please enter the location of the validation key: [/etc/chef/validation.pem] 
Please enter the path to a chef repository (or leave blank): 
Creating initial API user...
Created client[root]
Configuration file written to /root/.chef/knife.rb
root@raspberrypi:~# knife client list
  chef-validator
  chef-webui
  root
root@raspberrypi:~#
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Update of 2014/03/03&lt;/h2&gt;
&lt;p&gt;Note that I hit the bug &lt;a href="https://tickets.opscode.com/browse/CHEF-3170"&gt;Rabbitmq does not appear to get configured
when installing chef-server via deb packages&lt;/a&gt;. I got errors when
launching commands &lt;code&gt;knife client create&lt;/code&gt; or &lt;code&gt;knife client reregister&lt;/code&gt;,
with following message in &lt;code&gt;rabbitmq&lt;/code&gt; log:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;=ERROR REPORT==== 4-Jun-2012::14:56:01 ===
exception on TCP connection &amp;lt;0.583.0&amp;gt; from 127.0.0.1:34143
{channel0_error,starting,
    {amqp_error,access_refused,
        &amp;quot;AMQPLAIN login refused: user &amp;#39;chef&amp;#39; - invalid credentials&amp;quot;,
        &amp;#39;connection.start_ok&amp;#39;}}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Fix consists in executing the following commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo rabbitmqctl add_vhost /chef
$ sudo rabbitmqctl add_user chef PASSWORD_PER_CONFIGURATION
$ sudo rabbitmqctl set_permissions -p /chef chef &lt;span class="s2"&gt;&amp;quot;.*&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.*&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.*&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="misc"></category><category term="Chef"></category><category term="Raspberry Pi"></category><category term="Raspbian"></category></entry><entry><title>Data management</title><link href="http://www.florentflament.com/blog/data-management.html" rel="alternate"></link><published>2014-02-27T00:00:00+01:00</published><updated>2014-02-27T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2014-02-27:/blog/data-management.html</id><summary type="html">&lt;p&gt;When using several computers (or devices) from different locations,
the question of data management arises. Basically, I wish being able
to access my data from any computer; I wish my data to be protected,
accordingly to its privacy and I wish my data to be backed up
appropriately.&lt;/p&gt;
&lt;p&gt;With the â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;When using several computers (or devices) from different locations,
the question of data management arises. Basically, I wish being able
to access my data from any computer; I wish my data to be protected,
accordingly to its privacy and I wish my data to be backed up
appropriately.&lt;/p&gt;
&lt;p&gt;With the arrival of Cloud technologies, some of the requirements
become easier to satisfy. For instance, when using online storage,
data is automatically backed up. But in the same time, the question of
data management takes all of its meaning, because we surely don't want
any information to become public. Hence comes the need to classify its
data according to its privacy level, and to use appropriate storage
backend according to data privacy levels.&lt;/p&gt;
&lt;h2&gt;Data classification&lt;/h2&gt;
&lt;p&gt;I chose four levels of classification, because it makes sense to me
and map well with storage backend that will be described later. I'll
also borrow some terminology from security guys:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;White data (i.e. public data): this is a blog post, Open Source
  code, or any information that we want to make available to everyone.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Grey data: this is all the data that I'd gladly share with my
  friends, but do not want my worse enemy to have access to. Fall in
  this category: interesting documents that I found online or public
  information based notes that are not good enough to make a blog
  post.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Black data: private data, that only trusted people should have
  access to. I'd put in this category any personal documents, from
  emails (some being potentially private) and picture of my holidays
  to administrative documents (ID scans, ...).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Red data: data that only I should have access to, typically
  credentials (passwords, keys, ...).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note that the content of these categories may depend on each one's
perception of data privacy. For instance, I put pictures of holidays
in the 'Black data', but we can also consider that pictures of
landscapes may go into the 'Gray data' category.&lt;/p&gt;
&lt;h2&gt;Storage backend&lt;/h2&gt;
&lt;p&gt;So where to store our data? Well now that we've classified our data,
we can choose where we will store it according to the category it is
into.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;White data: The easiest. There are many services on internet that
  will host your public data for free, or almost. For instance, Open
  Source code can be stored into public repositories like &lt;a href="https://github.com/"&gt;GitHub&lt;/a&gt;,
  or &lt;a href="https://bitbucket.org/"&gt;Bitbucket&lt;/a&gt;. Blogs can be published on &lt;a href="https://wordpress.org/"&gt;WordPress&lt;/a&gt;, &lt;a href="http://pages.github.com/"&gt;GitHub
  Pages&lt;/a&gt; or some personal web site. These services provide both
  availability of the data from anywhere, and easy / automatic backup
  (especially when using a versioning tools like git on GitHub).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Grey data: These data would typically be stored online on a
  "personal" account, which access is restricted by a password. We
  assume that the service provider has full access to the clear data,
  and that this data may be compromised by an attacker. With new cloud
  services available, like free online storage provided by
  &lt;a href="http://www.cloudwatt.com/"&gt;Cloudwatt&lt;/a&gt; or &lt;a href="http://www.dropbox.com/"&gt;Dropbox&lt;/a&gt;, it becomes very easy to have files
  stored online and available from multiple locations, backup possibly
  performed automatically (by default the OpenStack object storage
  module, Swift, uses three copies of each file stored in its data
  store) and possibly versioned (Swift provides an option to
  automatically keep several version of each file). A distributed
  network filesystem on &lt;a href="http://ceph.com/"&gt;Ceph&lt;/a&gt;, may be another approach.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Black data: This data should be stored in a way that provides a fair
  level of data protection, since we typically don't want our service
  provider or hackers to have access to it. There are two completely
  opposite solutions for this: keep this private data locally and not
  put it online at all; or store this data online encrypted with
  strong cryptography algorithms (for instance by using
  &lt;a href="http://duplicity.nongnu.org/"&gt;duplicity&lt;/a&gt;). Having its data stored online (encrypted) allows us
  to benefit from automatic backup and ubiquity, but is riskier that
  the local storage solution. When stored online encrypted, a security
  breach in the software used to protect the data would allow
  attackers to recover all of the private data. When stored locally,
  backup has to be done by ourselves and the data may not be as easily
  available from different locations.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Red data: Data in this category are typically keys used to decrypt
  Black data, or passwords to access online services. This data should
  be very well protected. The best way to achieve such level of
  protection is to keep this data locally AND encrypted. This way even
  if the data is stolen, it cannot be read. Backup has to be done
  locally.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="Data management"></category></entry><entry><title>ZNC in Docker container</title><link href="http://www.florentflament.com/blog/znc-in-docker-container.html" rel="alternate"></link><published>2013-12-15T00:00:00+01:00</published><updated>2013-12-15T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2013-12-15:/blog/znc-in-docker-container.html</id><summary type="html">&lt;p&gt;&lt;a href="http://wiki.znc.in/ZNC"&gt;ZNC&lt;/a&gt; is a popular IRC bouncer, which stays connected to IRC
channels and log conversations while one isn't connected. This note
desrcibes how to launch ZNC in a &lt;a href="https://www.docker.io/"&gt;Docker&lt;/a&gt; container, so that it be
launched on any Docker enabled platform. To quick start with Docker,
one can follow the steps â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="http://wiki.znc.in/ZNC"&gt;ZNC&lt;/a&gt; is a popular IRC bouncer, which stays connected to IRC
channels and log conversations while one isn't connected. This note
desrcibes how to launch ZNC in a &lt;a href="https://www.docker.io/"&gt;Docker&lt;/a&gt; container, so that it be
launched on any Docker enabled platform. To quick start with Docker,
one can follow the steps proposed to &lt;a href="http://docs.docker.io/en/latest/installation/ubuntulinux/"&gt;install Docker on an Ubuntu
Linux&lt;/a&gt; (for instance in a VM).&lt;/p&gt;
&lt;h2&gt;Using ZNC setup wizard&lt;/h2&gt;
&lt;p&gt;Once Docker is installed on the system, we can prepare an image that
will be used to run ZNC with the following &lt;code&gt;Dockerfile&lt;/code&gt; (Docker
configuration file):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FROM ubuntu:precise
MAINTAINER Florent Flament

# Using fr ubuntu mirrors and adding universe repository, to install znc
RUN echo &amp;quot;deb http://fr.archive.ubuntu.com/ubuntu precise main restricted&amp;quot; \
&amp;gt; /etc/apt/sources.list
RUN echo &amp;quot;deb http://fr.archive.ubuntu.com/ubuntu precise universe&amp;quot; \
&amp;gt;&amp;gt; /etc/apt/sources.list

# Installing znc package
RUN apt-get -y update
RUN apt-get -y install znc

# Creating directory to store znc configuration
RUN mkdir -m 775 /var/znc
RUN chgrp daemon /var/znc
USER daemon
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's assume that the &lt;code&gt;Dockerfile&lt;/code&gt; is stored in the &lt;code&gt;znc-noconf&lt;/code&gt;
directory. We can build the ZNC ready image with the following
command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ docker build -t znc:noconf znc-noconf/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The next step is to configure ZNC. The following command will run the
configuration wizard in a new container based on the previously
generated image:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ docker run -i -t znc:noconf -d /var/znc -c
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After having answered to all the questions, ZNC will generate its
configuration files. It will then be ready to run in daemon mode. Now
we can save a Docker image including ZNC's configuration files.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nv"&gt;CONT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;docker ps -a &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s2"&gt;&amp;quot;minutes ago&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; head -1 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
$ docker commit &lt;span class="se"&gt;\&lt;/span&gt;
&amp;gt; -run&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{&amp;quot;Cmd&amp;quot;: [&amp;quot;/usr/bin/znc&amp;quot;, &amp;quot;-f&amp;quot;, &amp;quot;-d&amp;quot;, &amp;quot;/var/znc/&amp;quot;], &amp;quot;User&amp;quot;: &amp;quot;daemon&amp;quot;}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
&amp;gt; &lt;span class="nv"&gt;$CONT&lt;/span&gt; znc:ready
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The ZNC image is now ready, and can be launched. In addition to launch
ZNC in a new container, the following command will map the host's 6697
TCP port on the container's 6697 port (assuming that ZNC has been
configured to listen to port 6697).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ docker run -d -p &lt;span class="m"&gt;6697&lt;/span&gt;:6697 znc:ready
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Using a previously made ZNC configuration file&lt;/h2&gt;
&lt;p&gt;One can setup a ZNC Docker container even quicker if he already has a
&lt;code&gt;znc.conf&lt;/code&gt; configuration file. One has to create a directory (for
instance &lt;code&gt;myznc/&lt;/code&gt;) containing both: &lt;code&gt;znc.conf&lt;/code&gt; and a &lt;code&gt;Dockerfile&lt;/code&gt;, with
the following content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FROM ubuntu:precise
MAINTAINER Florent Flament

# Using fr ubuntu mirrors and adding universe repository, to install znc
RUN echo &amp;quot;deb http://fr.archive.ubuntu.com/ubuntu precise main restricted&amp;quot; \
&amp;gt; /etc/apt/sources.list
RUN echo &amp;quot;deb http://fr.archive.ubuntu.com/ubuntu precise universe&amp;quot; \
&amp;gt;&amp;gt; /etc/apt/sources.list

# Installing znc package
RUN apt-get -y update
RUN apt-get -y install znc

# Creating directory to store znc configuration
RUN mkdir -m 775 /var/znc
# Generates key for SSL exchanges
RUN /usr/bin/znc -d /var/znc -p
# Copies ZNC configuration file
ADD znc.conf /var/znc/configs/
RUN chown -R daemon:daemon /var/znc
USER daemon

# Setting default container&amp;#39;s command
CMD [&amp;quot;/usr/bin/znc&amp;quot;, &amp;quot;-f&amp;quot;, &amp;quot;-d&amp;quot;, &amp;quot;/var/znc/&amp;quot;]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then the ZNC container can be launched right after having built the image:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ docker build -t znc:myznc myznc/
$ docker run -d -p &lt;span class="m"&gt;6697&lt;/span&gt;:6697 znc:myznc
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Update 2014/02/25&lt;/h2&gt;
&lt;p&gt;Here's an example of ZNC configuration file listening for SSL incoming
connexions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Listener4  = +6697

&lt;span class="nt"&gt;&amp;lt;User&lt;/span&gt; &lt;span class="err"&gt;USER1&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
        Pass       = PASSWORDHASHHERE
        Admin      = true
        Nick       = NICK1
        AltNick    = NICK2
        Ident      = NICK1
        RealName   = REALNAME
        Buffer     = 500
        KeepBuffer = true
        ChanModes  = +stn
        LoadModule = admin
        Server     = irc.freenode.net 6667 
        BindHost   = 0.0.0.0
&lt;span class="nt"&gt;&amp;lt;/User&amp;gt;&lt;/span&gt;

&lt;span class="nt"&gt;&amp;lt;User&lt;/span&gt; &lt;span class="err"&gt;USER2&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
        Pass       = PASSWORDHASHHERE
        Admin      = true
        Nick       = NICK1
        AltNick    = NICK2
        Ident      = NICK1
        RealName   = REALNAME
        Buffer     = 500
        KeepBuffer = true
        ChanModes  = +stn
        LoadModule = admin
        Server     = CUSTOMIRCSERVER +6697 IRCSERVERPASSWORD
        BindHost   = 0.0.0.0
&lt;span class="nt"&gt;&amp;lt;/User&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;PASSWORDHASHHERE&lt;/code&gt; can be generated by using &lt;code&gt;znc -s&lt;/code&gt;. IRC clients
(like xchat) have to be set up by specifying in the "Server Password"
field a user's credentials &lt;code&gt;&amp;lt;user&amp;gt;:&amp;lt;password&amp;gt;&lt;/code&gt; (i.e
USER1:PASSORDHASHHERE).&lt;/p&gt;</content><category term="misc"></category><category term="ZNC"></category><category term="Docker"></category><category term="IRC"></category></entry><entry><title>Ubuntu VM auto installation</title><link href="http://www.florentflament.com/blog/ubuntu-vm-auto-installation.html" rel="alternate"></link><published>2013-11-30T00:00:00+01:00</published><updated>2013-11-30T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2013-11-30:/blog/ubuntu-vm-auto-installation.html</id><summary type="html">&lt;p&gt;Installing a fresh Ubuntu, or any other Linux distribution, on a new
system is quite forward. The installer asks you a few question about
your country, keyboard, network, ... . Then it installs all the
required packages on the system, and makes it bootable.&lt;/p&gt;
&lt;p&gt;However, when playing with VMs (Virtual Machines), you â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Installing a fresh Ubuntu, or any other Linux distribution, on a new
system is quite forward. The installer asks you a few question about
your country, keyboard, network, ... . Then it installs all the
required packages on the system, and makes it bootable.&lt;/p&gt;
&lt;p&gt;However, when playing with VMs (Virtual Machines), you may wish to
install your distribution many times ; in which case the installation
process (with the questions to answer) becomes somehow tedious.&lt;/p&gt;
&lt;p&gt;There are several approaches to deal with this issue. This post will
deal with the automatic installation of an Ubuntu 12.04 Precise, by
using &lt;a href="http://www.debian.org/releases/stable/i386/apbs02.html.en"&gt;Debian preseeding mecanism&lt;/a&gt; with virt-install (virtinst
package).&lt;/p&gt;
&lt;p&gt;An alternative approach would be to do a manual full installation,
then making several copies of the installed image. Each copy will be
customized to be used for a new VM. These two methods have their pros
and cons, and can be used together.&lt;/p&gt;
&lt;p&gt;A running system with libvirt and virtinst packages is required. The
key of a preseed automatic installation is to have the good
&lt;code&gt;preseed.cfg&lt;/code&gt; file. This file will provide the Debian installer (also
used by Ubuntu) with all the information it requires to install and
configure the system, without the need to ask any question.&lt;/p&gt;
&lt;h2&gt;Preseed file&lt;/h2&gt;
&lt;p&gt;Here's my generic &lt;a href="http://www.florentflament.com/blog/static/preseed.cfg"&gt;preseed.cfg&lt;/a&gt; file. It is a mix of &lt;a href="http://www.debian.org/releases/squeeze/example-preseed.txt"&gt;Debian's
example-preseed&lt;/a&gt; file and parameters gathered using Debian's
suggested method after a manual installation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;debconf-get-selections --installer &amp;gt; file
debconf-get-selections &amp;gt;&amp;gt; file
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The password for the &lt;code&gt;vmuser&lt;/code&gt; user has to be set, by changing the
current CRACKMECRACKM encrypted password to a valid one. A valid
crypted password can be generated with the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python -c &lt;span class="s1"&gt;&amp;#39;from crypt import crypt; print crypt(&amp;quot;MYPASSWORD&amp;quot;, &amp;quot;SALT&amp;quot;)&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Some other parameters may be customized, like locale, user name, ...&lt;/p&gt;
&lt;h2&gt;Empty image creation&lt;/h2&gt;
&lt;p&gt;Then we need to create an empty disk that will be used to install the
system. A 5GB disk should be enough for a minimal Ubuntu installation
(depending on one's requirements).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;qemu-img create vm.qcow2 5G
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;virt-install&lt;/h2&gt;
&lt;p&gt;Installing Ubuntu Precise on a VM can now be launched with the
following unique command (to be customized):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;virt-install &lt;span class="se"&gt;\&lt;/span&gt;
--name vm &lt;span class="se"&gt;\&lt;/span&gt;
--ram &lt;span class="m"&gt;128&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--location http://fr.archive.ubuntu.com/ubuntu/dists/precise-proposed/main/installer-i386/ &lt;span class="se"&gt;\&lt;/span&gt;
--disk vm.qcow2,bus&lt;span class="o"&gt;=&lt;/span&gt;virtio &lt;span class="se"&gt;\&lt;/span&gt;
--graphics vnc,keymap&lt;span class="o"&gt;=&lt;/span&gt;local,listen&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.0.0.0,port&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5900&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--network user,model&lt;span class="o"&gt;=&lt;/span&gt;virtio &lt;span class="se"&gt;\&lt;/span&gt;
--initrd-inject preseed.cfg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note that the &lt;code&gt;precise-proposed&lt;/code&gt; Ubuntu distribution is used instead
of the standard &lt;code&gt;precise&lt;/code&gt;. It addresses a &lt;a href="https://bugs.launchpad.net/ubuntu/+source/net-retriever/+bug/1067934"&gt;bug that makes the
installation freeze for 10+ minutes&lt;/a&gt; during the components download
phase.&lt;/p&gt;
&lt;p&gt;After some 30 minutes the system installation should be completed.&lt;/p&gt;</content><category term="misc"></category><category term="Ubuntu"></category><category term="KVM"></category><category term="libvirt"></category></entry><entry><title>Macmini2,1 Linux dual boot</title><link href="http://www.florentflament.com/blog/macmini21-linux-dual-boot.html" rel="alternate"></link><published>2013-11-03T00:00:00+01:00</published><updated>2013-11-03T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2013-11-03:/blog/macmini21-linux-dual-boot.html</id><summary type="html">&lt;p&gt;While online resources provide documentation about &lt;a href="https://wiki.debian.org/MacMiniIntel"&gt;how to install
Linux on a Mac Mini&lt;/a&gt;, this guide focuses on the Apple Macmini2,1
and its peculiarities. Please refer to &lt;a href="http://en.wikipedia.org/wiki/Macmini#Specifications"&gt;these tables&lt;/a&gt; to properly
identify your hardware.&lt;/p&gt;
&lt;h2&gt;About Macmini2,1&lt;/h2&gt;
&lt;p&gt;Apple provides &lt;a href="http://support.apple.com/kb/HT1237"&gt;firmware updates&lt;/a&gt; for most of its hardware. Most
Mac Minis â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;While online resources provide documentation about &lt;a href="https://wiki.debian.org/MacMiniIntel"&gt;how to install
Linux on a Mac Mini&lt;/a&gt;, this guide focuses on the Apple Macmini2,1
and its peculiarities. Please refer to &lt;a href="http://en.wikipedia.org/wiki/Macmini#Specifications"&gt;these tables&lt;/a&gt; to properly
identify your hardware.&lt;/p&gt;
&lt;h2&gt;About Macmini2,1&lt;/h2&gt;
&lt;p&gt;Apple provides &lt;a href="http://support.apple.com/kb/HT1237"&gt;firmware updates&lt;/a&gt; for most of its hardware. Most
Mac Minis do have an EFI Boot ROM update available there, but
Macmini2,1 doesn't. The good news is that what is stated on this page
is true, Macmini2,1 doesn't need any firmware update to be able to
boot non MacOS OSes.&lt;/p&gt;
&lt;p&gt;Macmini2,1 is powered by an Intel Core 2 Duo, which is a &lt;a href="http://en.wikipedia.org/wiki/Core_2_duo#64-bit_Core_microarchitecture_based"&gt;64-bit
processor&lt;/a&gt;. However, when trying to install a 64 bits Linux
distribution from a CDROM (by pressing the C key during boot sequence,
right after the startup sound), the installer hangs up on a text
screen, while seemingly starting to display a grub menu (I experienced
this with amd64 ISOs of Debian Wheezy, Debian Jessie and Xubuntu
Precise). With i386 images of these same distributions, the installer
starts in graphic mode without issue.&lt;/p&gt;
&lt;p&gt;However, I could find a way to install a 64 bits OS on the machine, by
booting the machine on a &lt;a href="http://rom-o-matic.net/gpxe/gpxe-git/gpxe.git/contrib/rom-o-matic/"&gt;CDROM launching a PXE installation&lt;/a&gt; over
the network. By using this mechanism, I succeeded in installing an
amd64 Ubuntu Precise Linux distribution. Note that I've been
unsuccessful in starting the computer from a USB key, or directly over
PXE.&lt;/p&gt;
&lt;h2&gt;Setting dual boot&lt;/h2&gt;
&lt;p&gt;On original Max OS X installations, the whole hard disk is occupied by
a unique partition. Therefore, we need to free some space for our new
OS, by resizing the partition. The &lt;code&gt;diskutil&lt;/code&gt; command allows us to do
that. In a shell, we have to launch the following command (where 20G
means that we want to let 20 Gigabytes to our OS X partition. One may
split the disk capacity according to its requirements):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo diskutil resizeVolume disk0s2 20G
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we have to install &lt;a href="http://refit.sourceforge.net/"&gt;rEFit&lt;/a&gt; on the computer. It will allow us
to choose the partition / device to boot, and to resynchronize GPT /
MBR tables as will be covered in a next step.&lt;/p&gt;
&lt;p&gt;We can now insert the Linux distribution installation CD into our Mac
(I downloaded the last &lt;a href="http://www.debian.org/distrib/netinst"&gt;Debian stable i386 netinst ISO&lt;/a&gt; and burned
it to a CD-RW with the Mac Mini's CD burner). When restarting the
computer, rEFit will allow us to boot on the CD.&lt;/p&gt;
&lt;p&gt;During the installation process, we have to create new partition(s)
(for convenience, I chose a distinct / and /home partitions). When
asked to install grub, choose &lt;code&gt;/dev/sda4&lt;/code&gt; (the partition that will be
mounted as /).&lt;/p&gt;
&lt;p&gt;Once the Linux installation is finished, reboot and use rEFit
&lt;code&gt;Partition Tool&lt;/code&gt; to resync GPT / MBR tables. Then boot back to MacOS
and use its &lt;code&gt;bless&lt;/code&gt; tool to make the new OS bootable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo bless --device /dev/disk0s4 -setBoot
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Eventually, we can customize the rEFit configuration file
&lt;code&gt;/efi/refit/refit.conf&lt;/code&gt; to make the boot sequence more convenient. The
rEFit menu timeout can be set with the &lt;code&gt;timeout&lt;/code&gt; option. The option
&lt;code&gt;default_selection&lt;/code&gt; (at the end of the file) allows us to choose the
default OS to boot.&lt;/p&gt;
&lt;p&gt;That's it ! Restart, rEFit allows us to choose between booting Mac OS
X and Linux.&lt;/p&gt;</content><category term="misc"></category><category term="Apple"></category><category term="Linux"></category></entry></feed>