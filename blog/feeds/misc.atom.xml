<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Florent Flament 2 cents - misc</title><link href="http://www.florentflament.com/blog/" rel="alternate"></link><link href="http://www.florentflament.com/blog/feeds/misc.atom.xml" rel="self"></link><id>http://www.florentflament.com/blog/</id><updated>2020-05-30T00:00:00+02:00</updated><entry><title>Ceph monitor status switching due to slow IOs</title><link href="http://www.florentflament.com/blog/ceph-monitor-status-switching-due-to-slow-ios.html" rel="alternate"></link><published>2020-05-30T00:00:00+02:00</published><updated>2020-05-30T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2020-05-30:/blog/ceph-monitor-status-switching-due-to-slow-ios.html</id><summary type="html">&lt;p&gt;I deployed a Ceph cluster (Nautilus, then upgraded to the Octopus
release) to store my personal data a few months ago. So far it has
been working pretty well, apart from a 1 hour partial outage that
won't be covered there, most probably linked to the issue described.&lt;/p&gt;
&lt;p&gt;That said …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I deployed a Ceph cluster (Nautilus, then upgraded to the Octopus
release) to store my personal data a few months ago. So far it has
been working pretty well, apart from a 1 hour partial outage that
won't be covered there, most probably linked to the issue described.&lt;/p&gt;
&lt;p&gt;That said, I noticed that &lt;code&gt;mon.cephpi&lt;/code&gt; was seen down for a few seconds
every few minutes, and that it happened during leader elections. And
when &lt;code&gt;mon.cephpi&lt;/code&gt; goes back online, it seems triggers a new election a
few seconds after the previous one. (There &lt;code&gt;mon.cephpi&lt;/code&gt; is also a bit
low on disk space, but that's not related to the issue under
examination).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@ceph-mon0:/var/log/ceph# zgrep ^2020-05-30T00:5 ceph.log.1.gz | egrep &amp;quot;INF|WRN&amp;quot;
2020-05-30T00:50:54.874314+0200 mon.yumy (mon.1) 26519 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:50:54.907529+0200 mon.ceph-mon0 (mon.0) 27086 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:50:59.916206+0200 mon.ceph-mon0 (mon.0) 27087 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy in quorum (ranks 0,1)
2020-05-30T00:51:00.026583+0200 mon.ceph-mon0 (mon.0) 27092 : cluster [WRN] Health check failed: 1/3 mons down, quorum ceph-mon0,yumy (MON_DOWN)
2020-05-30T00:51:00.026770+0200 mon.ceph-mon0 (mon.0) 27093 : cluster [INF] Health check cleared: MON_DISK_LOW (was: mon cephpi is low on available space)
2020-05-30T00:51:00.129247+0200 mon.ceph-mon0 (mon.0) 27094 : cluster [WRN] overall HEALTH_WARN 1/3 mons down, quorum ceph-mon0,yumy
2020-05-30T00:51:06.174123+0200 mon.cephpi (mon.2) 250 : cluster [INF] mon.cephpi calling monitor election
2020-05-30T00:51:06.239131+0200 mon.yumy (mon.1) 26520 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:51:06.240313+0200 mon.ceph-mon0 (mon.0) 27102 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:51:06.286552+0200 mon.ceph-mon0 (mon.0) 27103 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy,cephpi in quorum (ranks 0,1,2)
2020-05-30T00:51:06.403610+0200 mon.ceph-mon0 (mon.0) 27108 : cluster [INF] Health check cleared: MON_DOWN (was: 1/3 mons down, quorum ceph-mon0,yumy)
2020-05-30T00:51:06.403837+0200 mon.ceph-mon0 (mon.0) 27109 : cluster [INF] Cluster is now healthy
2020-05-30T00:51:06.517425+0200 mon.ceph-mon0 (mon.0) 27110 : cluster [INF] overall HEALTH_OK
2020-05-30T00:51:11.180148+0200 mon.ceph-mon0 (mon.0) 27116 : cluster [WRN] Health check failed: mon cephpi is low on available space (MON_DISK_LOW)
2020-05-30T00:52:42.757032+0200 mon.cephpi (mon.2) 251 : cluster [INF] mon.cephpi calling monitor election
2020-05-30T00:52:42.847724+0200 mon.ceph-mon0 (mon.0) 27203 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:52:42.867228+0200 mon.yumy (mon.1) 26521 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:52:42.932928+0200 mon.ceph-mon0 (mon.0) 27204 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy,cephpi in quorum (ranks 0,1,2)
2020-05-30T00:52:43.223146+0200 mon.ceph-mon0 (mon.0) 27210 : cluster [WRN] overall HEALTH_WARN mon cephpi is low on available space
2020-05-30T00:56:46.567727+0200 mon.yumy (mon.1) 26522 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:56:46.589153+0200 mon.ceph-mon0 (mon.0) 27448 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:56:51.599236+0200 mon.ceph-mon0 (mon.0) 27449 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy in quorum (ranks 0,1)
2020-05-30T00:56:51.700268+0200 mon.ceph-mon0 (mon.0) 27454 : cluster [WRN] Health check failed: 1/3 mons down, quorum ceph-mon0,yumy (MON_DOWN)
2020-05-30T00:56:51.700470+0200 mon.ceph-mon0 (mon.0) 27455 : cluster [INF] Health check cleared: MON_DISK_LOW (was: mon cephpi is low on available space)
2020-05-30T00:56:51.801453+0200 mon.ceph-mon0 (mon.0) 27456 : cluster [WRN] overall HEALTH_WARN 1/3 mons down, quorum ceph-mon0,yumy
2020-05-30T00:57:04.048894+0200 mon.ceph-mon0 (mon.0) 27469 : cluster [INF] mon.ceph-mon0 calling monitor election
2020-05-30T00:57:04.060391+0200 mon.yumy (mon.1) 26523 : cluster [INF] mon.yumy calling monitor election
2020-05-30T00:57:04.135749+0200 mon.ceph-mon0 (mon.0) 27470 : cluster [INF] mon.ceph-mon0 is new leader, mons ceph-mon0,yumy,cephpi in quorum (ranks 0,1,2)
2020-05-30T00:57:04.322415+0200 mon.ceph-mon0 (mon.0) 27476 : cluster [INF] Health check cleared: MON_DOWN (was: 1/3 mons down, quorum ceph-mon0,yumy)
2020-05-30T00:57:04.322579+0200 mon.ceph-mon0 (mon.0) 27477 : cluster [INF] Cluster is now healthy
2020-05-30T00:57:05.149468+0200 mon.ceph-mon0 (mon.0) 27478 : cluster [INF] overall HEALTH_OK
2020-05-30T00:57:08.912387+0200 mon.ceph-mon0 (mon.0) 27483 : cluster [WRN] Health check failed: mon cephpi is low on available space (MON_DISK_LOW)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Sometimes, I was also seeing &lt;code&gt;check_auth_rotating possible clock skew,
rotating keys expired way too early&lt;/code&gt; messages in the logs of
non-monitor daemons (MDS, managers or OSD alike).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@cephpi:/var/log/ceph# zgrep &amp;#39;clock skew&amp;#39; ceph-osd.0.log.1.gz 
2020-05-30T00:56:56.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:56.555279+0200)
2020-05-30T00:56:56.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:56.556551+0200)
2020-05-30T00:56:57.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:57.555610+0200)
2020-05-30T00:56:57.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:57.556922+0200)
2020-05-30T00:56:58.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:58.555918+0200)
2020-05-30T00:56:58.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:58.557175+0200)
2020-05-30T00:56:59.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:59.556250+0200)
2020-05-30T00:56:59.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:56:59.557567+0200)
2020-05-30T00:57:00.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:00.556559+0200)
2020-05-30T00:57:00.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:00.557819+0200)
2020-05-30T00:57:01.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:01.556899+0200)
2020-05-30T00:57:01.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:01.558013+0200)
2020-05-30T00:57:02.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:02.557226+0200)
2020-05-30T00:57:02.553+0200 ffff9e734bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:02.558396+0200)
2020-05-30T00:57:03.553+0200 ffff9d732bc0 -1 monclient: _check_auth_rotating possible clock skew, rotating keys expired way too early (before 2020-05-29T23:57:03.557531+0200)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's focus on the time period between &lt;code&gt;2020-05-30T00:56:51&lt;/code&gt; and
&lt;code&gt;2020-05-30T00:57:04&lt;/code&gt;, i.e 00:56:51 and 00:57:04. Here's my assumption
about what happened:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;At 00:56:51 &lt;code&gt;mon.cephpi&lt;/code&gt; was seen down by &lt;code&gt;mon.ceph-mon0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;between 00:56:56 and 00:57:03 &lt;code&gt;ceph-osd@0&lt;/code&gt; obtained expired keys
  when trying to rotate them.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;At 00:57:04 &lt;code&gt;mon.cephpi&lt;/code&gt; was seen up by &lt;code&gt;mon.ceph-mon0&lt;/code&gt; and
  &lt;code&gt;ceph-osd@0&lt;/code&gt; could rotate its keys succesfully.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It looks like between 00:56:51 and 00:57:04 &lt;code&gt;mon.cephpi&lt;/code&gt; was out of
the quorum for 13 seconds and kept issuing expired keys to
&lt;code&gt;ceph-osd@0&lt;/code&gt; during that period.&lt;/p&gt;
&lt;p&gt;Let's have a look at the logs of &lt;code&gt;mon.cephpi&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Between 00:56:35 and 00:56:57, &lt;code&gt;mon.cephpi&lt;/code&gt; was apparently writing
  to its rocksdb database, and it took 22 seconds to write 49442280
  bytes (i.e 50MB). This is why it missed the leader election that
  happened between 00:56:46 and 00:56:51, which resulted in
  &lt;code&gt;mon.cephpi&lt;/code&gt; being flagged at down by the leader.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;At 00:56:57, when going back online, &lt;code&gt;mon.cephpi&lt;/code&gt; triggered a new
  election, which ended at 00:57:04, with &lt;code&gt;mon.cephpi&lt;/code&gt; being back in
  the monitors quorum, and able to issue valid keys again.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;2020-05-30T00:56:35.549+0200 ffffad98b400  4 rocksdb: [db/compaction_job.cc:1649] [default] Compaction start summary: Base version 1187 Base level 0, inputs: [48626(8490KB)], [48624(43MB)]
2020-05-30T00:56:35.549+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590792995552781, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;compaction_started&amp;quot;, &amp;quot;compaction_reason&amp;quot;: &amp;quot;ManualCompaction&amp;quot;, &amp;quot;files_L0&amp;quot;: [48626], &amp;quot;files_L6&amp;quot;: [48624], &amp;quot;score&amp;quot;: -1, &amp;quot;input_data_size&amp;quot;: 53833362}
2020-05-30T00:56:57.853+0200 ffffad98b400  4 rocksdb: [db/compaction_job.cc:1332] [default] [JOB 1188] Generated table #48627: 4687 keys, 49442280 bytes
2020-05-30T00:56:57.853+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793017855925, &amp;quot;cf_name&amp;quot;: &amp;quot;default&amp;quot;, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;table_file_creation&amp;quot;, &amp;quot;file_number&amp;quot;: 48627, &amp;quot;file_size&amp;quot;: 49442280, &amp;quot;table_properties&amp;quot;: {&amp;quot;data_size&amp;quot;: 49336024, &amp;quot;index_size&amp;quot;: 93526, &amp;quot;filter_size&amp;quot;: 11909, &amp;quot;raw_key_size&amp;quot;: 97594, &amp;quot;raw_average_key_size&amp;quot;: 20, &amp;quot;raw_value_size&amp;quot;: 49203175, &amp;quot;raw_average_value_size&amp;quot;: 10497, &amp;quot;num_data_blocks&amp;quot;: 2720, &amp;quot;num_entries&amp;quot;: 4687, &amp;quot;filter_policy_name&amp;quot;: &amp;quot;rocksdb.BuiltinBloomFilter&amp;quot;}}
2020-05-30T00:56:57.905+0200 ffffa797f400  1 mon.cephpi@2(electing) e14 collect_metadata :  no unique device id for : fallback method has no model nor serial&amp;#39;
2020-05-30T00:56:57.905+0200 ffffad98b400  4 rocksdb: [db/compaction_job.cc:1395] [default] [JOB 1188] Compacted 1@0 + 1@6 files to L6 =&amp;gt; 49442280 bytes
2020-05-30T00:56:58.001+0200 ffffad98b400  4 rocksdb: (Original Log Time 2020/05/30-00:56:58.003695) [db/compaction_job.cc:768] [default] compacted to: base level 6 level multiplier 10.00 max bytes base 268435456 files[0 0 0 0 0 0 1] max score 0.00, MB/sec: 2.4 rd, 2.2 wr, level 6, files in(1, 1) out(1) MB in(8.3, 43.0) out(47.2), read-write-amplify(11.9) write-amplify(5.7) OK, records in: 5202, records dropped: 515 output_compression: NoCompression
2020-05-30T00:56:58.001+0200 ffffad98b400  4 rocksdb: (Original Log Time 2020/05/30-00:56:58.003819) EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793018003758, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;compaction_finished&amp;quot;, &amp;quot;compaction_time_micros&amp;quot;: 22303522, &amp;quot;compaction_time_cpu_micros&amp;quot;: 1184121, &amp;quot;output_level&amp;quot;: 6, &amp;quot;num_output_files&amp;quot;: 1, &amp;quot;total_output_size&amp;quot;: 49442280, &amp;quot;num_input_records&amp;quot;: 5202, &amp;quot;num_output_records&amp;quot;: 4687, &amp;quot;num_subcompactions&amp;quot;: 1, &amp;quot;output_compression&amp;quot;: &amp;quot;NoCompression&amp;quot;, &amp;quot;num_single_delete_mismatches&amp;quot;: 0, &amp;quot;num_single_delete_fallthrough&amp;quot;: 0, &amp;quot;lsm_state&amp;quot;: [0, 0, 0, 0, 0, 0, 1]}
2020-05-30T00:56:58.005+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793018011605, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;table_file_deletion&amp;quot;, &amp;quot;file_number&amp;quot;: 48626}
2020-05-30T00:56:58.021+0200 ffffad98b400  4 rocksdb: EVENT_LOG_v1 {&amp;quot;time_micros&amp;quot;: 1590793018027883, &amp;quot;job&amp;quot;: 1188, &amp;quot;event&amp;quot;: &amp;quot;table_file_deletion&amp;quot;, &amp;quot;file_number&amp;quot;: 48624}
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:56:58.025+0200 ffffa3176400  4 rocksdb: [db/db_impl_compaction_flush.cc:1403] [default] Manual compaction starting
2020-05-30T00:57:03.905+0200 ffffaa184400  1 paxos.2).electionLogic(33771) init, last seen epoch 33771, mid-election, bumping
2020-05-30T00:57:04.045+0200 ffffaa184400  1 mon.cephpi@2(electing) e14 collect_metadata :  no unique device id for : fallback method has no model nor serial&amp;#39;
2020-05-30T00:57:04.125+0200 ffffa797f400  1 mon.cephpi@2(electing) e14 collect_metadata :  no unique device id for : fallback method has no model nor serial&amp;#39;
2020-05-30T00:57:07.905+0200 ffffaa184400  1 mon.cephpi@2(peon).osd e4911 _set_new_cache_sizes cache_size:1020054731 inc_alloc: 71303168 full_alloc: 71303168 kv_alloc: 876609536
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Let's do a quick check to see if how long it takes for cephpi to write
on the monitor's partition:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@cephpi:~# time sh -c &amp;quot;dd if=/dev/zero of=test bs=1M count=50; sync&amp;quot;
50+0 records in
50+0 records out
52428800 bytes (52 MB, 50 MiB) copied, 9.84231 s, 5.3 MB/s

real    0m10.375s
user    0m0.001s
sys     0m0.290s
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Indeed, it takes &lt;code&gt;cephpi&lt;/code&gt; 10 seconds to write 50MB of zeros. Which
makes sense because it is a Raspberry Pi with a MicroSD card used to
store the monitor's database. On the other hand writing 50MB to a
standard spinning disk takes less than 2 seconds:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;svc@yumy:/tmp$ time sh -c &amp;quot;dd if=/dev/zero of=test bs=1M count=50; sync&amp;quot;
50+0 records in
50+0 records out
52428800 bytes (52 MB, 50 MiB) copied, 0.111206 s, 471 MB/s

real    0m1.492s
user    0m0.003s
sys 0m0.117s
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Resolution&lt;/h2&gt;
&lt;p&gt;I eventually plugged a USB disk on &lt;code&gt;cephpi&lt;/code&gt; to store &lt;code&gt;mon.cephpi&lt;/code&gt;
data. It has been running for a few hour now, without any &lt;code&gt;MON_DOWN&lt;/code&gt;
event, nor any leader election triggered.&lt;/p&gt;
&lt;p&gt;In conclusion, one should avoid using slow storage devices (i.e SD
cards or USB sticks) to store Ceph monitors data. Monitors need to
write chunks of data (of 50MB in this case) at regular intervals in
less than a few seconds (less than 5 seconds I guess); otherwise, they
end up switching in and out of the monitors quorum and triggering many
elections.&lt;/p&gt;</content><category term="misc"></category><category term="Ceph"></category></entry><entry><title>Attempting to mine Cryptocurrency with an old machine</title><link href="http://www.florentflament.com/blog/attempting-to-mine-cryptocurrency-with-an-old-machine.html" rel="alternate"></link><published>2019-04-13T00:00:00+02:00</published><updated>2019-04-13T00:00:00+02:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2019-04-13:/blog/attempting-to-mine-cryptocurrency-with-an-old-machine.html</id><summary type="html">&lt;p&gt;This is the story of me attempting to convert an old machine into a
Cryptocurrency miner. I basically tried to plug my AMD Radeon RX 480
graphic card into an old PC, a Core 2 duo with 4GB RAM and a
GF7050T-M5 motherboard.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;According to the &lt;a href="https://www.manualslib.com/manual/451735/Ecs-Gf7050vt-M5.html"&gt;GF7050T-M5 manual&lt;/a&gt;, its PCI …&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;This is the story of me attempting to convert an old machine into a
Cryptocurrency miner. I basically tried to plug my AMD Radeon RX 480
graphic card into an old PC, a Core 2 duo with 4GB RAM and a
GF7050T-M5 motherboard.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;According to the &lt;a href="https://www.manualslib.com/manual/451735/Ecs-Gf7050vt-M5.html"&gt;GF7050T-M5 manual&lt;/a&gt;, its PCI Express bus is most
  probably a PCI Express 1.0 x16 bus.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;While the &lt;a href="https://www.diamondmm.com/images/480X/RX480D58G%20%20setup%20sheet.pdf"&gt;AMD Radeon RX 480&lt;/a&gt; has a PCI Express 3.0 x16
  interface.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/PCI_Express"&gt;Wikipedia's PCI Express pages&lt;/a&gt; is not very clear regarding the
compatibility between PCI Express 3.0 and 1.0. At the very least, the
PCI Express 3.0 card fits into the PCI Express 1.0 slot. In the end, I
couldn't have the card working properly on the machine, though I did a
number of interesting findings.&lt;/p&gt;
&lt;h2&gt;Booting on USB key&lt;/h2&gt;
&lt;p&gt;I made several OS installations (Ubuntu) on the machine using a
rewritable DVD-RW, because I failed to boot on a USB key. After
spending a bunch of time exploring the BIOS menu, I figured out that
the board allowed booting on USB keys with the following settings (in
the correct order):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;USB Legacy enabled&lt;/li&gt;
&lt;li&gt;Reboot, to have the USB key recognized by the BIOS&lt;/li&gt;
&lt;li&gt;First hard drive set to the USB key&lt;/li&gt;
&lt;li&gt;First boot device set to the USB key&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This allowed much faster iterations, especially because I had to
remove the Radeon card to plug the DVD reader (The connector is placed
below the card, once plugged).&lt;/p&gt;
&lt;h2&gt;Working text mode&lt;/h2&gt;
&lt;p&gt;Ubuntu 18.04 desktop, 18.04 server and 16.04 desktop installs load the
&lt;code&gt;amdgpu&lt;/code&gt; driver at some point during boot time. When the Radeon RX 480
is plugged in the machine, the screen turns black at this moment. This
looks like the machine is completely crashed, but only the display is
actually missing. I can still connect to the machine through SSH
(having setup an SSH server before plugging the Radeon card).&lt;/p&gt;
&lt;p&gt;Ubuntu 16.04 server never loads the &lt;code&gt;amdgpu&lt;/code&gt; driver by default,
neither during the installation process, nor when booting on the
installed OS. I could install Ubuntu 16.04 server from a USB key and
run it properly, while the AMD Radeon card was plugged into the
machine.&lt;/p&gt;
&lt;h2&gt;Driver crash&lt;/h2&gt;
&lt;p&gt;Both &lt;code&gt;amdgpu&lt;/code&gt; and &lt;code&gt;amdgpu-pro&lt;/code&gt; drivers crashed when loaded, whatever
the OS version I used:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ubuntu 16.04.3&lt;/li&gt;
&lt;li&gt;Ubuntu 16.04.5&lt;/li&gt;
&lt;li&gt;Ubuntu 18.04.2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The following trace is a typical one obtained from &lt;code&gt;dmesg&lt;/code&gt; when
loading the &lt;code&gt;amdgpu&lt;/code&gt; module. This one was obtained after having
installed the &lt;code&gt;amdgpu-pro-17.40&lt;/code&gt; driver on Ubuntu 16.04.3:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ dmesg | grep &amp;quot;\[drm&amp;quot;
[    1.266917] [drm] Initialized drm 1.1.0 20060810
[    1.420705] [drm] amdgpu kernel modesetting enabled.
[    1.450320] [drm] initializing kernel modesetting (POLARIS10 0x1002:0x67DF 0x1002:0x0B37 0xC7).
[    1.450338] [drm] register mmio base: 0xFEBC0000
[    1.450342] [drm] register mmio size: 262144
[    1.450353] [drm] probing gen 2 caps for device 10de:56e = 113d01/0
[    1.450358] [drm] probing mlw for device 10de:56e = 113d01
[    1.450372] [drm] UVD is enabled in VM mode
[    1.450376] [drm] VCE enabled in VM mode
[    1.451068] [drm] GPU post is not needed
[    1.451090] [drm] vm size is 32 GB, block size is 13-bit, fragment size is 4-bit
[    1.451169] [drm] Detected VRAM RAM=8192M, BAR=256M
[    1.451173] [drm] RAM width 256bits GDDR5
[    1.451281] [drm] amdgpu: 8192M of VRAM memory ready
[    1.451286] [drm] amdgpu: 8192M of GTT memory ready.
[    1.451299] [drm] GART: num cpu pages 65536, num gpu pages 65536
[    1.451347] [drm] PCIE GART of 256M enabled (table at 0x000000F400040000).
[    1.451466] [drm] amdgpu: irq initialized.
[    1.623059] [drm] Chained IB support enabled!
[    1.624743] [drm] Found UVD firmware Version: 1.79 Family ID: 16
[    1.625444] [drm] Found VCE firmware Version: 52.4 Binary ID: 3
[    1.673073] [drm:amdgpu_mm_wdoorbell [amdgpu]] *ERROR* writing beyond doorbell aperture: 0x000001e8!
[    1.678312] [drm] DAL is enabled
[    1.678667] [drm] DM_PPLIB: values for Engine clock
[    1.678671] [drm] DM_PPLIB:   30000
[    1.678675] [drm] DM_PPLIB:   60800
[    1.678678] [drm] DM_PPLIB:   91000
[    1.678681] [drm] DM_PPLIB:   107700
[    1.678685] [drm] DM_PPLIB:   114500
[    1.678688] [drm] DM_PPLIB:   119100
[    1.678691] [drm] DM_PPLIB:   123600
[    1.678695] [drm] DM_PPLIB:   126600
[    1.678698] [drm] DM_PPLIB: Warning: using default validation clocks!
[    1.678702] [drm] DM_PPLIB: Validation clocks:
[    1.678706] [drm] DM_PPLIB:    engine_max_clock: 72000
[    1.678709] [drm] DM_PPLIB:    memory_max_clock: 80000
[    1.678713] [drm] DM_PPLIB:    level           : 0
[    1.678717] [drm] DM_PPLIB: reducing engine clock level from 8 to 2
[    1.678721] [drm] DM_PPLIB: values for Memory clock
[    1.678725] [drm] DM_PPLIB:   30000
[    1.678728] [drm] DM_PPLIB:   200000
[    1.678732] [drm] DM_PPLIB: Warning: using default validation clocks!
[    1.678735] [drm] DM_PPLIB: Validation clocks:
[    1.678739] [drm] DM_PPLIB:    engine_max_clock: 72000
[    1.678742] [drm] DM_PPLIB:    memory_max_clock: 80000
[    1.678746] [drm] DM_PPLIB:    level           : 0
[    1.678750] [drm] DM_PPLIB: reducing memory clock level from 2 to 1
[    1.678755] [drm] DC: create_links: connectors_num: physical:4, virtual:0
[    1.678764] [drm] Connector[0] description:signal 32
[    1.678771] [drm] Using channel: CHANNEL_ID_DDC1 [1]
[    1.678788] [drm] Connector[1] description:signal 32
[    1.678794] [drm] Using channel: CHANNEL_ID_DDC3 [3]
[    1.678810] [drm] Connector[2] description:signal 32
[    1.678815] [drm] Using channel: CHANNEL_ID_DDC2 [2]
[    1.678831] [drm] Connector[3] description:signal 4
[    1.678837] [drm] Using channel: CHANNEL_ID_DDC4 [4]
[    1.692079] [drm] Display Core initialized
[    1.692095] [drm] amdgpu: freesync_module init done ffff8800ca602700.
[    1.692603] [drm] link=0, dc_sink_in=          (null) is now Disconnected
[    1.692609] [drm] DCHPD: connector_id=0: dc_sink didn&amp;#39;t change.
[    1.693057] [drm] link=1, dc_sink_in=          (null) is now Disconnected
[    1.693062] [drm] DCHPD: connector_id=1: dc_sink didn&amp;#39;t change.
[    1.693490] [drm] link=2, dc_sink_in=          (null) is now Disconnected
[    1.693495] [drm] DCHPD: connector_id=2: dc_sink didn&amp;#39;t change.
[    1.718488] [drm] [Detect]   [HDMIA][ConnIdx:3] SAMSUNG: [Block 0] 00 FF FF FF FF FF FF 00 4C 2D A4 02 00 00 00 00 2E 10 01 03 80 10 09 8C 0A E2 BD A1 5B 4A 98 24 15 47 4A A1 08 00 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 01 66 21 50 B0 51 00 1B 30 40 70 36 00 A0 5A 00 00 00 1E 01 1D 00 72 51 D0 1E 20 6E 28 55 00 A0 5A 00 00 00 1E 00 00 00 FD 00 31 47 0F 32 09 00 0A 20 20 20 20 20 20 00 00 00 FC 00 53 41 4D 53 55 4E 47 0A 20 20 20 20 20 01 15 ^
[    1.718522] [drm] [Detect]   [HDMIA][ConnIdx:3] SAMSUNG: [Block 1] 02 03 1A F1 46 84 13 05 14 03 12 23 09 07 07 83 01 00 00 66 03 0C 00 20 00 80 01 1D 00 BC 52 D0 1E 20 B8 28 55 40 A0 5A 00 00 00 1E 01 1D 80 18 71 1C 16 20 58 2C 25 00 A0 5A 00 00 00 9E 01 1D 80 D0 72 1C 16 20 10 2C 25 80 A0 5A 00 00 00 9E 8C 0A D0 8A 20 E0 2D 10 10 3E 96 00 A0 5A 00 00 00 18 8C 0A D0 90 20 40 31 20 0C 40 55 00 A0 5A 00 00 00 18 00 00 00 00 00 00 00 00 00 00 00 69 ^
[    1.718542] [drm] dc_link_detect: manufacturer_id = 2D4C, product_id = 2A4, serial_number = 0, manufacture_week = 46, manufacture_year = 16, display_name = SAMSUNG, speaker_flag = 1, audio_mode_count = 1
[    1.718552] [drm] dc_link_detect: mode number = 0, format_code = 1, channel_count = 1, sample_rate = 7, sample_size = 7
[    1.718559] [drm] link=3, dc_sink_in=ffff880034b69000 is now Connected
[    1.718564] [drm] DCHPD: connector_id=3: Old sink=          (null) New sink=ffff880034b69000
[    1.718588] [drm] Supports vblank timestamp caching Rev 2 (21.10.2013).
[    1.718592] [drm] Driver supports precise vblank timestamp query.
[    1.718596] [drm] KMS initialized.
[    1.721322] [drm:amdgpu_mm_wdoorbell [amdgpu]] *ERROR* writing beyond doorbell aperture: 0x00000020!
[    1.721372] [drm:amdgpu_mm_wdoorbell [amdgpu]] *ERROR* writing beyond doorbell aperture: 0x00000020!
[    1.909995] [drm:gfx_v8_0_ring_test_ring [amdgpu]] *ERROR* amdgpu: ring 0 test failed (scratch(0xC040)=0xCAFEDEAD)
[    1.910050] [drm:amdgpu_device_init [amdgpu]] *ERROR* hw_init of IP block &amp;lt;gfx_v8_0&amp;gt; failed -22
[    2.047138] [drm] amdgpu: ttm finalized
[    2.047152] [drm] amdgpu: finishing device.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;When trying to google for the error messages like &lt;code&gt;*ERROR* writing
beyond doorbell aperture&lt;/code&gt;, the only pages found were the &lt;a href="https://github.com/torvalds/linux/blob/master/drivers/gpu/drm/amd/amdgpu/amdgpu_device.c"&gt;Linux source
code on github&lt;/a&gt;. This makes me believe that only a few people tried
such a crazy experiment. Therefore, it would probably require a
significant effort (that may not be worth) to have this setup working.&lt;/p&gt;
&lt;h2&gt;Giving up&lt;/h2&gt;
&lt;p&gt;After having messed around a few days (I even tried to plug the power
supply from a computer where the Radeon card is working well, with no
better outcome), I decided to plug the graphic card back to the
computer it was shipped with. At least, it is still working ; )&lt;/p&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.manualslib.com/manual/451735/Ecs-Gf7050vt-M5.html"&gt;GF7050T-M5 manual&lt;/a&gt; is available online.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.amd.com/en/products/graphics/radeon-rx-480"&gt;AMD Radeon RX 480 specifications&lt;/a&gt; are available too.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.diamondmm.com/images/480X/RX480D58G%20%20setup%20sheet.pdf"&gt;Diamond AMD Radeon RX 480 specs&lt;/a&gt; provide a bit more details.&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="AMD"></category><category term="Radeon"></category><category term="RX 480"></category><category term="GPU"></category><category term="Old Hardware"></category><category term="Cryptocurrency"></category><category term="GF7050T-M5"></category></entry><entry><title>AMD RX 480 GPU OpenCL benchmark</title><link href="http://www.florentflament.com/blog/amd-rx-480-gpu-opencl-benchmark.html" rel="alternate"></link><published>2018-12-25T00:00:00+01:00</published><updated>2018-12-25T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2018-12-25:/blog/amd-rx-480-gpu-opencl-benchmark.html</id><summary type="html">&lt;p&gt;This post summarizes the results of my &lt;a href="https://github.com/FlorentFlament/amd-gpu-benchmark"&gt;AMD GPU benchmark code&lt;/a&gt; to
benchmark the computing power of an AMD Radeon RX 480 GPU against an
Intel Core i5-7400 CPU.&lt;/p&gt;
&lt;p&gt;The benchmarking code I am running on is the following code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;__kernel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kerntest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__global&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;loops_cnt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;This post summarizes the results of my &lt;a href="https://github.com/FlorentFlament/amd-gpu-benchmark"&gt;AMD GPU benchmark code&lt;/a&gt; to
benchmark the computing power of an AMD Radeon RX 480 GPU against an
Intel Core i5-7400 CPU.&lt;/p&gt;
&lt;p&gt;The benchmarking code I am running on is the following code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;__kernel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kerntest&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__global&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;loops_cnt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;get_global_id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;loops_cnt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;95&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="k"&gt;data&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;char&lt;/span&gt;&lt;span class="p"&gt;)(&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The operation we will be counting is the one in the loop:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;tmp = (2*tmp + id) % 95;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The following graph has been generated by gnuplot:&lt;/p&gt;
&lt;p&gt;&lt;img src="static/benchmark-results.png" alt="AMD GPU vs CPU benchmark results"/&gt;&lt;/p&gt;
&lt;p&gt;It displays on a loglog scale the number of operations performed
during a given period for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a single CPU&lt;/li&gt;
&lt;li&gt;a single GPU worker&lt;/li&gt;
&lt;li&gt;many GPU workers (from 10,000 to 1 Million)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each dot corresponds to a sample, i.e the number of operations
performed during the corresponding period. Each line is the linear
approximation of the corresponding points.&lt;/p&gt;
&lt;p&gt;A couple of statistics are printed by gnuplot:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;Millions&lt;/span&gt; &lt;span class="n"&gt;operations&lt;/span&gt; &lt;span class="n"&gt;per&lt;/span&gt; &lt;span class="k"&gt;second&lt;/span&gt; &lt;span class="o"&gt;=-&lt;/span&gt;
&lt;span class="n"&gt;CPU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;152&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="n"&gt;many&lt;/span&gt; &lt;span class="n"&gt;workers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;44045&lt;/span&gt;

&lt;span class="o"&gt;-=&lt;/span&gt; &lt;span class="n"&gt;Ratios&lt;/span&gt; &lt;span class="o"&gt;=-&lt;/span&gt;
&lt;span class="n"&gt;CPU&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;45&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="n"&gt;many&lt;/span&gt; &lt;span class="n"&gt;workers&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;CPU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;287&lt;/span&gt;
&lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="n"&gt;many&lt;/span&gt; &lt;span class="n"&gt;workers&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="n"&gt;GPU&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;13081&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This means that in 1 second:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The CPU performed 152 Millions operations.&lt;/li&gt;
&lt;li&gt;The GPU using 1 worker performed 3 Millions operations.&lt;/li&gt;
&lt;li&gt;The GPU using many workers performed 44 Billions operations.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We also computed of couple of ratios, to compare these different
results:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The CPU performs 45 times more operations than a single GPU worker.&lt;/li&gt;
&lt;li&gt;The GPU with many workers performs 287 times more operations.&lt;/li&gt;
&lt;li&gt;the GPU with many workers performs 13081 times more operations than
  when using only 1 worker on the same GPU.&lt;/li&gt;
&lt;/ul&gt;</content><category term="misc"></category><category term="AMD"></category><category term="Radeon"></category><category term="RX 480"></category><category term="GPU"></category><category term="OpenCL"></category><category term="Benchmark"></category></entry><entry><title>Macmini2,1 Linux dual boot</title><link href="http://www.florentflament.com/blog/macmini21-linux-dual-boot.html" rel="alternate"></link><published>2013-11-03T00:00:00+01:00</published><updated>2013-11-03T00:00:00+01:00</updated><author><name>Florent Flament</name></author><id>tag:www.florentflament.com,2013-11-03:/blog/macmini21-linux-dual-boot.html</id><summary type="html">&lt;p&gt;While online resources provide documentation about &lt;a href="https://wiki.debian.org/MacMiniIntel"&gt;how to install
Linux on a Mac Mini&lt;/a&gt;, this guide focuses on the Apple Macmini2,1
and its peculiarities. Please refer to &lt;a href="http://en.wikipedia.org/wiki/Macmini#Specifications"&gt;these tables&lt;/a&gt; to properly
identify your hardware.&lt;/p&gt;
&lt;h2&gt;About Macmini2,1&lt;/h2&gt;
&lt;p&gt;Apple provides &lt;a href="http://support.apple.com/kb/HT1237"&gt;firmware updates&lt;/a&gt; for most of its hardware. Most
Mac Minis …&lt;/p&gt;</summary><content type="html">&lt;p&gt;While online resources provide documentation about &lt;a href="https://wiki.debian.org/MacMiniIntel"&gt;how to install
Linux on a Mac Mini&lt;/a&gt;, this guide focuses on the Apple Macmini2,1
and its peculiarities. Please refer to &lt;a href="http://en.wikipedia.org/wiki/Macmini#Specifications"&gt;these tables&lt;/a&gt; to properly
identify your hardware.&lt;/p&gt;
&lt;h2&gt;About Macmini2,1&lt;/h2&gt;
&lt;p&gt;Apple provides &lt;a href="http://support.apple.com/kb/HT1237"&gt;firmware updates&lt;/a&gt; for most of its hardware. Most
Mac Minis do have an EFI Boot ROM update available there, but
Macmini2,1 doesn't. The good news is that what is stated on this page
is true, Macmini2,1 doesn't need any firmware update to be able to
boot non MacOS OSes.&lt;/p&gt;
&lt;p&gt;Macmini2,1 is powered by an Intel Core 2 Duo, which is a &lt;a href="http://en.wikipedia.org/wiki/Core_2_duo#64-bit_Core_microarchitecture_based"&gt;64-bit
processor&lt;/a&gt;. However, when trying to install a 64 bits Linux
distribution from a CDROM (by pressing the C key during boot sequence,
right after the startup sound), the installer hangs up on a text
screen, while seemingly starting to display a grub menu (I experienced
this with amd64 ISOs of Debian Wheezy, Debian Jessie and Xubuntu
Precise). With i386 images of these same distributions, the installer
starts in graphic mode without issue.&lt;/p&gt;
&lt;p&gt;However, I could find a way to install a 64 bits OS on the machine, by
booting the machine on a &lt;a href="http://rom-o-matic.net/gpxe/gpxe-git/gpxe.git/contrib/rom-o-matic/"&gt;CDROM launching a PXE installation&lt;/a&gt; over
the network. By using this mechanism, I succeeded in installing an
amd64 Ubuntu Precise Linux distribution. Note that I've been
unsuccessful in starting the computer from a USB key, or directly over
PXE.&lt;/p&gt;
&lt;h2&gt;Setting dual boot&lt;/h2&gt;
&lt;p&gt;On original Max OS X installations, the whole hard disk is occupied by
a unique partition. Therefore, we need to free some space for our new
OS, by resizing the partition. The &lt;code&gt;diskutil&lt;/code&gt; command allows us to do
that. In a shell, we have to launch the following command (where 20G
means that we want to let 20 Gigabytes to our OS X partition. One may
split the disk capacity according to its requirements):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo diskutil resizeVolume disk0s2 20G
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we have to install &lt;a href="http://refit.sourceforge.net/"&gt;rEFit&lt;/a&gt; on the computer. It will allow us
to choose the partition / device to boot, and to resynchronize GPT /
MBR tables as will be covered in a next step.&lt;/p&gt;
&lt;p&gt;We can now insert the Linux distribution installation CD into our Mac
(I downloaded the last &lt;a href="http://www.debian.org/distrib/netinst"&gt;Debian stable i386 netinst ISO&lt;/a&gt; and burned
it to a CD-RW with the Mac Mini's CD burner). When restarting the
computer, rEFit will allow us to boot on the CD.&lt;/p&gt;
&lt;p&gt;During the installation process, we have to create new partition(s)
(for convenience, I chose a distinct / and /home partitions). When
asked to install grub, choose &lt;code&gt;/dev/sda4&lt;/code&gt; (the partition that will be
mounted as /).&lt;/p&gt;
&lt;p&gt;Once the Linux installation is finished, reboot and use rEFit
&lt;code&gt;Partition Tool&lt;/code&gt; to resync GPT / MBR tables. Then boot back to MacOS
and use its &lt;code&gt;bless&lt;/code&gt; tool to make the new OS bootable:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo bless --device /dev/disk0s4 -setBoot
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Eventually, we can customize the rEFit configuration file
&lt;code&gt;/efi/refit/refit.conf&lt;/code&gt; to make the boot sequence more convenient. The
rEFit menu timeout can be set with the &lt;code&gt;timeout&lt;/code&gt; option. The option
&lt;code&gt;default_selection&lt;/code&gt; (at the end of the file) allows us to choose the
default OS to boot.&lt;/p&gt;
&lt;p&gt;That's it ! Restart, rEFit allows us to choose between booting Mac OS
X and Linux.&lt;/p&gt;</content><category term="misc"></category><category term="Apple"></category><category term="Linux"></category></entry></feed>